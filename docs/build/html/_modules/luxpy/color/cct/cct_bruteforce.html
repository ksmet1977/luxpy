<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>luxpy.color.cct.cct_bruteforce &mdash; LuxPy 1.12.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=fe8e256b"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            LuxPy
          </a>
              <div class="version">
                1.12.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License: GPLv3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../required_packages.html">Imported (required) packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../luxpy_structure.html">Luxpy package structure</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">LuxPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">luxpy.color.cct.cct_bruteforce</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for luxpy.color.cct.cct_bruteforce</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># Brute-force CCT &amp; Duv calculator</span>
<span class="sd">#-------------------------------------------------------------------------</span>

<span class="sd"> :_get_ccts_for_lut_bf(): Calculates CCTs for a LUT.</span>

<span class="sd"> :generate_lut_bf(): Calculate a Look-Up-Table for CCT &amp; Duv calculations.</span>

<span class="sd"> :xyz_to_cct_bruteforce: Calculate CCT, Duv from XYZ using a brute-force technique.</span>

<span class="sd">&quot;&quot;&quot;</span> 
<span class="c1"># #------luxpy import-------------------------------------------------------</span>
<span class="c1"># import os </span>
<span class="c1"># if &quot;code\\py&quot; not in os.getcwd(): os.chdir(&quot;./code/py/&quot;)</span>
<span class="c1"># root = &quot;../../&quot; if &quot;code\\py&quot; in os.getcwd() else  &quot;./&quot;</span>

<span class="c1"># import luxpy as lx</span>
<span class="c1"># print(&#39;luxpy version:&#39;, lx.__version__,&#39;\n&#39;)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_CCT_LUT_BRUTEFORCE_1931_2_uv60&#39;</span><span class="p">,</span><span class="s1">&#39;_get_ccts_for_lut_bf&#39;</span><span class="p">,</span> <span class="s1">&#39;generate_lut_bf&#39;</span><span class="p">,</span> <span class="s1">&#39;xyz_to_cct_bruteforce&#39;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">luxpy</span> <span class="kn">import</span> <span class="n">_CMF</span><span class="p">,</span> <span class="n">cie_interp</span><span class="p">,</span> <span class="n">blackbody</span><span class="p">,</span> <span class="n">spd_to_xyz_barebones</span><span class="p">,</span> <span class="n">getwlr</span><span class="p">,</span> <span class="n">xyz_to_Yuv60</span><span class="p">,</span> <span class="n">Yxy_to_xyz</span><span class="p">,</span> <span class="n">_CMF</span> 
<span class="kn">from</span> <span class="nn">luxpy.color.cct.cct</span> <span class="kn">import</span> <span class="n">_get_newton_raphson_estimated_Tc</span><span class="p">,</span> <span class="n">_process_cspace</span>
<span class="kn">from</span> <span class="nn">luxpy.color.ctf.colortf</span> <span class="kn">import</span> <span class="n">colortf</span>
<span class="kn">from</span> <span class="nn">luxpy</span> <span class="kn">import</span> <span class="n">math</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<div class="viewcode-block" id="_get_ccts_for_lut_bf">
<a class="viewcode-back" href="../../../../color.html#luxpy.color.cct._get_ccts_for_lut_bf">[docs]</a>
<span class="k">def</span> <span class="nf">_get_ccts_for_lut_bf</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">41000</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">end</span><span class="o">/</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">ccts</span> <span class="o">=</span> <span class="n">start</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">ccts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">start</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">ccts</span><span class="p">))</span>
        <span class="n">ccts</span><span class="p">[</span><span class="n">ccts</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-16</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">ccts</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">interval</span>
        <span class="n">ccts</span><span class="p">[</span><span class="n">ccts</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-16</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;K-1&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="mf">1e6</span><span class="o">/</span><span class="n">start</span> <span class="o">-</span> <span class="mf">1e6</span><span class="o">/</span><span class="n">end</span><span class="p">)</span><span class="o">/</span><span class="n">interval</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">ccts</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e6</span><span class="o">/</span><span class="n">start</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">interval</span><span class="p">)</span>
        <span class="n">ccts</span><span class="p">[</span><span class="n">ccts</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-16</span>
        <span class="n">ccts</span><span class="o">=</span><span class="mf">1e6</span><span class="o">/</span><span class="n">ccts</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;%-1&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mf">1e6</span><span class="o">/</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1e6</span><span class="o">/</span><span class="n">end</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ccts</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e6</span><span class="o">/</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">ccts</span><span class="p">[</span><span class="n">ccts</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-16</span>
        <span class="n">ccts</span><span class="o">=</span><span class="mf">1e6</span><span class="o">/</span><span class="n">ccts</span>
        <span class="n">ccts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="mf">1e6</span><span class="o">/</span><span class="p">((</span><span class="mf">1e6</span><span class="o">/</span><span class="n">start</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">)),</span><span class="n">ccts</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ccts</span></div>


<span class="k">def</span> <span class="nf">_check_sampling_interval</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">down_sampling_factor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Avoid division by zero crashing the code when LUT CCT spacing interval become too small. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;%&#39;</span> <span class="ow">in</span> <span class="n">unit</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="p">(</span><span class="n">down_sampling_factor</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="s1">&#39;K&#39;</span> <span class="ow">in</span> <span class="n">unit</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">interval</span><span class="o">/</span><span class="n">down_sampling_factor</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown unit&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_get_start_end</span><span class="p">(</span><span class="n">cctmin</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">cctmin</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="n">cctmin</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;K&#39;</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">cctmin</span> <span class="o">-</span> <span class="n">interval</span> 
        <span class="n">end</span> <span class="o">=</span> <span class="n">cctmin</span> <span class="o">+</span> <span class="n">interval</span> 
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;K-1&#39;</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span>  <span class="mf">1e6</span><span class="o">/</span><span class="p">(</span><span class="mf">1e6</span><span class="o">/</span><span class="p">(</span><span class="n">cctmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">interval</span><span class="p">)</span> 
        <span class="n">end</span> <span class="o">=</span>  <span class="mf">1e6</span><span class="o">/</span><span class="p">(</span><span class="mf">1e6</span><span class="o">/</span><span class="p">(</span><span class="n">cctmin</span><span class="p">)</span> <span class="o">-</span> <span class="n">interval</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;%-1&#39;</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mf">1e6</span><span class="o">/</span><span class="p">((</span><span class="mf">1e6</span><span class="o">/</span><span class="n">cctmin</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
        <span class="n">end</span> <span class="o">=</span> <span class="mf">1e6</span><span class="o">/</span><span class="p">((</span><span class="mf">1e6</span><span class="o">/</span><span class="n">cctmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">interval</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span>

<div class="viewcode-block" id="generate_lut_bf">
<a class="viewcode-back" href="../../../../color.html#luxpy.color.cct.generate_lut_bf">[docs]</a>
<span class="k">def</span> <span class="nf">generate_lut_bf</span><span class="p">(</span><span class="n">ccts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">41000</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> 
                 <span class="n">wl</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmfs</span> <span class="o">=</span> <span class="s2">&quot;1931_2&quot;</span><span class="p">,</span> <span class="n">cspace</span> <span class="o">=</span> <span class="s1">&#39;Yuv60&#39;</span><span class="p">,</span> <span class="n">cspace_kwargs</span> <span class="o">=</span> <span class="p">{}):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate a Look-Up-Table for CCT &amp; Duv calculations.</span>

<span class="sd">    Args:</span>
<span class="sd">        :ccts:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | If not None: use this specific list or ndarray of CCTs.</span>
<span class="sd">        :start:</span>
<span class="sd">            | 1000, optional</span>
<span class="sd">            | Start in CCT (LUT also has one lower CCT)</span>
<span class="sd">        :end:</span>
<span class="sd">            | 41000, optional</span>
<span class="sd">            | End at this CCT (LUT also has a higher CCT)</span>
<span class="sd">        :interval:</span>
<span class="sd">            | 0.25, optional</span>
<span class="sd">            | Interval to go from one to the next CCT in the LUT</span>
<span class="sd">            | (:unit: determines exactly how much this number increases the CCT)</span>
<span class="sd">        :unit:</span>
<span class="sd">            | &#39;%&#39;, optional</span>
<span class="sd">            | Options:</span>
<span class="sd">            |   - &#39;%&#39;: cct[i+1] = cct[i]*(1 + interval/100)</span>
<span class="sd">            |   - &#39;K&#39;: cct[i+1] = cct[i] + interval</span>
<span class="sd">            |   - &#39;%-1&#39;: 1e6/cct[i+1] = (1e6/cct[i])*(1 + interval/100)</span>
<span class="sd">            |   - &#39;K-1&#39;: 1e6/cct[i+1] = 1e6/cct[i] + interval</span>
<span class="sd">        :wl:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | If None: use same wavelengths as from cmf set to generate blackbody radiators</span>
<span class="sd">        :cmf:</span>
<span class="sd">            | &quot;1931_2&quot;, optional</span>
<span class="sd">            | String specifying or ndarray with CMF set.</span>
<span class="sd">        :cspace:</span>
<span class="sd">            | &#39;Yuv60&#39;, optional</span>
<span class="sd">            | String specifying the color or chromaticity space to calculate </span>
<span class="sd">            | the distance to the blackbody locus in. </span>
<span class="sd">            | (uses luxpy.colortf)</span>
<span class="sd">        :cspace_kwargs:</span>
<span class="sd">            | {}, optional</span>
<span class="sd">            | A dict with any kwargs for the xyz_to_space function </span>
<span class="sd">            | (cfr. luxpy.colortf(xyz, fwtf = cspace_kwargs)).</span>

<span class="sd">    Returns:</span>
<span class="sd">        :lut:</span>
<span class="sd">            | ndarray [nx3] with CCT, u, v coordinates </span>
<span class="sd">            |   (or whatever equivalent coordinates for the selected cspace)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ccts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">ccts</span> <span class="o">=</span> <span class="n">_get_ccts_for_lut_bf</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmfs</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="n">cmfs</span> <span class="o">=</span> <span class="n">_CMF</span><span class="p">[</span><span class="n">cmfs</span><span class="p">][</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">wl</span> <span class="o">=</span> <span class="n">getwlr</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">wl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">cmfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">cmfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> 
        <span class="n">cmfs</span> <span class="o">=</span> <span class="n">cie_interp</span><span class="p">(</span><span class="n">cmfs</span><span class="p">,</span> <span class="n">wl</span><span class="p">,</span> <span class="n">datatype</span> <span class="o">=</span> <span class="s1">&#39;cmf&#39;</span><span class="p">)</span>

    <span class="n">BBs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ccts</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">wl</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cct</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ccts</span><span class="p">):</span>
        <span class="n">BBs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">blackbody</span><span class="p">(</span><span class="n">cct</span><span class="p">,</span> <span class="n">wl3</span> <span class="o">=</span> <span class="n">wl</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">BBs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">wl</span><span class="p">,</span><span class="n">BBs</span><span class="p">))</span>
    <span class="n">xyz</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">spd_to_xyz_barebones</span><span class="p">(</span><span class="n">BBs</span><span class="p">,</span> <span class="n">cmfs</span><span class="p">,</span> <span class="n">relative</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">Yuv60</span> <span class="o">=</span> <span class="n">colortf</span><span class="p">(</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">cspace</span><span class="p">,</span> <span class="n">fwtf</span> <span class="o">=</span> <span class="n">cspace_kwargs</span><span class="p">)</span> <span class="c1"># default is cspace = &#39;Yuv60&#39;</span>
    <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">ccts</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">Yuv60</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="k">return</span> <span class="n">lut</span></div>


<span class="n">_CCT_LUT_BRUTEFORCE_1931_2_uv60</span> <span class="o">=</span> <span class="n">generate_lut_bf</span><span class="p">(</span><span class="n">ccts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">41000</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> 
                                                  <span class="n">wl</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmfs</span> <span class="o">=</span> <span class="s2">&quot;1931_2&quot;</span><span class="p">,</span><span class="n">cspace</span> <span class="o">=</span> <span class="s1">&#39;Yuv60&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_get_Duv_for_T_from_uvBB</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span> <span class="n">uBB0</span><span class="p">,</span> <span class="n">vBB0</span><span class="p">,</span> <span class="n">sign_only</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Calculate Duv from (u,v) coordinates of estimated Tc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get duv: </span>
    <span class="n">du</span><span class="p">,</span> <span class="n">dv</span> <span class="o">=</span> <span class="n">u</span> <span class="o">-</span> <span class="n">uBB0</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="n">vBB0</span>

    <span class="c1"># find sign of duv:</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">positive_arctan</span><span class="p">(</span><span class="n">du</span><span class="p">,</span><span class="n">dv</span><span class="p">,</span><span class="n">htype</span><span class="o">=</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">theta</span><span class="p">[</span><span class="n">theta</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">theta</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>
    <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sign_only</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">sign</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sign</span><span class="o">*</span><span class="p">(</span><span class="n">du</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dv</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> 
    
<div class="viewcode-block" id="xyz_to_cct_bruteforce">
<a class="viewcode-back" href="../../../../color.html#luxpy.color.cct.xyz_to_cct_bruteforce">[docs]</a>
<span class="k">def</span> <span class="nf">xyz_to_cct_bruteforce</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">wl</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmfs</span> <span class="o">=</span> <span class="s2">&quot;1931_2&quot;</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="mf">1e-15</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-20</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">=</span> <span class="mf">1e4</span><span class="p">,</span> <span class="n">down_sampling_factor</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                          <span class="n">ccts</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">41000</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span>
                          <span class="n">cspace</span> <span class="o">=</span> <span class="s1">&#39;Yuv60&#39;</span><span class="p">,</span> <span class="n">cspace_kwargs</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">lut</span> <span class="o">=</span> <span class="n">_CCT_LUT_BRUTEFORCE_1931_2_uv60</span><span class="p">,</span>
                          <span class="n">use_newton_raphson</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fast_duv</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;cct&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the CCT (and Duv) value for a set of tristimulus values using </span>
<span class="sd">    brute-force approach. The method start by generating a large LUT, finds </span>
<span class="sd">    CCT with a minimum distance to the blackbody locus. Then further iterates </span>
<span class="sd">    over smaller and smaller CCT-ranges by generating new LUTs, until the solution</span>
<span class="sd">    converges to a specified tolerance or until a maximum number of iterations </span>
<span class="sd">    is reached. </span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz:</span>
<span class="sd">            | ndarray of tristimulus values XYZ. [nx3]</span>
<span class="sd">        :wl:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | If None: use same wavelengths as from cmf set to generate blackbody radiators for LUT.</span>
<span class="sd">        :cmf:</span>
<span class="sd">            | &quot;1931_2&quot;, optional</span>
<span class="sd">            | String specifying or ndarray with CMF set to use for LUT computation.</span>
<span class="sd">        :atol:</span>
<span class="sd">            | 0.1, optional</span>
<span class="sd">            | Absolute tolerance in Kelvin. If the difference between the two surrounding CCTs is smaller than tol, </span>
<span class="sd">            | the brute-force search stops.</span>
<span class="sd">        :n_max:</span>
<span class="sd">            | 1000, optional</span>
<span class="sd">            | Maximum number of iterations that a more detailed LUT is generated.</span>
<span class="sd">            | If the number of iterations &gt; n_max, the brute-force search stops.</span>
<span class="sd">        :down_sampling_factor:</span>
<span class="sd">            | 10, optional</span>
<span class="sd">            | Value by which the original interval is further downsampled at each iteration.</span>
<span class="sd">        :ccts:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | If not None: use this specific list or ndarray of CCTs.</span>
<span class="sd">        :start:</span>
<span class="sd">            | 1000, optional</span>
<span class="sd">            | Start in CCT (LUT also has one lower CCT)</span>
<span class="sd">        :end:</span>
<span class="sd">            | 41000, optional</span>
<span class="sd">            | End at this CCT (LUT also has a higher CCT)</span>
<span class="sd">        :interval:</span>
<span class="sd">            | 0.25, optional</span>
<span class="sd">            | Interval to go from one to the next CCT in the LUT</span>
<span class="sd">            | (:unit: determines exactly how much this number increases the CCT)</span>
<span class="sd">        :unit:</span>
<span class="sd">            | &#39;%&#39;, optional</span>
<span class="sd">            | Options:</span>
<span class="sd">            |   - &#39;%&#39;: cct[i+1] = cct[i]*(1 + interval/100)</span>
<span class="sd">            |   - &#39;K&#39;: cct[i+1] = cct[i] + interval</span>
<span class="sd">            |   - &#39;%-1&#39;: 1e6/cct[i+1] = (1e6/cct[i])*(1 + interval/100)</span>
<span class="sd">            |   - &#39;K-1&#39;: 1e6/cct[i+1] = 1e6/cct[i] + interval</span>
<span class="sd">        :cspace:</span>
<span class="sd">            | &#39;Yuv60&#39;, optional</span>
<span class="sd">            | String specifying the color or chromaticity space to calculate </span>
<span class="sd">            | the distance to the blackbody locus in. </span>
<span class="sd">            | (uses luxpy.colortf)</span>
<span class="sd">        :cspace_kwargs:</span>
<span class="sd">            | {}, optional</span>
<span class="sd">            | A dict with any kwargs for the xyz_to_space function </span>
<span class="sd">            | (cfr. luxpy.colortf(xyz, fwtf = cspace_kwargs)).</span>
<span class="sd">        :lut:</span>
<span class="sd">            | _CCT_LUT_BRUTEFORCE_1931_2_uv60, optonal</span>
<span class="sd">            | Pre-calculated LUT: Lut for CIE uv 1960 coordinates and CIE 1931 2Â° CMFs.  </span>
<span class="sd">            | If not None, this LUT is used instead of generating a new one (= only starting lut).</span>
<span class="sd">        :use_newton_raphson:</span>
<span class="sd">            | False, optional</span>
<span class="sd">            | If True: use Newton-Raphson method to find the exact CCT. </span>
<span class="sd">            | Much faster than brute-force search.</span>
<span class="sd">        :fast_duv:</span>
<span class="sd">            | True, optional</span>
<span class="sd">        :out: </span>
<span class="sd">            | &#39;cct&#39; (or 1), optional</span>
<span class="sd">            | Determines what to return.</span>
<span class="sd">            | Other options: &#39;duv&#39; (or -1), &#39;cct,duv&#39;(or 2), &quot;[cct,duv]&quot; (or -2)</span>

<span class="sd">            </span>
<span class="sd">     Returns:</span>
<span class="sd">        :CCT_Duv:</span>
<span class="sd">            | ndarray(s) with:</span>
<span class="sd">            |    cct: out == &#39;cct&#39; (or 1)</span>
<span class="sd">            |    duv: out == &#39;duv&#39; (or -1)</span>
<span class="sd">            |    cct, duv: out == &#39;cct,duv&#39; (or 2)</span>
<span class="sd">            |    [cct,duv]: out == &quot;[cct,duv]&quot; (or -2) </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">uv60</span> <span class="o">=</span> <span class="n">colortf</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">cspace</span><span class="p">,</span> <span class="n">fwtf</span> <span class="o">=</span> <span class="n">cspace_kwargs</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># default is cspace = &#39;Yuv60&#39;</span>

    <span class="k">if</span> <span class="n">lut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">lut</span> <span class="o">=</span> <span class="n">generate_lut_bf</span><span class="p">(</span><span class="n">ccts</span> <span class="o">=</span> <span class="n">ccts</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span><span class="p">,</span> <span class="n">wl</span> <span class="o">=</span> <span class="n">wl</span><span class="p">,</span> <span class="n">cmfs</span> <span class="o">=</span> <span class="n">cmfs</span><span class="p">)</span>

    <span class="n">duv</span> <span class="o">=</span> <span class="p">((</span><span class="n">lut</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:][:,</span><span class="kc">None</span><span class="p">,:]</span><span class="o">-</span><span class="n">uv60</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">cctmin</span> <span class="o">=</span> <span class="n">lut</span><span class="p">[</span><span class="n">duv</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">0</span><span class="p">)][:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">use_newton_raphson</span><span class="p">:</span>
        <span class="c1"># Newton-Raphson method to find the exact CCT</span>
        <span class="c1">#xyzbar = _CMF[cmfs][&quot;bar&quot;].copy() if isinstance(cmfs,str) else cmfs </span>
        <span class="c1"># Process cspace-parameters:</span>
        <span class="n">cspace_dict</span><span class="p">,</span> <span class="n">cspace_str</span> <span class="o">=</span> <span class="n">_process_cspace</span><span class="p">(</span><span class="n">cspace</span><span class="p">,</span> <span class="n">cspace_kwargs</span><span class="p">)</span>
        <span class="n">cctduv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">_get_newton_raphson_estimated_Tc</span><span class="p">(</span><span class="n">uv60</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">uv60</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">cctmin</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> 
                                                <span class="n">wl</span> <span class="o">=</span> <span class="n">wl</span><span class="p">,</span> <span class="n">atol</span> <span class="o">=</span> <span class="n">atol</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="n">rtol</span><span class="p">,</span>
                                                <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cmfs</span><span class="p">,</span> <span class="n">xyzbar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                                <span class="n">cspace_dict</span> <span class="o">=</span> <span class="n">cspace_dict</span><span class="p">,</span> 
                                                <span class="n">max_iter</span> <span class="o">=</span> <span class="n">n_max</span><span class="p">,</span> <span class="n">fast_duv</span> <span class="o">=</span> <span class="n">fast_duv</span><span class="p">))</span>


        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">wl</span> <span class="o">=</span> <span class="n">getwlr</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">_get_start_end</span><span class="p">(</span><span class="n">cctmin</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="n">start_end</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
        <span class="n">cctduv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">uv60</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">start_end_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">start_end</span><span class="p">):</span>
            <span class="n">start_i</span><span class="p">,</span> <span class="n">end_i</span> <span class="o">=</span> <span class="n">start_end_i</span>
            <span class="n">delta_cct_i</span> <span class="o">=</span> <span class="n">end_i</span> <span class="o">-</span> <span class="n">start_i</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">interval_i</span> <span class="o">=</span> <span class="n">interval</span><span class="o">/</span><span class="n">down_sampling_factor</span>
            <span class="k">while</span> <span class="kc">True</span> <span class="o">&amp;</span> <span class="n">_check_sampling_interval</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">interval_i</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">lut_i</span> <span class="o">=</span> <span class="n">generate_lut_bf</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="n">start_i</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">end_i</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="n">interval_i</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span><span class="p">,</span> <span class="n">wl</span> <span class="o">=</span> <span class="n">wl</span><span class="p">,</span> <span class="n">cmfs</span> <span class="o">=</span> <span class="n">cmfs</span><span class="p">)</span>
                <span class="n">duv_i</span> <span class="o">=</span> <span class="p">((</span><span class="n">lut_i</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:][:,</span><span class="kc">None</span><span class="p">,:]</span><span class="o">-</span><span class="n">uv60</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
                <span class="n">cctmin_i</span> <span class="o">=</span> <span class="n">lut_i</span><span class="p">[</span><span class="n">duv_i</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">0</span><span class="p">)][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">start_i</span><span class="p">,</span> <span class="n">end_i</span> <span class="o">=</span> <span class="n">_get_start_end</span><span class="p">(</span><span class="n">cctmin_i</span><span class="p">,</span> <span class="n">interval_i</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                <span class="n">delta_cct_i</span> <span class="o">=</span> <span class="n">end_i</span> <span class="o">-</span> <span class="n">start_i</span>
                <span class="n">interval_i</span> <span class="o">=</span> <span class="n">interval_i</span><span class="o">/</span><span class="n">down_sampling_factor</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">delta_cct_i</span> <span class="o">&lt;=</span> <span class="n">atol</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">delta_cct_i</span><span class="o">/</span><span class="n">cctmin_i</span> <span class="o">&lt;=</span> <span class="n">rtol</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">n_max</span><span class="p">):</span> <span class="k">break</span>
                
            <span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">uv60</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">uv60</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">uBB0</span><span class="p">,</span> <span class="n">vBB0</span> <span class="o">=</span> <span class="n">lut_i</span><span class="p">[</span><span class="n">duv_i</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">0</span><span class="p">)][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">lut_i</span><span class="p">[</span><span class="n">duv_i</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="mi">0</span><span class="p">)][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">_get_Duv_for_T_from_uvBB</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span> <span class="n">uBB0</span><span class="p">,</span> <span class="n">vBB0</span><span class="p">,</span> <span class="n">sign_only</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">cctduv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">cctmin_i</span><span class="p">,</span><span class="n">sign</span><span class="o">*</span><span class="n">duv_i</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span> 
    
    <span class="c1"># Regulate output:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;cct&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cctduv</span><span class="p">[:,:</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;duv&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cctduv</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;cct,duv&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cctduv</span><span class="p">[:,:</span><span class="mi">1</span><span class="p">],</span><span class="n">cctduv</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="s2">&quot;[cct,duv]&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cctduv</span>   
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown output requested&#39;</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">luxpy</span> <span class="k">as</span> <span class="nn">lx</span> 

    <span class="n">spds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lx</span><span class="o">.</span><span class="n">_IESTM3018</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">spd</span> <span class="o">=</span> <span class="n">spds</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>

    <span class="n">cmf2</span><span class="p">,</span><span class="n">K2</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">_CMF</span><span class="p">[</span><span class="s2">&quot;1931_2&quot;</span><span class="p">][</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">lx</span><span class="o">.</span><span class="n">_CMF</span><span class="p">[</span><span class="s2">&quot;1931_2&quot;</span><span class="p">][</span><span class="s2">&quot;K&quot;</span><span class="p">]</span>
    <span class="n">cmf2_</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">xyzbar</span><span class="p">(</span><span class="n">cieobs</span><span class="o">=</span><span class="s2">&quot;1931_2&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cmf2 == cmf2_ ?:&#39;</span><span class="p">,</span> <span class="p">(((</span><span class="n">cmf2</span><span class="o">-</span><span class="n">cmf2_</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()))</span>

    <span class="n">cctduv_calculator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6425.14268404576</span><span class="p">,</span><span class="mf">0.00719612617474981</span><span class="p">])</span>

    <span class="n">force_tolerance</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">xyz1</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">spd</span><span class="p">,</span><span class="n">cieobs</span><span class="o">=</span><span class="s1">&#39;1931_2&#39;</span><span class="p">,</span><span class="n">relative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">cctduv</span> <span class="o">=</span> <span class="n">xyz_to_cct_bruteforce</span><span class="p">(</span><span class="n">xyz1</span><span class="p">,</span> <span class="n">wl</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmfs</span> <span class="o">=</span> <span class="s2">&quot;1931_2&quot;</span><span class="p">,</span> <span class="n">n_max</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">down_sampling_factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                                <span class="n">start</span> <span class="o">=</span> <span class="mi">1100</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">41000</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span><span class="s1">&#39;K-1&#39;</span><span class="p">,</span> <span class="n">cspace</span> <span class="o">=</span> <span class="s1">&#39;Yuv60&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cctduv: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">cctduv</span><span class="p">)</span>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Kevin A.G. Smet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>