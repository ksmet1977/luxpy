<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>luxpy.color.deltaE.colordifferences &mdash; LuxPy 1.11.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=6cf1fb80"></script>
        <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            LuxPy
          </a>
              <div class="version">
                1.11.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License: GPLv3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../required_packages.html">Imported (required) packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../luxpy_structure.html">Luxpy package structure</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">LuxPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">luxpy.color.deltaE.colordifferences</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for luxpy.color.deltaE.colordifferences</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for color difference calculations</span>
<span class="sd">========================================</span>

<span class="sd"> :deltaH(): Compute a hue difference, dH = 2*C1*C2*sin(dh/2)</span>
<span class="sd"> </span>
<span class="sd"> :_process_DEi(): Process color difference input DEi for output (helper fnc).</span>

<span class="sd"> :DE_camucs(): Calculate color appearance difference DE using camucs type model.</span>

<span class="sd"> :DE_2000(): Calculate DE2000 color difference.</span>

<span class="sd"> :DE_cspace():  Calculate color difference DE in specific color space.</span>

<span class="sd">.. codeauthor:: Kevin A.G. Smet (ksmet1977 at gmail.com)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">luxpy</span> <span class="kn">import</span> <span class="n">cam</span><span class="p">,</span> <span class="n">_CSPACE</span><span class="p">,</span> <span class="n">colortf</span><span class="p">,</span> <span class="n">xyz_to_lab</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;deltaH&#39;</span><span class="p">,</span> <span class="s1">&#39;DE_camucs&#39;</span><span class="p">,</span> <span class="s1">&#39;DE2000&#39;</span><span class="p">,</span><span class="s1">&#39;DE_cspace&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="deltaH">
<a class="viewcode-back" href="../../../../color.html#luxpy.color.deltaE.deltaH">[docs]</a>
<span class="k">def</span> <span class="nf">deltaH</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute a hue difference, dH = 2*C1*C2*sin(dh/2)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :h1:</span>
<span class="sd">            | hue for sample 1 (or hue difference if h2 is None)</span>
<span class="sd">        :C1: </span>
<span class="sd">            | chroma of sample 1 (or prod C1*C2 if C2 is None)</span>
<span class="sd">        :h2: </span>
<span class="sd">            | hue angle of sample 2 (if None, then h1 contains a hue difference)</span>
<span class="sd">        :C2: </span>
<span class="sd">            | chroma of sample 2</span>
<span class="sd">        :htype: </span>
<span class="sd">            | &#39;deg&#39; or &#39;rad&#39;, optional</span>
<span class="sd">            |   - &#39;deg&#39;: hue angle between 0° and 360°</span>
<span class="sd">            |   - &#39;rad&#39;: hue angle between 0 and 2pi radians</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        :returns:</span>
<span class="sd">            | ndarray of deltaH values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">cam</span><span class="o">.</span><span class="n">deltaH</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">h2</span><span class="p">,</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">C2</span><span class="p">,</span> <span class="n">htype</span> <span class="o">=</span> <span class="n">htype</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_process_DEi</span><span class="p">(</span><span class="n">DEi</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="s1">&#39;jab&#39;</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">avg_axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;DEi&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process color difference input DEi for output (helper function).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :DEi: </span>
<span class="sd">            | tuple(J ndarray, ab ndarray).</span>
<span class="sd">        :DEtype:</span>
<span class="sd">            | &#39;jab&#39; or str, optional</span>
<span class="sd">            | Options: </span>
<span class="sd">            |    - &#39;jab&#39; : calculates full color difference over all 3 dimensions.</span>
<span class="sd">            |    - &#39;ab&#39;  : calculates chromaticity difference.</span>
<span class="sd">            |    - &#39;j&#39;   : calculates lightness or brightness difference </span>
<span class="sd">            |             (depending on :out:).</span>
<span class="sd">            |    - &#39;j,ab&#39;: calculates both &#39;j&#39; and &#39;ab&#39; options </span>
<span class="sd">            |              and returns them as a tuple.</span>
<span class="sd">        :avg:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | None: don&#39;t calculate average DE, </span>
<span class="sd">            |       otherwise use function handle in :avg:.</span>
<span class="sd">        :avg_axis:</span>
<span class="sd">            | axis to calculate average over, optional</span>
<span class="sd">        :out: </span>
<span class="sd">            | &#39;DEi&#39; or str, optional</span>
<span class="sd">            | Requested output.</span>
<span class="sd">        </span>
<span class="sd">    Note:</span>
<span class="sd">        For the other input arguments, see specific color space used.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        :returns: </span>
<span class="sd">            | ndarray with DEi [, DEa] or other as specified by :out:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">DEi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">DEi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">DEi</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">DEi</span><span class="p">)))</span>
    
    <span class="c1"># Calculate correct type of DE:</span>
    <span class="k">if</span> <span class="n">DEtype</span> <span class="o">==</span> <span class="s1">&#39;jab&#39;</span><span class="p">:</span>
        <span class="n">DEi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">DEi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">DEi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">DEtype</span> <span class="o">==</span> <span class="s1">&#39;ab&#39;</span><span class="p">:</span>
        <span class="n">DEi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">DEi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">DEtype</span> <span class="o">==</span> <span class="s1">&#39;j&#39;</span><span class="p">:</span>
        <span class="n">DEi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">DEi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Calculate average when requested:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">avg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="s1">&#39;DEa&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">DEi</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">DEa</span> <span class="o">=</span> <span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="n">DEi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span> <span class="o">=</span> <span class="n">avg_axis</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span> <span class="n">avg</span><span class="p">(</span><span class="n">DEi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span> <span class="o">=</span> <span class="n">avg_axis</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DEa</span> <span class="o">=</span> <span class="n">avg</span><span class="p">(</span><span class="n">DEi</span><span class="p">,</span><span class="n">axis</span> <span class="o">=</span> <span class="n">avg_axis</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;DEi&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DEi</span>
    <span class="k">elif</span> <span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;DEi,DEa&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DEi</span><span class="p">,</span> <span class="n">DEa</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>


<div class="viewcode-block" id="DE_camucs">
<a class="viewcode-back" href="../../../../color.html#luxpy.color.deltaE.DE_camucs">[docs]</a>
<span class="k">def</span> <span class="nf">DE_camucs</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">xyzr</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="s1">&#39;jab&#39;</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">avg_axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;DEi&#39;</span><span class="p">,</span>
              <span class="n">xyzwt</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_WHITE_POINT</span><span class="p">,</span> <span class="n">xyzwr</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_WHITE_POINT</span><span class="p">,</span> \
              <span class="n">Ywt</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conditionst</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_CONDITIONS</span><span class="p">,</span>\
              <span class="n">Ywr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">conditionsr</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_CONDITIONS</span><span class="p">,</span>\
              <span class="n">camtype</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_TYPE</span><span class="p">,</span> <span class="n">ucstype</span> <span class="o">=</span> <span class="s1">&#39;ucs&#39;</span><span class="p">,</span> <span class="n">mcat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> \
              <span class="n">outin</span> <span class="o">=</span> <span class="s1">&#39;J,aM,bM&#39;</span><span class="p">,</span> <span class="n">yellowbluepurplecorrect</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate color appearance difference DE using camucs type model.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :xyzt: </span>
<span class="sd">            | ndarray with tristimulus values of test data.</span>
<span class="sd">        :xyzr:</span>
<span class="sd">            | ndarray with tristimulus values of reference data.</span>
<span class="sd">        :DEtype:</span>
<span class="sd">            | &#39;jab&#39; or str, optional</span>
<span class="sd">            | Options: </span>
<span class="sd">            |    - &#39;jab&#39; : calculates full color difference over all 3 dimensions.</span>
<span class="sd">            |    - &#39;ab&#39;  : calculates chromaticity difference.</span>
<span class="sd">            |    - &#39;j&#39;   : calculates lightness or brightness difference </span>
<span class="sd">            |             (depending on :outin:).</span>
<span class="sd">            |    - &#39;j,ab&#39;: calculates both &#39;j&#39; and &#39;ab&#39; options </span>
<span class="sd">            |              and returns them as a tuple.</span>
<span class="sd">        :avg:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | None: don&#39;t calculate average DE, </span>
<span class="sd">            |       otherwise use function handle in :avg:.</span>
<span class="sd">        :avg_axis:</span>
<span class="sd">            | axis to calculate average over, optional</span>
<span class="sd">        :out: </span>
<span class="sd">            | &#39;DEi&#39; or str, optional</span>
<span class="sd">            | Requested output.</span>
<span class="sd">        :camtype: </span>
<span class="sd">            | luxpy.cam._CAM_DEFAULT_TYPE, optional</span>
<span class="sd">            | Str specifier for CAM type to use, options: &#39;ciecam02&#39; or &#39;ciecam16&#39;.</span>
<span class="sd">        :ucstype:</span>
<span class="sd">            | &#39;ucs&#39; or &#39;lcd&#39; or &#39;scd&#39;, optional</span>
<span class="sd">            | Str specifier for which type of color attribute compression </span>
<span class="sd">            |  parameters to use:</span>
<span class="sd">            |   -&#39;ucs&#39;: uniform color space, </span>
<span class="sd">            |   -&#39;lcd&#39;: large color differences, </span>
<span class="sd">            |   -&#39;scd&#39;: small color differences</span>

<span class="sd">    Note:</span>
<span class="sd">        For the other input arguments, see ?luxpy.cam.camucs_structure.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        :returns: </span>
<span class="sd">            | ndarray with DEi [, DEa] or other as specified by :out:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    
    <span class="n">jabt</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">camXucs</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">xyzwt</span><span class="p">,</span> <span class="n">Yw</span> <span class="o">=</span> <span class="n">Ywt</span><span class="p">,</span> <span class="n">conditions</span> <span class="o">=</span> <span class="n">conditionst</span><span class="p">,</span>\
                       <span class="n">camtype</span> <span class="o">=</span> <span class="n">camtype</span><span class="p">,</span> <span class="n">ucstype</span> <span class="o">=</span> <span class="n">ucstype</span><span class="p">,</span> <span class="n">mcat</span> <span class="o">=</span> <span class="n">mcat</span><span class="p">,</span> <span class="n">forward</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> \
                       <span class="n">outin</span> <span class="o">=</span> <span class="n">outin</span><span class="p">,</span> <span class="n">yellowbluepurplecorrect</span> <span class="o">=</span> <span class="n">yellowbluepurplecorrect</span><span class="p">)</span>
    
    <span class="n">jabr</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">camXucs</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">xyzwr</span><span class="p">,</span> <span class="n">Yw</span> <span class="o">=</span> <span class="n">Ywr</span><span class="p">,</span> <span class="n">conditions</span> <span class="o">=</span> <span class="n">conditionsr</span><span class="p">,</span>\
                       <span class="n">camtype</span> <span class="o">=</span> <span class="n">camtype</span><span class="p">,</span> <span class="n">ucstype</span> <span class="o">=</span> <span class="n">ucstype</span><span class="p">,</span> <span class="n">mcat</span> <span class="o">=</span> <span class="n">mcat</span><span class="p">,</span> <span class="n">forward</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> \
                       <span class="n">outin</span> <span class="o">=</span> <span class="n">outin</span><span class="p">,</span> <span class="n">yellowbluepurplecorrect</span> <span class="o">=</span> <span class="n">yellowbluepurplecorrect</span><span class="p">)</span>
    
    
    <span class="n">KL</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cam</span><span class="o">.</span><span class="n">_CAM_UCS_PARAMETERS</span><span class="p">[</span><span class="n">camtype</span><span class="p">][</span><span class="n">ucstype</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">_CAM_UCS_PARAMETERS</span><span class="p">[</span><span class="n">camtype</span><span class="p">][</span><span class="n">ucstype</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>

    <span class="c1"># Calculate color difference and take account of KL:</span>
    <span class="n">DEi</span> <span class="o">=</span> <span class="p">((((</span><span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">KL</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>\
               <span class="p">((</span><span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">_process_DEi</span><span class="p">(</span><span class="n">DEi</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="n">DEtype</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="p">,</span> <span class="n">avg_axis</span> <span class="o">=</span> <span class="n">avg_axis</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">)</span></div>

    



<div class="viewcode-block" id="DE2000">
<a class="viewcode-back" href="../../../../color.html#luxpy.color.deltaE.DE2000">[docs]</a>
<span class="k">def</span> <span class="nf">DE2000</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">xyzr</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="s1">&#39;jab&#39;</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">avg_axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;DEi&#39;</span><span class="p">,</span>
              <span class="n">xyzwt</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xyzwr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">KLCH</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate DE2000 color difference.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :xyzt: </span>
<span class="sd">            | ndarray with tristimulus values of test data.</span>
<span class="sd">        :xyzr:</span>
<span class="sd">            | ndarray with tristimulus values of reference data.</span>
<span class="sd">        :dtype:</span>
<span class="sd">            | &#39;xyz&#39; or &#39;lab&#39;, optional</span>
<span class="sd">            | Specifies data type in :xyzt: and :xyzr:.</span>
<span class="sd">        :xyzwt:</span>
<span class="sd">            | None or ndarray, optional</span>
<span class="sd">            |   White point tristimulus values of test data</span>
<span class="sd">            |   None defaults to the one set in lx.xyz_to_lab()</span>
<span class="sd">        :xyzwr:</span>
<span class="sd">            | None or ndarray, optional</span>
<span class="sd">            |    Whitepoint tristimulus values of reference data</span>
<span class="sd">            |    None defaults to the one set in lx.xyz_to_lab()</span>
<span class="sd">        :DEtype:</span>
<span class="sd">            | &#39;jab&#39; or str, optional</span>
<span class="sd">            | Options: </span>
<span class="sd">            |    - &#39;jab&#39; : calculates full color difference over all 3 dimensions.</span>
<span class="sd">            |    - &#39;ab&#39;  : calculates chromaticity difference.</span>
<span class="sd">            |    - &#39;j&#39;   : calculates lightness or brightness difference </span>
<span class="sd">            |             (depending on :outin:).</span>
<span class="sd">            |    - &#39;j,ab&#39;: calculates both &#39;j&#39; and &#39;ab&#39; options </span>
<span class="sd">            |              and returns them as a tuple.</span>
<span class="sd">        :KLCH: </span>
<span class="sd">            | None, optional</span>
<span class="sd">            | Weigths for L, C, H </span>
<span class="sd">            | None: default to [1,1,1] </span>
<span class="sd">        :avg:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | None: don&#39;t calculate average DE, </span>
<span class="sd">            |       otherwise use function handle in :avg:.</span>
<span class="sd">        :avg_axis:</span>
<span class="sd">            | axis to calculate average over, optional</span>
<span class="sd">        :out: </span>
<span class="sd">            | &#39;DEi&#39; or str, optional</span>
<span class="sd">            | Requested output.</span>
<span class="sd">        </span>
<span class="sd">    Note:</span>
<span class="sd">        For the other input arguments, see specific color space used.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        :returns: </span>
<span class="sd">            | ndarray with DEi [, DEa] or other as specified by :out:</span>
<span class="sd">            </span>
<span class="sd">    References:</span>
<span class="sd">        1. `Sharma, G., Wu, W., &amp; Dalal, E. N. (2005). </span>
<span class="sd">        The CIEDE2000 color‐difference formula: Implementation notes, </span>
<span class="sd">        supplementary test data, and mathematical observations. </span>
<span class="sd">        Color Research &amp; Application, 30(1), 21–30. </span>
<span class="sd">        &lt;https://doi.org/10.1002/col.20070&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">KLCH</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">KLCH</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
        <span class="n">labt</span> <span class="o">=</span> <span class="n">xyz_to_lab</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">xyzwt</span><span class="p">)</span>
        <span class="n">labr</span> <span class="o">=</span> <span class="n">xyz_to_lab</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">xyzwr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">labt</span> <span class="o">=</span> <span class="n">xyzt</span>
        <span class="n">labr</span> <span class="o">=</span> <span class="n">xyzr</span>
 
    <span class="n">Lt</span> <span class="o">=</span> <span class="n">labt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">at</span> <span class="o">=</span> <span class="n">labt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">bt</span> <span class="o">=</span> <span class="n">labt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">Ct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">at</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">bt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#ht = cam.hue_angle(at,bt,htype = &#39;rad&#39;)</span>
    
    <span class="n">Lr</span> <span class="o">=</span> <span class="n">labr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ar</span> <span class="o">=</span> <span class="n">labr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">br</span> <span class="o">=</span> <span class="n">labr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">Cr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ar</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">br</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#hr = cam.hue_angle(at,bt,htype = &#39;rad&#39;)</span>
    
    <span class="c1"># Step 1:</span>
    <span class="n">Cavg</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ct</span> <span class="o">+</span> <span class="n">Cr</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">G</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Cavg</span><span class="o">**</span><span class="mf">7.0</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">Cavg</span><span class="o">**</span><span class="mf">7.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">25.0</span><span class="o">**</span><span class="mi">7</span><span class="p">))))</span>
    <span class="n">apt</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">G</span><span class="p">)</span><span class="o">*</span><span class="n">at</span>
    <span class="n">apr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">G</span><span class="p">)</span><span class="o">*</span><span class="n">ar</span>
    
    <span class="n">Cpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">apt</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">bt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Cpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">apr</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">br</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Cpprod</span> <span class="o">=</span> <span class="n">Cpt</span><span class="o">*</span><span class="n">Cpr</span>


    <span class="n">hpt</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">hue_angle</span><span class="p">(</span><span class="n">apt</span><span class="p">,</span><span class="n">bt</span><span class="p">,</span> <span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">hpr</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">hue_angle</span><span class="p">(</span><span class="n">apr</span><span class="p">,</span><span class="n">br</span><span class="p">,</span> <span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>
    <span class="n">hpt</span><span class="p">[(</span><span class="n">apt</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">bt</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">hpr</span><span class="p">[(</span><span class="n">apr</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">br</span><span class="o">==</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># Step 2:</span>
    <span class="n">dL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Lr</span> <span class="o">-</span> <span class="n">Lt</span><span class="p">)</span>
    <span class="n">dCp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cpr</span> <span class="o">-</span> <span class="n">Cpt</span><span class="p">)</span>
    <span class="n">dhp_</span> <span class="o">=</span> <span class="n">hpr</span> <span class="o">-</span> <span class="n">hpt</span>  

    <span class="n">dhp</span> <span class="o">=</span> <span class="n">dhp_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">dhp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dhp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">360</span>
    <span class="n">dhp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">)]</span> <span class="o">=</span> <span class="n">dhp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">)]</span> <span class="o">+</span> <span class="mi">360</span>
    <span class="n">dhp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Cpprod</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">#dH = 2*np.sqrt(Cpprod)*np.sin(dhp/2*np.pi/180)</span>
    <span class="n">dH</span> <span class="o">=</span> <span class="n">deltaH</span><span class="p">(</span><span class="n">dhp</span><span class="p">,</span> <span class="n">Cpprod</span><span class="p">,</span> <span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="c1"># Step 3:</span>
    <span class="n">Lp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Lr</span> <span class="o">+</span> <span class="n">Lt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">Cp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cpr</span> <span class="o">+</span> <span class="n">Cpt</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    
    <span class="n">hps</span> <span class="o">=</span> <span class="n">hpt</span> <span class="o">+</span> <span class="n">hpr</span>
    <span class="n">hp</span> <span class="o">=</span> <span class="p">(</span><span class="n">hpt</span> <span class="o">+</span> <span class="n">hpr</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">hp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hps</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">))]</span> <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hps</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">))]</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="n">hp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hps</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">))]</span> <span class="o">=</span> <span class="n">hp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dhp_</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hps</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">))]</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="n">hp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Cpprod</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">T</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.17</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">hp</span> <span class="o">-</span> <span class="mi">30</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.24</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">hp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="o">+</span>\
        <span class="mf">0.32</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">hp</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="n">hp</span> <span class="o">-</span> <span class="mi">63</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">dtheta</span> <span class="o">=</span> <span class="mi">30</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">hp</span><span class="o">-</span><span class="mi">275</span><span class="p">)</span><span class="o">/</span><span class="mi">25</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">RC</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Cp</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">Cp</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">25</span><span class="o">**</span><span class="mi">7</span><span class="p">)))</span>
    <span class="n">SL</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">((</span><span class="mf">0.015</span><span class="o">*</span><span class="p">(</span><span class="n">Lp</span><span class="o">-</span><span class="mi">50</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="p">(</span><span class="n">Lp</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">SC</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.045</span><span class="o">*</span><span class="n">Cp</span>
    <span class="n">SH</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.015</span><span class="o">*</span><span class="n">Cp</span><span class="o">*</span><span class="n">T</span>
    <span class="n">RT</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dtheta</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">*</span><span class="n">RC</span>

    <span class="n">kL</span><span class="p">,</span> <span class="n">kC</span><span class="p">,</span> <span class="n">kH</span> <span class="o">=</span> <span class="n">KLCH</span>
    
    <span class="n">DEi</span> <span class="o">=</span> <span class="p">((</span><span class="n">dL</span><span class="o">/</span><span class="p">(</span><span class="n">kL</span><span class="o">*</span><span class="n">SL</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="p">,</span> <span class="p">(</span><span class="n">dCp</span><span class="o">/</span><span class="p">(</span><span class="n">kC</span><span class="o">*</span><span class="n">SC</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dH</span><span class="o">/</span><span class="p">(</span><span class="n">kH</span><span class="o">*</span><span class="n">SH</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">RT</span><span class="o">*</span><span class="p">(</span><span class="n">dCp</span><span class="o">/</span><span class="p">(</span><span class="n">kC</span><span class="o">*</span><span class="n">SC</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">dH</span><span class="o">/</span><span class="p">(</span><span class="n">kH</span><span class="o">*</span><span class="n">SH</span><span class="p">)))</span>
    

    <span class="k">return</span> <span class="n">_process_DEi</span><span class="p">(</span><span class="n">DEi</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="n">DEtype</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="p">,</span> <span class="n">avg_axis</span> <span class="o">=</span> <span class="n">avg_axis</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">)</span></div>


<div class="viewcode-block" id="DE_cspace">
<a class="viewcode-back" href="../../../../color.html#luxpy.color.deltaE.DE_cspace">[docs]</a>
<span class="k">def</span> <span class="nf">DE_cspace</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">xyzr</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span><span class="p">,</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">_CSPACE</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="s1">&#39;jab&#39;</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">avg_axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;DEi&#39;</span><span class="p">,</span>
              <span class="n">xyzwt</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">xyzwr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fwtft</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">fwtfr</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">KLCH</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>\
              <span class="n">camtype</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_TYPE</span><span class="p">,</span> <span class="n">ucstype</span> <span class="o">=</span> <span class="s1">&#39;ucs&#39;</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate color difference DE in specific color space.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :xyzt: </span>
<span class="sd">            | ndarray with tristimulus values of test data.</span>
<span class="sd">        :xyzr:</span>
<span class="sd">            | ndarray with tristimulus values of reference data.</span>
<span class="sd">        :dtype:</span>
<span class="sd">            | &#39;xyz&#39; or &#39;jab&#39;, optional</span>
<span class="sd">            | Specifies data type in :xyzt: and :xyzr:.</span>
<span class="sd">        :xyzwt:</span>
<span class="sd">            | None or ndarray, optional</span>
<span class="sd">            |   White point tristimulus values of test data</span>
<span class="sd">            |   None defaults to the one set in :fwtft: </span>
<span class="sd">            |   or else to the default of cspace.</span>
<span class="sd">        :xyzwr:</span>
<span class="sd">            | None or ndarray, optional</span>
<span class="sd">            |   Whitepoint tristimulus values of reference data</span>
<span class="sd">            |    None defaults to the one set in non-empty :fwtfr: </span>
<span class="sd">            |    or else to default of cspace.</span>
<span class="sd">        :tf:</span>
<span class="sd">            | _CSPACE, optional</span>
<span class="sd">            | Color space to use for color difference calculation.</span>
<span class="sd">        :fwtft:</span>
<span class="sd">            | {}, optional</span>
<span class="sd">            | Dict with parameters for forward transform </span>
<span class="sd">              from xyz to cspace for test data.</span>
<span class="sd">        :fwtfr: </span>
<span class="sd">            | {}, optional </span>
<span class="sd">            | Dict with parameters for forward transform </span>
<span class="sd">            | from xyz to cspace for reference data.</span>
<span class="sd">        :KLCH:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | Weigths for L, C, H </span>
<span class="sd">            | None: default to [1,1,1] </span>
<span class="sd">            | KLCH is not used when tf == &#39;camucs&#39;.</span>
<span class="sd">        :DEtype:</span>
<span class="sd">            | &#39;jab&#39; or str, optional</span>
<span class="sd">            | Options: </span>
<span class="sd">            |    - &#39;jab&#39; : calculates full color difference over all 3 dimensions.</span>
<span class="sd">            |    - &#39;ab&#39;  : calculates chromaticity difference.</span>
<span class="sd">            |    - &#39;j&#39;   : calculates lightness or brightness difference </span>
<span class="sd">            |             (depending on :outin:).</span>
<span class="sd">            |    - &#39;j,ab&#39;: calculates both &#39;j&#39; and &#39;ab&#39; options </span>
<span class="sd">            |              and returns them as a tuple.</span>
<span class="sd">        :avg:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | None: don&#39;t calculate average DE, </span>
<span class="sd">            |       otherwise use function handle in :avg:.</span>
<span class="sd">        :avg_axis:</span>
<span class="sd">            | axis to calculate average over, optional</span>
<span class="sd">        :out: </span>
<span class="sd">            | &#39;DEi&#39; or str, optional</span>
<span class="sd">            | Requested output.</span>
<span class="sd">        :camtype: </span>
<span class="sd">            | luxpy.cam._CAM_DEFAULT_TYPE, optional</span>
<span class="sd">            | Str specifier for CAM type to use, options: &#39;ciecam02&#39; or &#39;ciecam16&#39;.</span>
<span class="sd">            | Only when DEtype == &#39;camucs&#39;.</span>
<span class="sd">        :ucstype:</span>
<span class="sd">            | &#39;ucs&#39; or &#39;lcd&#39; or &#39;scd&#39;, optional</span>
<span class="sd">            | Str specifier for which type of color attribute compression </span>
<span class="sd">            | parameters to use:</span>
<span class="sd">            |     -&#39;ucs&#39;: uniform color space,</span>
<span class="sd">            |     -&#39;lcd&#39;, large color differences,</span>
<span class="sd">            |     -&#39;scd&#39;: small color differences</span>
<span class="sd">            | Only when DEtype == &#39;camucs&#39;.</span>
<span class="sd">        </span>
<span class="sd">    Note:</span>
<span class="sd">        For the other input arguments, see specific color space used.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        :returns: </span>
<span class="sd">            | ndarray with DEi [, DEa] or other as specified by :out:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get xyzw from dict if xyzw is None &amp; dict is Not None</span>
    <span class="k">if</span> <span class="n">xyzwr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fwtfr</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyzwr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fwtfr</span><span class="p">):</span>
            <span class="n">xyzwr</span> <span class="o">=</span> <span class="n">fwtfr</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">xyzwt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fwtft</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyzwt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">fwtft</span><span class="p">):</span>
            <span class="n">xyzwt</span> <span class="o">=</span> <span class="n">fwtft</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span>
    
    
    <span class="k">if</span> <span class="n">tf</span> <span class="o">==</span> <span class="s1">&#39;camucs&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fwtfr</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fwtfr</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_WHITE_POINT</span>
            <span class="k">if</span> <span class="n">fwtft</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fwtft</span><span class="p">[</span><span class="s1">&#39;xyzw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">_CAM_DEFAULT_WHITE_POINT</span>
            <span class="n">jabt</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">camXucs</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">camtype</span> <span class="o">=</span> <span class="n">camtype</span><span class="p">,</span> <span class="n">ucstype</span> <span class="o">=</span> <span class="n">ucstype</span><span class="p">,</span> <span class="o">**</span><span class="n">fwtft</span><span class="p">)</span>
            <span class="n">jabr</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">camXucs</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span> <span class="n">camtype</span> <span class="o">=</span> <span class="n">camtype</span><span class="p">,</span> <span class="n">ucstype</span> <span class="o">=</span> <span class="n">ucstype</span><span class="p">,</span> <span class="o">**</span><span class="n">fwtfr</span><span class="p">)</span>

        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jabt</span> <span class="o">=</span> <span class="n">xyzt</span>
            <span class="n">jabr</span> <span class="o">=</span> <span class="n">xyzr</span>
            
        <span class="n">KL</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="p">[</span><span class="n">cam</span><span class="o">.</span><span class="n">_CAM_UCS_PARAMETERS</span><span class="p">[</span><span class="n">camtype</span><span class="p">][</span><span class="n">ucstype</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cam</span><span class="o">.</span><span class="n">_CAM_UCS_PARAMETERS</span><span class="p">[</span><span class="n">camtype</span><span class="p">][</span><span class="n">ucstype</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())]</span>

        <span class="c1"># Calculate color difference and take account of KL:</span>
        <span class="n">DEi</span> <span class="o">=</span> <span class="p">((((</span><span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">KL</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>\
                   <span class="p">((</span><span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
    
    <span class="k">elif</span> <span class="p">(</span><span class="n">tf</span> <span class="o">==</span> <span class="s1">&#39;DE2000&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">tf</span> <span class="o">==</span> <span class="s1">&#39;DE00&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DE2000</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">xyzr</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="n">DEtype</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="p">,</span>\
               <span class="n">avg_axis</span> <span class="o">=</span> <span class="n">avg_axis</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">,</span>
              <span class="n">xyzwt</span> <span class="o">=</span> <span class="n">xyzwt</span><span class="p">,</span> <span class="n">xyzwr</span> <span class="o">=</span> <span class="n">xyzwr</span><span class="p">,</span> <span class="n">KLCH</span> <span class="o">=</span> <span class="n">KLCH</span><span class="p">)</span>

        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
            <span class="c1"># Use colortf:</span>
            <span class="n">jabt</span> <span class="o">=</span> <span class="n">colortf</span><span class="p">(</span><span class="n">xyzt</span><span class="p">,</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">tf</span><span class="p">,</span> <span class="n">fwtf</span> <span class="o">=</span> <span class="n">fwtft</span><span class="p">)</span>
            <span class="n">jabr</span> <span class="o">=</span> <span class="n">colortf</span><span class="p">(</span><span class="n">xyzr</span><span class="p">,</span> <span class="n">tf</span> <span class="o">=</span> <span class="n">tf</span><span class="p">,</span> <span class="n">fwtf</span> <span class="o">=</span> <span class="n">fwtfr</span><span class="p">)</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jabt</span> <span class="o">=</span> <span class="n">xyzt</span>
            <span class="n">jabr</span> <span class="o">=</span> <span class="n">xyzr</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="n">KLCH</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">KLCH</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># Calculate color difference and take account of KL:</span>
            <span class="n">DEi</span> <span class="o">=</span> <span class="p">(((</span><span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>\
                   <span class="p">((</span><span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
        
        <span class="k">else</span><span class="p">:</span> <span class="c1">#using LCH specification for use with KLCH weights:</span>
            <span class="n">Jt</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">at</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">jabt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">Ct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">at</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">bt</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ht</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">hue_angle</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">bt</span><span class="p">,</span><span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;rad&#39;</span><span class="p">)</span>
            
            <span class="n">Jr</span> <span class="o">=</span> <span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">jabr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ar</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">br</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">cam</span><span class="o">.</span><span class="n">hue_angle</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">bt</span><span class="p">,</span><span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;rad&#39;</span><span class="p">)</span>
            
            <span class="n">dJ</span> <span class="o">=</span> <span class="n">Jt</span> <span class="o">-</span> <span class="n">Jr</span>
            <span class="n">dC</span> <span class="o">=</span> <span class="n">Ct</span> <span class="o">-</span> <span class="n">Cr</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="n">ht</span> <span class="o">-</span> <span class="n">hr</span>
            <span class="n">DEab2</span> <span class="o">=</span> <span class="p">((</span><span class="n">at</span><span class="o">-</span><span class="n">ar</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">bt</span><span class="o">-</span><span class="n">br</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">DEab2</span> <span class="o">-</span> <span class="n">dC</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
            <span class="n">DEi</span> <span class="o">=</span> <span class="p">((</span><span class="n">dJ</span><span class="o">/</span><span class="n">KLCH</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">dC</span><span class="o">/</span><span class="n">KLCH</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">dH</span><span class="o">/</span><span class="n">KLCH</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">_process_DEi</span><span class="p">(</span><span class="n">DEi</span><span class="p">,</span> <span class="n">DEtype</span> <span class="o">=</span> <span class="n">DEtype</span><span class="p">,</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span><span class="p">,</span> <span class="n">avg_axis</span> <span class="o">=</span> <span class="n">avg_axis</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">)</span></div>



</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kevin A.G. Smet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>