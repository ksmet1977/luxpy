

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>luxpy.color.ctf.colortransforms &mdash; LuxPy 1.3.5 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> LuxPy
          

          
          </a>

          
            
            
              <div class="version">
                1.3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License: GPLv3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../required_packages.html">Imported (required) packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../luxpy_structure.html">Luxpy package structure</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">LuxPy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>luxpy.color.ctf.colortransforms</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for luxpy.color.ctf.colortransforms</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">########################################################################</span>
<span class="c1"># &lt;LUXPY: a Python package for lighting and color science.&gt;</span>
<span class="c1"># Copyright (C) &lt;2017&gt;  &lt;Kevin A.G. Smet&gt; (ksmet1977 at gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#########################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module with functions related to basic colorimetry</span>
<span class="sd">==================================================</span>

<span class="sd">Note</span>
<span class="sd">----</span>

<span class="sd">  Note that colorimetric data is always located in the last axis</span>
<span class="sd">  of the data arrays. (See also xyz specification in __doc__ string</span>
<span class="sd">  of luxpy.spd_to_xyz())</span>

<span class="sd">colortransforms.py</span>
<span class="sd">------------------</span>


<span class="sd">  * _CSPACE_AXES: dict with list[str,str,str] containing axis labels</span>
<span class="sd">                of defined cspaces</span>


<span class="sd">Chromaticity / colorspace functions</span>
<span class="sd">+++++++++++++++++++++++++++++++++++</span>

<span class="sd">  | * xyz_to_Yxy(), Yxy_to_xyz(): (X,Y,Z) &lt;-&gt; (Y,x,y);</span>
<span class="sd">  | * xyz_to_Yuv(), Yuv_to_Yxy(): (X,Y,Z) &lt;-&gt; CIE 1976 (Y,u&#39;,v&#39;);</span>
<span class="sd">  | * xyz_to_xyz(), lms_to_xyz(): (X,Y,Z) &lt;-&gt; (X,Y,Z); for use with colortf()</span>
<span class="sd">  | * xyz_to_lms(), lms_to_xyz(): (X,Y,Z) &lt;-&gt; (L,M,S) cone fundamental responses</span>
<span class="sd">  | * xyz_to_lab(), lab_to_xyz(): (X,Y,Z) &lt;-&gt; CIE 1976 (L*,a*,b*)</span>
<span class="sd">  | * xyz_to_luv(), luv_to_xyz(): (X,Y,Z) &lt;-&gt; CIE 1976 (L*,u*,v*)</span>
<span class="sd">  | * xyz_to_Vrb_mb(),Vrb_mb_to_xyz(): (X,Y,Z) &lt;-&gt; (V,r,b); [Macleod &amp; Boyton, 1979]</span>
<span class="sd">  | * xyz_to_ipt(), ipt_to_xyz(): (X,Y,Z) &lt;-&gt; (I,P,T); [Ebner et al, 1998]</span>
<span class="sd">  | * xyz_to_Ydlep(), Ydlep_to_xyz(): (X,Y,Z) &lt;-&gt; (Y,dl, ep); </span>
<span class="sd">  |                   Y, dominant wavelength (dl) and excitation purity (ep)</span>
<span class="sd">  | * xyz_to_srgb(), srgb_to_xyz(): (X,Y,Z) &lt;-&gt; sRGB; (IEC:61966 sRGB)</span>


<span class="sd">References</span>
<span class="sd">----------</span>

<span class="sd">    1. `CIE15-2004 (2004). Colorimetry (Vienna, Austria: CIE) &lt;http://www.cie.co.at/index.php/index.php?i_ca_id=304&gt;`_</span>

<span class="sd">    2. `Ebner F, and Fairchild MD (1998).</span>
<span class="sd">       Development and testing of a color space (IPT) with improved hue uniformity.</span>
<span class="sd">       In IS&amp;T 6th Color Imaging Conference, (Scottsdale, Arizona, USA), pp. 8–13.</span>
<span class="sd">       &lt;http://www.ingentaconnect.com/content/ist/cic/1998/00001998/00000001/art00003?crawler=true&gt;`_</span>

<span class="sd">    3. `MacLeod DI, and Boynton RM (1979).</span>
<span class="sd">       Chromaticity diagram showing cone excitation by stimuli of equal luminance.</span>
<span class="sd">       J. Opt. Soc. Am. 69, 1183–1186.</span>
<span class="sd">       &lt;https://www.osapublishing.org/josa/abstract.cfm?uri=josa-69-8-1183&gt;`_</span>


<span class="sd">.. codeauthor:: Kevin A.G. Smet (ksmet1977 at gmail.com)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">------------------------------------------------------------------------------</span>
<span class="sd">Created on Wed Jun 28 22:48:09 2017</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">luxpy</span> <span class="k">import</span> <span class="n">np</span><span class="p">,</span> <span class="n">_CMF</span><span class="p">,</span> <span class="n">_CIE_ILLUMINANTS</span><span class="p">,</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">_CSPACE</span><span class="p">,</span> <span class="n">math</span><span class="p">,</span> <span class="n">spd_to_xyz</span><span class="p">,</span> <span class="n">np2d</span><span class="p">,</span> <span class="n">np2dT</span><span class="p">,</span> <span class="n">np3d</span><span class="p">,</span> <span class="n">todim</span><span class="p">,</span> <span class="n">asplit</span><span class="p">,</span> <span class="n">ajoin</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_CSPACE_AXES&#39;</span><span class="p">,</span> <span class="s1">&#39;_IPT_M&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_Yxy&#39;</span><span class="p">,</span><span class="s1">&#39;Yxy_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_Yuv&#39;</span><span class="p">,</span><span class="s1">&#39;Yuv_to_xyz&#39;</span><span class="p">,</span>
           <span class="s1">&#39;xyz_to_wuv&#39;</span><span class="p">,</span><span class="s1">&#39;wuv_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_lms&#39;</span><span class="p">,</span> <span class="s1">&#39;lms_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_lab&#39;</span><span class="p">,</span><span class="s1">&#39;lab_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_luv&#39;</span><span class="p">,</span><span class="s1">&#39;luv_to_xyz&#39;</span><span class="p">,</span>
           <span class="s1">&#39;xyz_to_Vrb_mb&#39;</span><span class="p">,</span><span class="s1">&#39;Vrb_mb_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_ipt&#39;</span><span class="p">,</span><span class="s1">&#39;ipt_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_Ydlep&#39;</span><span class="p">,</span><span class="s1">&#39;Ydlep_to_xyz&#39;</span><span class="p">,</span><span class="s1">&#39;xyz_to_srgb&#39;</span><span class="p">,</span><span class="s1">&#39;srgb_to_xyz&#39;</span><span class="p">]</span>

<span class="c1">#------------------------------------------------------------------------------</span>
<span class="c1"># Database with cspace-axis strings (for plotting):</span>
<span class="n">_CSPACE_AXES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Yxy&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Y / L (cd/m²)&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]}</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;Yuv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Y / L (cd/m²)&#39;</span><span class="p">,</span> <span class="s2">&quot;u&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;v&#39;&quot;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;xyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;lms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;lab&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L*&#39;</span><span class="p">,</span> <span class="s2">&quot;a*&quot;</span><span class="p">,</span> <span class="s2">&quot;b*&quot;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;luv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L*&#39;</span><span class="p">,</span> <span class="s2">&quot;u*&quot;</span><span class="p">,</span> <span class="s2">&quot;u*&quot;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;ipt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="s2">&quot;T&quot;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;wuv&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;W*&#39;</span><span class="p">,</span> <span class="s2">&quot;U*&quot;</span><span class="p">,</span> <span class="s2">&quot;V*&quot;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;Vrb_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;V (Macleod-Boyton)&#39;</span><span class="p">,</span> <span class="s2">&quot;r (Macleod-Boyton)&quot;</span><span class="p">,</span> <span class="s2">&quot;b (Macleod-Boyton)&quot;</span><span class="p">]</span>
<span class="n">_CSPACE_AXES</span><span class="p">[</span><span class="s1">&#39;cct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;cct&#39;</span><span class="p">,</span><span class="s1">&#39;duv&#39;</span><span class="p">]</span>


<span class="c1"># pre-calculate matrices for conversion of xyz to lms and back for use in xyz_to_ipt() and ipt_to_xyz():</span>
<span class="n">_IPT_M</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lms2ipt&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.4000</span><span class="p">,</span><span class="mf">0.4000</span><span class="p">,</span><span class="mf">0.2000</span><span class="p">],[</span><span class="mf">4.4550</span><span class="p">,</span><span class="o">-</span><span class="mf">4.8510</span><span class="p">,</span><span class="mf">0.3960</span><span class="p">],[</span><span class="mf">0.8056</span><span class="p">,</span><span class="mf">0.3572</span><span class="p">,</span><span class="o">-</span><span class="mf">1.1628</span><span class="p">]]),</span>
                              <span class="s1">&#39;xyz2lms&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="n">x</span> <span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">normalize_3x3_matrix</span><span class="p">(</span><span class="n">_CMF</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;M&#39;</span><span class="p">],</span><span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">_CIE_ILLUMINANTS</span><span class="p">[</span><span class="s1">&#39;D65&#39;</span><span class="p">],</span><span class="n">cieobs</span> <span class="o">=</span> <span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">_CMF</span><span class="p">[</span><span class="s1">&#39;types&#39;</span><span class="p">])}}</span>
<span class="n">_COLORTF_DEFAULT_WHITE_POINT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">])</span> <span class="c1"># ill. E white point</span>

<span class="c1">#------------------------------------------------------------------------------</span>
<span class="c1">#---chromaticity coordinates---------------------------------------------------</span>
<span class="c1">#------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="xyz_to_Yxy"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_Yxy">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_Yxy</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values CIE Yxy chromaticity values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>

<span class="sd">    Returns:</span>
<span class="sd">        :Yxy: </span>
<span class="sd">            | ndarray with Yxy chromaticity values</span>
<span class="sd">              (Y value refers to luminance or luminance factor)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">sumxyz</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="n">Y</span> <span class="o">+</span> <span class="n">Z</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="n">sumxyz</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">/</span> <span class="n">sumxyz</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">Y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span></div>


<div class="viewcode-block" id="Yxy_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.Yxy_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">Yxy_to_xyz</span><span class="p">(</span><span class="n">Yxy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert CIE Yxy chromaticity values to XYZ tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :Yxy: </span>
<span class="sd">            | ndarray with Yxy chromaticity values</span>
<span class="sd">              (Y value refers to luminance or luminance factor)</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Yxy</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">Yxy</span><span class="p">)</span>

    <span class="n">Y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yxy</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">y</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">y</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span></div>

<div class="viewcode-block" id="xyz_to_Yuv"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_Yuv">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_Yuv</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values CIE 1976 Yu&#39;v&#39; chromaticity values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>

<span class="sd">    Returns:</span>
<span class="sd">        :Yuv: </span>
<span class="sd">            | ndarray with CIE 1976 Yu&#39;v&#39; chromaticity values</span>
<span class="sd">              (Y value refers to luminance or luminance factor)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">X</span> <span class="o">+</span> <span class="mf">15.0</span><span class="o">*</span><span class="n">Y</span> <span class="o">+</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">Z</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">X</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mf">9.0</span><span class="o">*</span><span class="n">Y</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">Y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">))</span></div>


<div class="viewcode-block" id="Yuv_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.Yuv_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">Yuv_to_xyz</span><span class="p">(</span><span class="n">Yuv</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert CIE 1976 Yu&#39;v&#39; chromaticity values to XYZ tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :Yuv: </span>
<span class="sd">            | ndarray with CIE 1976 Yu&#39;v&#39; chromaticity values</span>
<span class="sd">              (Y value refers to luminance or luminance factor)</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Yuv</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">Yuv</span><span class="p">)</span>

    <span class="n">Y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yuv</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="p">(</span><span class="mf">9.0</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="p">(</span><span class="mf">12.0</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="n">u</span> <span class="o">-</span> <span class="mf">20.0</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span></div>


<div class="viewcode-block" id="xyz_to_wuv"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_wuv">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_wuv</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">_COLORTF_DEFAULT_WHITE_POINT</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values CIE 1964 U*V*W* color space.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">        :xyzw: </span>
<span class="sd">            | ndarray with tristimulus values of white point, optional</span>
<span class="sd">              (Defaults to luxpy._COLORTF_DEFAULT_WHITE_POINT)</span>

<span class="sd">    Returns:</span>
<span class="sd">        :wuv: </span>
<span class="sd">            | ndarray with W*U*V* values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="n">xyzw</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyzw</span><span class="p">)</span>
    <span class="n">Yuv</span> <span class="o">=</span> <span class="n">xyz_to_Yuv</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="c1"># convert to cie 1976 u&#39;v&#39;</span>
    <span class="n">Yuvw</span> <span class="o">=</span> <span class="n">xyz_to_Yuv</span><span class="p">(</span><span class="n">xyzw</span><span class="p">)</span>
    <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yuv</span><span class="p">)</span>
    <span class="n">Yw</span><span class="p">,</span> <span class="n">uw</span><span class="p">,</span> <span class="n">vw</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yuvw</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">v</span> <span class="c1"># convert to cie 1960 u, v</span>
    <span class="n">vw</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">vw</span> <span class="c1"># convert to cie 1960 u, v</span>
    <span class="n">W</span> <span class="o">=</span> <span class="mf">25.0</span><span class="o">*</span><span class="p">(</span><span class="n">Y</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="mf">17.0</span>
    <span class="n">U</span> <span class="o">=</span> <span class="mf">13.0</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">uw</span><span class="p">)</span>
    <span class="n">V</span> <span class="o">=</span> <span class="mf">13.0</span><span class="o">*</span><span class="n">W</span><span class="o">*</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">vw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">W</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">V</span><span class="p">))</span></div>

<div class="viewcode-block" id="wuv_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.wuv_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">wuv_to_xyz</span><span class="p">(</span><span class="n">wuv</span><span class="p">,</span><span class="n">xyzw</span> <span class="o">=</span> <span class="n">_COLORTF_DEFAULT_WHITE_POINT</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert CIE 1964 U*V*W* color space coordinates to XYZ tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :wuv: </span>
<span class="sd">            | ndarray with W*U*V* values</span>
<span class="sd">        :xyzw: </span>
<span class="sd">            | ndarray with tristimulus values of white point, optional</span>
<span class="sd">              (Defaults to luxpy._COLORTF_DEFAULT_WHITE_POINT)</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">	 &quot;&quot;&quot;</span>
    <span class="n">wuv</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">wuv</span><span class="p">)</span>
    <span class="n">xyzw</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyzw</span><span class="p">)</span>

    <span class="n">Yuvw</span> <span class="o">=</span> <span class="n">xyz_to_Yuv</span><span class="p">(</span><span class="n">xyzw</span><span class="p">)</span> <span class="c1"># convert to cie 1976 u&#39;v&#39;</span>
    <span class="n">Yw</span><span class="p">,</span> <span class="n">uw</span><span class="p">,</span> <span class="n">vw</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yuvw</span><span class="p">)</span>
    <span class="n">vw</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">vw</span> <span class="c1"># convert to cie 1960 u, v</span>
    <span class="n">W</span><span class="p">,</span><span class="n">U</span><span class="p">,</span><span class="n">V</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">wuv</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="p">((</span><span class="n">W</span> <span class="o">+</span> <span class="mf">17.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">25.0</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">uw</span> <span class="o">+</span> <span class="n">U</span><span class="o">/</span><span class="p">(</span><span class="mf">13.0</span><span class="o">*</span><span class="n">W</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">vw</span> <span class="o">+</span> <span class="n">V</span><span class="o">/</span><span class="p">(</span><span class="mf">13.0</span><span class="o">*</span><span class="n">W</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">Yuv</span> <span class="o">=</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">Y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">))</span> <span class="c1"># = 1976 u&#39;,v&#39;</span>
    <span class="k">return</span> <span class="n">Yuv_to_xyz</span><span class="p">(</span><span class="n">Yuv</span><span class="p">)</span></div>


<div class="viewcode-block" id="xyz_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to XYZ tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span></div>


<div class="viewcode-block" id="xyz_to_lms"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_lms">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_lms</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to LMS cone fundamental responses.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">        :cieobs: </span>
<span class="sd">            | _CIEOBS or str, optional</span>
<span class="sd">        :M: </span>
<span class="sd">            | None, optional</span>
<span class="sd">            | Conversion matrix for xyz to lms.</span>
<span class="sd">            |   If None: use the one defined by :cieobs:</span>

<span class="sd">    Returns:</span>
<span class="sd">        :lms: </span>
<span class="sd">            | ndarray with LMS cone fundamental responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">_CMF</span><span class="p">[</span><span class="n">cieobs</span><span class="p">][</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>

    <span class="c1"># convert xyz to lms:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">lms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lms</span></div>


<div class="viewcode-block" id="lms_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.lms_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">lms_to_xyz</span><span class="p">(</span><span class="n">lms</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert LMS cone fundamental responses to XYZ tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :lms: </span>
<span class="sd">            | ndarray with LMS cone fundamental responses</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | _CIEOBS or str, optional</span>
<span class="sd">        :M: </span>
<span class="sd">            | None, optional</span>
<span class="sd">            | Conversion matrix for xyz to lms.</span>
<span class="sd">            |   If None: use the one defined by :cieobs:</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lms</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">lms</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">_CMF</span><span class="p">[</span><span class="n">cieobs</span><span class="p">][</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>

    <span class="c1"># convert from lms to xyz:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">lms</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">lms</span><span class="p">)</span></div>




<div class="viewcode-block" id="xyz_to_lab"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_lab">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_lab</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to CIE 1976 L*a*b* (CIELAB) coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">        :xyzw:</span>
<span class="sd">            | None or ndarray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating xyzw.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :lab: </span>
<span class="sd">            | ndarray with CIE 1976 L*a*b* (CIELAB) color coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xyzw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xyzw</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">_CIE_ILLUMINANTS</span><span class="p">[</span><span class="s1">&#39;D65&#39;</span><span class="p">],</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)</span>

    <span class="c1"># get and normalize (X,Y,Z) to white point:</span>
    <span class="n">XYZr</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">/</span><span class="n">xyzw</span>

    <span class="c1"># Apply cube-root compression:</span>
    <span class="n">fXYZr</span> <span class="o">=</span> <span class="n">XYZr</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span>

    <span class="c1"># Check for T/Tn &lt;= 0.008856: (Note (24/116)**3 = 0.008856)</span>
    <span class="n">pqr</span> <span class="o">=</span> <span class="n">XYZr</span><span class="o">&lt;=</span><span class="p">(</span><span class="mi">24</span><span class="o">/</span><span class="mi">116</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>

    <span class="c1"># calculate f(T) for T/Tn &lt;= 0.008856: (Note:(1/3)*((116/24)**2) = 841/108 = 7.787)</span>
    <span class="n">fXYZr</span><span class="p">[</span><span class="n">pqr</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">841</span><span class="o">/</span><span class="mi">108</span><span class="p">)</span><span class="o">*</span><span class="n">XYZr</span><span class="p">[</span><span class="n">pqr</span><span class="p">]</span><span class="o">+</span><span class="mf">16.0</span><span class="o">/</span><span class="mf">116.0</span><span class="p">)</span>

    <span class="c1"># calculate L*, a*, b*:</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">116.0</span><span class="o">*</span><span class="p">(</span><span class="n">fXYZr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="mf">16.0</span>
    <span class="n">L</span><span class="p">[</span><span class="n">pqr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">903.3</span><span class="o">*</span><span class="n">XYZr</span><span class="p">[</span><span class="n">pqr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mf">500.0</span><span class="o">*</span><span class="p">(</span><span class="n">fXYZr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">fXYZr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mf">200.0</span><span class="o">*</span><span class="p">(</span><span class="n">fXYZr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fXYZr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">L</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span></div>


<div class="viewcode-block" id="lab_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.lab_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">lab_to_xyz</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert CIE 1976 L*a*b* (CIELAB) color coordinates to XYZ tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :lab: </span>
<span class="sd">            | ndarray with CIE 1976 L*a*b* (CIELAB) color coordinates</span>
<span class="sd">        :xyzw:</span>
<span class="sd">            | None or ndarray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating xyzw.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lab</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xyzw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xyzw</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">_CIE_ILLUMINANTS</span><span class="p">[</span><span class="s1">&#39;D65&#39;</span><span class="p">],</span><span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)</span>

    <span class="c1"># make xyzw same shape as data:</span>
    <span class="n">xyzw</span> <span class="o">=</span> <span class="n">xyzw</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lab</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># set knee point of function:</span>
    <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">24</span><span class="o">/</span><span class="mi">116</span><span class="p">)</span> <span class="c1">#(24/116)**3**(1/3)</span>

    <span class="c1"># get L*, a*, b* and Xw, Yw, Zw:</span>
    <span class="n">L</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">Xw</span><span class="p">,</span><span class="n">Yw</span><span class="p">,</span><span class="n">Zw</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">xyzw</span><span class="p">)</span>

    <span class="n">fy</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="mf">16.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">116.0</span>
    <span class="n">fx</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="mf">500.0</span> <span class="o">+</span> <span class="n">fy</span>
    <span class="n">fz</span> <span class="o">=</span> <span class="n">fy</span> <span class="o">-</span> <span class="n">b</span><span class="o">/</span><span class="mf">200.0</span>

    <span class="c1"># apply 3rd power:</span>
    <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">xw</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">3.0</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xw</span><span class="p">)</span> <span class="ow">in</span> <span class="p">((</span><span class="n">fx</span><span class="p">,</span><span class="n">Xw</span><span class="p">),(</span><span class="n">fy</span><span class="p">,</span><span class="n">Yw</span><span class="p">),(</span><span class="n">fz</span><span class="p">,</span><span class="n">Zw</span><span class="p">))]</span>

    <span class="c1"># Now calculate T where T/Tn is below the knee point:</span>
    <span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">fx</span><span class="p">,</span><span class="n">fy</span><span class="p">,</span><span class="n">fz</span><span class="p">)]</span>
    <span class="n">X</span><span class="p">[</span><span class="n">p</span><span class="p">],</span><span class="n">Y</span><span class="p">[</span><span class="n">q</span><span class="p">],</span><span class="n">Z</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">xw</span><span class="p">[</span><span class="n">xp</span><span class="p">]</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">xp</span><span class="p">]</span> <span class="o">-</span> <span class="mf">16.0</span><span class="o">/</span><span class="mf">116.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">841</span><span class="o">/</span><span class="mi">108</span><span class="p">)))</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xw</span><span class="p">,</span><span class="n">xp</span><span class="p">)</span> <span class="ow">in</span> <span class="p">((</span><span class="n">fx</span><span class="p">,</span><span class="n">Xw</span><span class="p">,</span><span class="n">p</span><span class="p">),(</span><span class="n">fy</span><span class="p">,</span><span class="n">Yw</span><span class="p">,</span><span class="n">q</span><span class="p">),(</span><span class="n">fz</span><span class="p">,</span><span class="n">Zw</span><span class="p">,</span><span class="n">r</span><span class="p">))]</span>

    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span></div>



<div class="viewcode-block" id="xyz_to_luv"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_luv">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_luv</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to CIE 1976 L*u*v* (CIELUV) coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">        :xyzw:</span>
<span class="sd">            | None or ndarray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating xyzw.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :luv: </span>
<span class="sd">            | ndarray with CIE 1976 L*u*v* (CIELUV) color coordinates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xyzw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xyzw</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">_CIE_ILLUMINANTS</span><span class="p">[</span><span class="s1">&#39;D65&#39;</span><span class="p">],</span><span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)</span>

    <span class="c1"># make xyzw same shape as xyz:</span>
    <span class="n">xyzw</span> <span class="o">=</span> <span class="n">todim</span><span class="p">(</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># Calculate u&#39;,v&#39; of test and white:</span>
    <span class="n">Y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">xyz_to_Yuv</span><span class="p">(</span><span class="n">xyz</span><span class="p">))</span>
    <span class="n">Yw</span><span class="p">,</span><span class="n">uw</span><span class="p">,</span><span class="n">vw</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">xyz_to_Yuv</span><span class="p">(</span><span class="n">xyzw</span><span class="p">))</span>

    <span class="c1">#uv1976 to CIELUV</span>
    <span class="n">YdivYw</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">/</span> <span class="n">Yw</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">116.0</span><span class="o">*</span><span class="n">YdivYw</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">16.0</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">YdivYw</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mf">6.0</span><span class="o">/</span><span class="mf">29.0</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="n">L</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mf">29.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">YdivYw</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">13.0</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">-</span><span class="n">uw</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="mf">13.0</span><span class="o">*</span><span class="n">L</span><span class="o">*</span><span class="p">(</span><span class="n">v</span><span class="o">-</span><span class="n">vw</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">L</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">))</span></div>


<div class="viewcode-block" id="luv_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.luv_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">luv_to_xyz</span><span class="p">(</span><span class="n">luv</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert CIE 1976 L*u*v* (CIELUVB) coordinates to XYZ tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :luv: </span>
<span class="sd">            | ndarray with CIE 1976 L*u*v* (CIELUV) color coordinates</span>
<span class="sd">        :xyzw:</span>
<span class="sd">            | None or ndarray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs: </span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating xyzw.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">luv</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">luv</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">xyzw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xyzw</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">_CIE_ILLUMINANTS</span><span class="p">[</span><span class="s1">&#39;D65&#39;</span><span class="p">],</span><span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)</span>

    <span class="c1"># Make xyzw same shape as luv:</span>
    <span class="n">Yuvw</span> <span class="o">=</span> <span class="n">todim</span><span class="p">(</span><span class="n">xyz_to_Yuv</span><span class="p">(</span><span class="n">xyzw</span><span class="p">),</span> <span class="n">luv</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">equal_shape</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Get Yw, uw,vw:</span>
    <span class="n">Yw</span><span class="p">,</span><span class="n">uw</span><span class="p">,</span><span class="n">vw</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yuvw</span><span class="p">)</span>

    <span class="c1"># calculate u&#39;v&#39; from u*,v*:</span>
    <span class="n">L</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">luv</span><span class="p">)</span>
    <span class="n">up</span><span class="p">,</span><span class="n">vp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">13</span><span class="o">*</span><span class="n">L</span><span class="p">))</span> <span class="o">+</span> <span class="n">xw</span> <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xw</span><span class="p">)</span> <span class="ow">in</span> <span class="p">((</span><span class="n">u</span><span class="p">,</span><span class="n">uw</span><span class="p">),(</span><span class="n">v</span><span class="p">,</span><span class="n">vw</span><span class="p">))]</span>
    <span class="n">up</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">L</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">vp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">L</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">fy</span> <span class="o">=</span> <span class="p">(</span><span class="n">L</span> <span class="o">+</span> <span class="mf">16.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">116.0</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Yw</span><span class="o">*</span><span class="p">(</span><span class="n">fy</span><span class="o">**</span><span class="mf">3.0</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Y</span><span class="o">/</span><span class="n">Yw</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">((</span><span class="mf">6.0</span><span class="o">/</span><span class="mf">29.0</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0</span><span class="p">))</span>
    <span class="n">Y</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">Yw</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="mf">29.0</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">**</span><span class="mf">3.0</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">Yuv_to_xyz</span><span class="p">(</span><span class="n">ajoin</span><span class="p">((</span><span class="n">Y</span><span class="p">,</span><span class="n">up</span><span class="p">,</span><span class="n">vp</span><span class="p">)))</span></div>


<span class="c1">#-------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="xyz_to_Vrb_mb"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_Vrb_mb">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_Vrb_mb</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">scaling</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">M</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to V,r,b (Macleod-Boynton) color coordinates.</span>

<span class="sd">    | Macleod Boynton: V = R+G, r = R/V, b = B/V</span>
<span class="sd">    | Note that R,G,B ~ L,M,S</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">        :cieobs: </span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when getting the default M, which is</span>
<span class="sd">              the xyz to lms conversion matrix.</span>
<span class="sd">        :scaling:</span>
<span class="sd">            | list of scaling factors for r and b dimensions.</span>
<span class="sd">        :M: </span>
<span class="sd">            | None, optional</span>
<span class="sd">            | Conversion matrix for going from XYZ to RGB (LMS)</span>
<span class="sd">            |   If None, :cieobs: determines the M (function does inversion)</span>

<span class="sd">    Returns:</span>
<span class="sd">        :Vrb: </span>
<span class="sd">            | ndarray with V,r,b (Macleod-Boynton) color coordinates</span>

<span class="sd">    Reference:</span>
<span class="sd">        1. `MacLeod DI, and Boynton RM (1979).</span>
<span class="sd">           Chromaticity diagram showing cone excitation by stimuli of equal luminance.</span>
<span class="sd">           J. Opt. Soc. Am. 69, 1183–1186.</span>
<span class="sd">           &lt;https://www.osapublishing.org/josa/abstract.cfm?uri=josa-69-8-1183&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">_CMF</span><span class="p">[</span><span class="n">cieobs</span><span class="p">][</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>
    <span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">X</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">Z</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">R</span> <span class="o">+</span> <span class="n">G</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">R</span> <span class="o">/</span> <span class="n">V</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">B</span> <span class="o">/</span> <span class="n">V</span> <span class="o">*</span> <span class="n">scaling</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">V</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">b</span><span class="p">))</span></div>


<div class="viewcode-block" id="Vrb_mb_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.Vrb_mb_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">Vrb_mb_to_xyz</span><span class="p">(</span><span class="n">Vrb</span><span class="p">,</span><span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">scaling</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">M</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Minverted</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert V,r,b (Macleod-Boynton) color coordinates to XYZ tristimulus values.</span>

<span class="sd">    | Macleod Boynton: V = R+G, r = R/V, b = B/V</span>
<span class="sd">    | Note that R,G,B ~ L,M,S</span>

<span class="sd">    Args:</span>
<span class="sd">        :Vrb: </span>
<span class="sd">            | ndarray with V,r,b (Macleod-Boynton) color coordinates</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when getting the default M, which is</span>
<span class="sd">              the xyz to lms conversion matrix.</span>
<span class="sd">        :scaling:</span>
<span class="sd">            | list of scaling factors for r and b dimensions.</span>
<span class="sd">        :M: </span>
<span class="sd">            | None, optional</span>
<span class="sd">            | Conversion matrix for going from XYZ to RGB (LMS)</span>
<span class="sd">            |   If None, :cieobs: determines the M (function does inversion)</span>
<span class="sd">        :Minverted:</span>
<span class="sd">            | False, optional</span>
<span class="sd">            | Bool that determines whether M should be inverted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>

<span class="sd">    Reference:</span>
<span class="sd">        1. `MacLeod DI, and Boynton RM (1979).</span>
<span class="sd">           Chromaticity diagram showing cone excitation by stimuli of equal luminance.</span>
<span class="sd">           J. Opt. Soc. Am. 69, 1183–1186.</span>
<span class="sd">           &lt;https://www.osapublishing.org/josa/abstract.cfm?uri=josa-69-8-1183&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Vrb</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">Vrb</span><span class="p">)</span>

    <span class="n">V</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Vrb</span><span class="p">)</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">V</span> <span class="o">/</span> <span class="n">scaling</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">V</span> <span class="o">/</span> <span class="n">scaling</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">V</span><span class="o">-</span><span class="n">R</span>
    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">_CMF</span><span class="p">[</span><span class="n">cieobs</span><span class="p">][</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">Minverted</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">G</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">B</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">ajoin</span><span class="p">((</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span></div>


<div class="viewcode-block" id="xyz_to_ipt"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_ipt">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_ipt</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to IPT color coordinates.</span>

<span class="sd">    | I: Lightness axis, P, red-green axis, T: yellow-blue axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">        :xyzw: </span>
<span class="sd">            | None or ndarray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating xyzw for rescaling M</span>
<span class="sd">              (only when not None).</span>
<span class="sd">        :M: | None, optional</span>
<span class="sd">            | None defaults to xyz to lms conversion matrix determined by :cieobs:</span>

<span class="sd">    Returns:</span>
<span class="sd">        :ipt: </span>
<span class="sd">            | ndarray with IPT color coordinates</span>

<span class="sd">    Note:</span>
<span class="sd">        :xyz: is assumed to be under D65 viewing conditions! If necessary </span>
<span class="sd">              perform chromatic adaptation !</span>

<span class="sd">    Reference:</span>
<span class="sd">        1. `Ebner F, and Fairchild MD (1998).</span>
<span class="sd">           Development and testing of a color space (IPT) with improved hue uniformity.</span>
<span class="sd">           In IS&amp;T 6th Color Imaging Conference, (Scottsdale, Arizona, USA), pp. 8–13.</span>
<span class="sd">           &lt;http://www.ingentaconnect.com/content/ist/cic/1998/00001998/00000001/art00003?crawler=true&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="c1"># get M to convert xyz to lms and apply normalization to matrix or input your own:</span>
    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">_IPT_M</span><span class="p">[</span><span class="s1">&#39;xyz2lms&#39;</span><span class="p">][</span><span class="n">cieobs</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># matrix conversions from xyz to lms</span>
        <span class="k">if</span> <span class="n">xyzw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyzw</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">_CIE_ILLUMINANTS</span><span class="p">[</span><span class="s1">&#39;D65&#39;</span><span class="p">],</span><span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyzw</span> <span class="o">=</span> <span class="n">xyzw</span><span class="o">/</span><span class="mf">100.0</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">normalize_3x3_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">xyzw</span><span class="p">)</span>

    <span class="c1"># get xyz and normalize to 1:</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">/</span><span class="mf">100.0</span>

    <span class="c1"># convert xyz to lms:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">lms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
    <span class="c1">#lms = np.dot(M,xyz.T).T</span>

    <span class="c1">#response compression: lms to lms&#39;</span>
    <span class="n">lmsp</span> <span class="o">=</span> <span class="n">lms</span><span class="o">**</span><span class="mf">0.43</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lms</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">lmsp</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lms</span><span class="p">[</span><span class="n">p</span><span class="p">])</span><span class="o">**</span><span class="mf">0.43</span>

    <span class="c1"># convert lms&#39; to ipt coordinates:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ipt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">_IPT_M</span><span class="p">[</span><span class="s1">&#39;lms2ipt&#39;</span><span class="p">],</span> <span class="n">lmsp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ipt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">_IPT_M</span><span class="p">[</span><span class="s1">&#39;lms2ipt&#39;</span><span class="p">],</span> <span class="n">lmsp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ipt</span></div>

<div class="viewcode-block" id="ipt_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.ipt_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">ipt_to_xyz</span><span class="p">(</span><span class="n">ipt</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to IPT color coordinates.</span>

<span class="sd">    | I: Lightness axis, P, red-green axis, T: yellow-blue axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        :ipt: </span>
<span class="sd">            | ndarray with IPT color coordinates</span>
<span class="sd">        :xyzw:</span>
<span class="sd">            | None or ndarray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating xyzw for rescaling Mxyz2lms</span>
<span class="sd">              (only when not None).</span>
<span class="sd">        :M: | None, optional</span>
<span class="sd">            | None defaults to xyz to lms conversion matrix determined by:cieobs:</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>

<span class="sd">    Note:</span>
<span class="sd">        :xyz: is assumed to be under D65 viewing conditions! If necessary </span>
<span class="sd">              perform chromatic adaptation !</span>

<span class="sd">    Reference:</span>
<span class="sd">        1. `Ebner F, and Fairchild MD (1998).</span>
<span class="sd">           Development and testing of a color space (IPT) with improved hue uniformity.</span>
<span class="sd">           In IS&amp;T 6th Color Imaging Conference, (Scottsdale, Arizona, USA), pp. 8–13.</span>
<span class="sd">           &lt;http://www.ingentaconnect.com/content/ist/cic/1998/00001998/00000001/art00003?crawler=true&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ipt</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">ipt</span><span class="p">)</span>

    <span class="c1"># get M to convert xyz to lms and apply normalization to matrix or input your own:</span>
    <span class="k">if</span> <span class="n">M</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">_IPT_M</span><span class="p">[</span><span class="s1">&#39;xyz2lms&#39;</span><span class="p">][</span><span class="n">cieobs</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># matrix conversions from xyz to lms</span>
        <span class="k">if</span> <span class="n">xyzw</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xyzw</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="n">_CIE_ILLUMINANTS</span><span class="p">[</span><span class="s1">&#39;D65&#39;</span><span class="p">],</span><span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyzw</span> <span class="o">=</span> <span class="n">xyzw</span><span class="o">/</span><span class="mf">100.0</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">normalize_3x3_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">xyzw</span><span class="p">)</span>

    <span class="c1"># convert from ipt to lms&#39;:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">lmsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">_IPT_M</span><span class="p">[</span><span class="s1">&#39;lms2ipt&#39;</span><span class="p">]),</span> <span class="n">ipt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lmsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">_IPT_M</span><span class="p">[</span><span class="s1">&#39;lms2ipt&#39;</span><span class="p">]),</span> <span class="n">ipt</span><span class="p">)</span>

    <span class="c1"># reverse response compression: lms&#39; to lms</span>
    <span class="n">lms</span> <span class="o">=</span> <span class="n">lmsp</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">0.43</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lmsp</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">lms</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lmsp</span><span class="p">[</span><span class="n">p</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">0.43</span><span class="p">)</span>

    <span class="c1"># convert from lms to xyz:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ipt</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">lms</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">lms</span><span class="p">)</span>
    <span class="c1">#xyz = np.dot(np.linalg.inv(M),lms.T).T</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyz</span> <span class="o">*</span> <span class="mf">100.0</span>
    <span class="n">xyz</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xyz</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">return</span> <span class="n">xyz</span></div>

<span class="c1">#------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="xyz_to_Ydlep"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_Ydlep">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_Ydlep</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">_COLORTF_DEFAULT_WHITE_POINT</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert XYZ tristimulus values to Y, dominant (complementary) wavelength</span>
<span class="sd">    and excitation purity.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz:</span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">        :xyzw:</span>
<span class="sd">            | None or ndarray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating spectrum locus coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :Ydlep: </span>
<span class="sd">            | ndarray with Y, dominant (complementary) wavelength</span>
<span class="sd">              and excitation purity</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xyz3</span> <span class="o">=</span> <span class="n">np3d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># flip axis so that shortest dim is on axis0 (save time in looping):</span>
    <span class="k">if</span> <span class="n">xyz3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">xyz3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">axes12flipped</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">xyz3</span> <span class="o">=</span> <span class="n">xyz3</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes12flipped</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># convert xyz to Yxy:</span>
    <span class="n">Yxy</span> <span class="o">=</span> <span class="n">xyz_to_Yxy</span><span class="p">(</span><span class="n">xyz3</span><span class="p">)</span>
    <span class="n">Yxyw</span> <span class="o">=</span> <span class="n">xyz_to_Yxy</span><span class="p">(</span><span class="n">xyzw</span><span class="p">)</span>

    <span class="c1"># get spectrum locus Y,x,y and wavelengths:</span>
    <span class="n">SL</span> <span class="o">=</span> <span class="n">_CMF</span><span class="p">[</span><span class="n">cieobs</span><span class="p">][</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>

    <span class="n">wlsl</span> <span class="o">=</span> <span class="n">SL</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Yxysl</span> <span class="o">=</span> <span class="n">xyz_to_Yxy</span><span class="p">(</span><span class="n">SL</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>

    <span class="c1"># center on xyzw:</span>
    <span class="n">Yxy</span> <span class="o">=</span> <span class="n">Yxy</span> <span class="o">-</span> <span class="n">Yxyw</span>
    <span class="n">Yxysl</span> <span class="o">=</span> <span class="n">Yxysl</span> <span class="o">-</span> <span class="n">Yxyw</span>
    <span class="n">Yxyw</span> <span class="o">=</span> <span class="n">Yxyw</span> <span class="o">-</span> <span class="n">Yxyw</span>

    <span class="c1">#split:</span>
    <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yxy</span><span class="p">)</span>
    <span class="n">Yw</span><span class="p">,</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yxyw</span><span class="p">)</span>
    <span class="n">Ysl</span><span class="p">,</span><span class="n">xsl</span><span class="p">,</span><span class="n">ysl</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yxysl</span><span class="p">)</span>

    <span class="c1"># calculate hue:</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">positive_arctan</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="n">hsl</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">positive_arctan</span><span class="p">(</span><span class="n">xsl</span><span class="p">,</span><span class="n">ysl</span><span class="p">,</span> <span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>

    <span class="n">hsl_max</span> <span class="o">=</span> <span class="n">hsl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># max hue angle at min wavelength</span>
    <span class="n">hsl_min</span> <span class="o">=</span> <span class="n">hsl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># min hue angle at max wavelength</span>

    <span class="n">dominantwavelength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">purity</span> <span class="o">=</span> <span class="n">dominantwavelength</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xyz3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>

            <span class="c1"># find index of complementary wavelengths/hues:</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">hsl_max</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">hsl_min</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">))</span> <span class="c1"># hue&#39;s requiring complementary wavelength (purple line)</span>
            <span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.0</span><span class="p">)</span><span class="o">*</span><span class="mf">180.0</span> <span class="c1"># add/subtract 180° to get positive complementary wavelength</span>

            <span class="c1"># find 2 closest hues in sl:</span>
            <span class="c1">#hslb,hib = meshblock(hsl,h[:,i:i+1])</span>
            <span class="n">hib</span><span class="p">,</span><span class="n">hslb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">hsl</span><span class="p">)</span>
            <span class="n">dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hslb</span><span class="o">-</span><span class="n">hib</span><span class="p">)</span>
            <span class="n">q1</span> <span class="o">=</span> <span class="n">dh</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># index of closest hue</span>
            <span class="n">dh</span><span class="p">[</span><span class="n">q1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1000.0</span>
            <span class="n">q2</span> <span class="o">=</span> <span class="n">dh</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># index of second closest hue</span>

            <span class="n">dominantwavelength</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wlsl</span><span class="p">[</span><span class="n">q1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">((</span><span class="n">wlsl</span><span class="p">[</span><span class="n">q2</span><span class="p">]</span> <span class="o">-</span> <span class="n">wlsl</span><span class="p">[</span><span class="n">q1</span><span class="p">]),(</span><span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">hsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])),(</span><span class="n">hsl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span> <span class="c1"># calculate wl corresponding to h: y = y1 + (y2-y1)*(x-x1)/(x2-x1)</span>
            <span class="n">dominantwavelength</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">dominantwavelength</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="c1">#complementary wavelengths are specified by &#39;-&#39; sign</span>

            <span class="c1"># calculate excitation purity:</span>
            <span class="n">x_dom_wl</span> <span class="o">=</span> <span class="n">xsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xsl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">hsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">hsl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># calculate x of dom. wl</span>
            <span class="n">y_dom_wl</span> <span class="o">=</span> <span class="n">ysl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ysl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ysl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">hsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">hsl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">hsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># calculate y of dom. wl</span>
            <span class="n">d_wl</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_dom_wl</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">y_dom_wl</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="c1"># distance from white point to sl</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">y</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="c1"># distance from white point to test point</span>
            <span class="n">purity</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="n">d_wl</span>

            <span class="c1"># correct for those test points that have a complementary wavelength</span>
            <span class="c1"># calculate intersection of line through white point and test point and purple line:</span>
            <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="p">[:,</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
            <span class="n">xyw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span><span class="p">))</span>
            <span class="n">xypl1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xsl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">ysl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">]))</span>
            <span class="n">xypl2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xsl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">ysl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">]))</span>
            <span class="n">da</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy</span><span class="o">-</span><span class="n">xyw</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">=</span> <span class="p">(</span><span class="n">xypl2</span><span class="o">-</span><span class="n">xypl1</span><span class="p">)</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">xyw</span> <span class="o">-</span> <span class="n">xypl1</span><span class="p">)</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>
            <span class="n">dap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">da</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dap</span> <span class="o">*</span> <span class="n">db</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dap</span> <span class="o">*</span> <span class="n">dp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">xy_linecross</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span><span class="o">/</span><span class="n">denom</span><span class="p">)</span> <span class="o">*</span><span class="n">db</span> <span class="o">+</span> <span class="n">xypl1</span>
            <span class="n">d_linecross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">((</span><span class="n">xy_linecross</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">xy_linecross</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="c1">#[0]</span>
            <span class="n">purity</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span><span class="o">/</span><span class="n">d_linecross</span><span class="p">[</span><span class="n">pc</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Ydlep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">xyz3</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">],</span><span class="n">dominantwavelength</span><span class="p">,</span><span class="n">purity</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">axes12flipped</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Ydlep</span> <span class="o">=</span> <span class="n">Ydlep</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Ydlep</span> <span class="o">=</span> <span class="n">Ydlep</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Ydlep</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>



<div class="viewcode-block" id="Ydlep_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.Ydlep_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">Ydlep_to_xyz</span><span class="p">(</span><span class="n">Ydlep</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">_COLORTF_DEFAULT_WHITE_POINT</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Y, dominant (complementary) wavelength and excitation purity to XYZ</span>
<span class="sd">    tristimulus values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :Ydlep: </span>
<span class="sd">            | ndarray with Y, dominant (complementary) wavelength</span>
<span class="sd">              and excitation purity</span>
<span class="sd">        :xyzw: </span>
<span class="sd">            | None or narray with tristimulus values of white point, optional</span>
<span class="sd">            | None defaults to xyz of CIE D65 using the :cieobs: observer.</span>
<span class="sd">        :cieobs:</span>
<span class="sd">            | luxpy._CIEOBS, optional</span>
<span class="sd">            | CMF set to use when calculating spectrum locus coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with tristimulus values</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">Ydlep3</span> <span class="o">=</span> <span class="n">np3d</span><span class="p">(</span><span class="n">Ydlep</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># flip axis so that shortest dim is on axis0 (save time in looping):</span>
    <span class="k">if</span> <span class="n">Ydlep3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">Ydlep3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">axes12flipped</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">Ydlep3</span> <span class="o">=</span> <span class="n">Ydlep3</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">axes12flipped</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># convert xyzw to Yxyw:</span>
    <span class="n">Yxyw</span> <span class="o">=</span> <span class="n">xyz_to_Yxy</span><span class="p">(</span><span class="n">xyzw</span><span class="p">)</span>
    <span class="n">Yxywo</span> <span class="o">=</span> <span class="n">Yxyw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># get spectrum locus Y,x,y and wavelengths:</span>
    <span class="n">SL</span> <span class="o">=</span> <span class="n">_CMF</span><span class="p">[</span><span class="n">cieobs</span><span class="p">][</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
    <span class="n">wlsl</span> <span class="o">=</span> <span class="n">SL</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="n">Yxysl</span> <span class="o">=</span> <span class="n">xyz_to_Yxy</span><span class="p">(</span><span class="n">SL</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)[:,</span><span class="kc">None</span><span class="p">]</span>

    <span class="c1"># center on xyzw:</span>
    <span class="n">Yxysl</span> <span class="o">=</span> <span class="n">Yxysl</span> <span class="o">-</span> <span class="n">Yxyw</span>
    <span class="n">Yxyw</span> <span class="o">=</span> <span class="n">Yxyw</span> <span class="o">-</span> <span class="n">Yxyw</span>

    <span class="c1">#split:</span>
    <span class="n">Y</span><span class="p">,</span> <span class="n">dom</span><span class="p">,</span> <span class="n">pur</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Ydlep3</span><span class="p">)</span>
    <span class="n">Yw</span><span class="p">,</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yxyw</span><span class="p">)</span>
    <span class="n">Ywo</span><span class="p">,</span><span class="n">xwo</span><span class="p">,</span><span class="n">ywo</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yxywo</span><span class="p">)</span>
    <span class="n">Ysl</span><span class="p">,</span><span class="n">xsl</span><span class="p">,</span><span class="n">ysl</span> <span class="o">=</span> <span class="n">asplit</span><span class="p">(</span><span class="n">Yxysl</span><span class="p">)</span>

    <span class="c1"># loop over longest dim:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ydlep3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>

        <span class="c1"># find closest wl&#39;s to dom:</span>
        <span class="c1">#wlslb,wlib = meshblock(wlsl,np.abs(dom[i,:])) #abs because dom&lt;0--&gt; complemtary wl</span>
        <span class="n">wlib</span><span class="p">,</span><span class="n">wlslb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dom</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span><span class="n">wlsl</span><span class="p">)</span>

        <span class="n">dwl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">wlslb</span><span class="o">-</span><span class="n">wlib</span><span class="p">)</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">dwl</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># index of closest wl</span>
        <span class="n">dwl</span><span class="p">[</span><span class="n">q1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">10000.0</span>
        <span class="n">q2</span> <span class="o">=</span> <span class="n">dwl</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># index of second closest wl</span>

        <span class="c1"># calculate x,y of dom:</span>
        <span class="n">x_dom_wl</span> <span class="o">=</span> <span class="n">xsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xsl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dom</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">wlsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">wlsl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wlsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># calculate x of dom. wl</span>
        <span class="n">y_dom_wl</span> <span class="o">=</span> <span class="n">ysl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">ysl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ysl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dom</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="n">wlsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">wlsl</span><span class="p">[</span><span class="n">q2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wlsl</span><span class="p">[</span><span class="n">q1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># calculate y of dom. wl</span>

        <span class="c1"># calculate x,y of test:</span>
        <span class="n">d_wl</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_dom_wl</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">y_dom_wl</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="c1"># distance from white point to dom</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">pur</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d_wl</span>
        <span class="n">hdom</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">positive_arctan</span><span class="p">(</span><span class="n">x_dom_wl</span><span class="p">,</span><span class="n">y_dom_wl</span><span class="p">,</span><span class="n">htype</span> <span class="o">=</span> <span class="s1">&#39;deg&#39;</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">hdom</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">hdom</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>

        <span class="c1"># complementary:</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dom</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">hdom</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdom</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dom</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">-</span> <span class="mf">180.0</span><span class="p">)</span><span class="o">*</span><span class="mf">180.0</span> <span class="c1"># get positive hue angle</span>


        <span class="c1"># calculate intersection of line through white point and test point and purple line:</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x_dom_wl</span><span class="p">,</span><span class="n">y_dom_wl</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">xyw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xw</span><span class="p">,</span><span class="n">yw</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">xypl1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xsl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">ysl</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">xypl2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xsl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">ysl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="kc">None</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">da</span> <span class="o">=</span> <span class="p">(</span><span class="n">xy</span><span class="o">-</span><span class="n">xyw</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="p">(</span><span class="n">xypl2</span><span class="o">-</span><span class="n">xypl1</span><span class="p">)</span>
        <span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="n">xyw</span> <span class="o">-</span> <span class="n">xypl1</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>
        <span class="n">dap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">da</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dap</span> <span class="o">*</span> <span class="n">db</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dap</span> <span class="o">*</span> <span class="n">dp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xy_linecross</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span><span class="o">/</span><span class="n">denom</span><span class="p">)</span> <span class="o">*</span><span class="n">db</span> <span class="o">+</span> <span class="n">xypl1</span>
        <span class="n">d_linecross</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">((</span><span class="n">xy_linecross</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">xy_linecross</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">=</span> <span class="n">pur</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span><span class="o">*</span><span class="n">d_linecross</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">hdom</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span> <span class="o">=</span> <span class="n">pur</span><span class="p">[:,</span><span class="n">i</span><span class="p">][</span><span class="n">pc</span><span class="p">]</span><span class="o">*</span><span class="n">d_linecross</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">hdom</span><span class="p">[</span><span class="n">pc</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">Yxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">Ydlep3</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span> <span class="o">+</span> <span class="n">xwo</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">ywo</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">axes12flipped</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Yxy</span> <span class="o">=</span> <span class="n">Yxy</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Yxy</span> <span class="o">=</span> <span class="n">Yxy</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Yxy_to_xyz</span><span class="p">(</span><span class="n">Yxy</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ydlep</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>


<div class="viewcode-block" id="xyz_to_srgb"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.xyz_to_srgb">[docs]</a><span class="k">def</span> <span class="nf">xyz_to_srgb</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates IEC:61966 sRGB values from xyz.</span>

<span class="sd">    Args:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with relative tristimulus values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :rgb: </span>
<span class="sd">            | ndarray with R,G,B values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>

    <span class="c1"># define 3x3 matrix</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.2404542</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5371385</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4985314</span><span class="p">],</span>
                  <span class="p">[</span><span class="o">-</span><span class="mf">0.9692660</span><span class="p">,</span>  <span class="mf">1.8760108</span><span class="p">,</span>  <span class="mf">0.0415560</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.0556434</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2040259</span><span class="p">,</span>  <span class="mf">1.0572252</span><span class="p">]])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">srgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">xyz</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">srgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">xyz</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>

    <span class="c1"># perform clipping:</span>
    <span class="n">srgb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">srgb</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">srgb</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">srgb</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># test for the dark colours in the non-linear part of the function:</span>
    <span class="n">dark</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">srgb</span> <span class="o">&lt;=</span>  <span class="mf">0.0031308</span><span class="p">)</span>

    <span class="c1"># apply gamma function:</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">2.4</span>

    <span class="c1"># and scale to range 0-255:</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">srgb</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.055</span><span class="o">*</span><span class="n">rgb</span><span class="o">**</span><span class="n">g</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>

    <span class="c1"># non-linear bit for dark colours</span>
    <span class="n">rgb</span><span class="p">[</span><span class="n">dark</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="n">srgb</span><span class="p">[</span><span class="n">dark</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mf">12.92</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>


    <span class="c1"># clip to range:</span>
    <span class="n">rgb</span><span class="p">[</span><span class="n">rgb</span><span class="o">&gt;</span><span class="mi">255</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="n">rgb</span><span class="p">[</span><span class="n">rgb</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">rgb</span></div>


<div class="viewcode-block" id="srgb_to_xyz"><a class="viewcode-back" href="../../../../color.html#luxpy.color.ctf.colortransforms.srgb_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">srgb_to_xyz</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates xyz from IEC:61966 sRGB values.</span>

<span class="sd">    Args:</span>
<span class="sd">        :rgb: </span>
<span class="sd">            | ndarray with srgb values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :xyz: </span>
<span class="sd">            | ndarray with relative tristimulus values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">np2d</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
    <span class="c1"># define 3x3 matrix</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.4124564</span><span class="p">,</span>  <span class="mf">0.3575761</span><span class="p">,</span>  <span class="mf">0.1804375</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.2126729</span><span class="p">,</span>  <span class="mf">0.7151522</span><span class="p">,</span>  <span class="mf">0.0721750</span><span class="p">],</span>
                  <span class="p">[</span><span class="mf">0.0193339</span><span class="p">,</span>  <span class="mf">0.1191920</span><span class="p">,</span>  <span class="mf">0.9503041</span><span class="p">]])</span>


    <span class="c1"># scale device coordinates:</span>
    <span class="n">sRGB</span> <span class="o">=</span> <span class="n">rgb</span><span class="o">/</span><span class="mi">255</span>

    <span class="c1"># test for non-linear part of conversion</span>
    <span class="n">nonlin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">sRGB</span> <span class="o">&lt;</span>  <span class="mf">0.0031308</span><span class="p">)</span><span class="c1">#0.03928)</span>

    <span class="c1"># apply gamma function to convert to sRGB</span>
    <span class="n">srgb</span> <span class="o">=</span> <span class="n">sRGB</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">srgb</span> <span class="o">=</span> <span class="p">((</span><span class="n">srgb</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span><span class="o">/</span><span class="mf">1.055</span><span class="p">)</span><span class="o">**</span><span class="mf">2.4</span>

    <span class="n">srgb</span><span class="p">[</span><span class="n">nonlin</span><span class="p">]</span> <span class="o">=</span> <span class="n">sRGB</span><span class="p">[</span><span class="n">nonlin</span><span class="p">]</span><span class="o">/</span><span class="mf">12.92</span>


    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">srgb</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">srgb</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,lj-&gt;li&#39;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">srgb</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">return</span> <span class="n">xyz</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Kevin A.G. Smet.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.3.5',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>