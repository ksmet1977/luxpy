<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>luxpy.toolboxes.stereoscopicviewer.harfang.harfang_viewer &mdash; LuxPy 1.11.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=6cf1fb80"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            LuxPy
          </a>
              <div class="version">
                1.11.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../license.html">License: GPLv3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../required_packages.html">Imported (required) packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../luxpy_structure.html">Luxpy package structure</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">LuxPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">luxpy.toolboxes.stereoscopicviewer.harfang.harfang_viewer</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for luxpy.toolboxes.stereoscopicviewer.harfang.harfang_viewer</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for viewing equirectangular images in a steamVR supported head-mounted-display.</span>
<span class="sd">======================================================================================</span>

<span class="sd">Created on Sat Nov 19 09:45:11 2022</span>

<span class="sd">@author: u0032318</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="n">c_uint32</span>

<span class="kn">from</span> <span class="nn">luxpy.utils</span> <span class="kn">import</span> <span class="n">is_importable</span><span class="p">,</span> <span class="n">imread</span><span class="p">,</span> <span class="n">imsave</span> 

   
<span class="c1"># import harfang (and if necessary install it):</span>
<span class="n">success</span> <span class="o">=</span> <span class="n">is_importable</span><span class="p">(</span><span class="s1">&#39;harfang&#39;</span><span class="p">,</span> <span class="n">try_pip_install</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">success</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">harfang</span> <span class="k">as</span> <span class="nn">hg</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_PKG_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;CreateSphereModel&#39;</span><span class="p">,</span><span class="s1">&#39;CreatePlaneModel&#39;</span><span class="p">,</span>
           <span class="s1">&#39;create_material&#39;</span><span class="p">,</span><span class="s1">&#39;update_material_texture&#39;</span><span class="p">,</span>
           <span class="s1">&#39;makeColorTex&#39;</span><span class="p">,</span> <span class="s1">&#39;split_SingleSphericalTex&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Shader&#39;</span><span class="p">,</span> <span class="s1">&#39;Scene&#39;</span><span class="p">,</span><span class="s1">&#39;Camera&#39;</span><span class="p">,</span><span class="s1">&#39;Material&#39;</span><span class="p">,</span><span class="s1">&#39;Screen&#39;</span><span class="p">,</span> <span class="s1">&#39;Eye&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;HmdStereoViewer&#39;</span><span class="p">,</span><span class="s1">&#39;generate_stimulus_tex_list&#39;</span><span class="p">,</span>
           <span class="s1">&#39;generate_rgba_texs_iml&#39;</span><span class="p">,</span><span class="s1">&#39;get_rgbFromTexPaths&#39;</span><span class="p">,</span>
           <span class="s1">&#39;getRectMask&#39;</span><span class="p">,</span> <span class="s1">&#39;getRoiImage&#39;</span><span class="p">,</span>
           <span class="s1">&#39;get_xyz_from_xyzmap_roi&#39;</span><span class="p">,</span><span class="s1">&#39;get_rgb_from_rgbtexpath&#39;</span><span class="p">]</span>

<span class="c1">#==============================================================================</span>

<span class="n">_PKG_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="n">_SCREEN_TEX_WH</span> <span class="o">=</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span><span class="mi">600</span><span class="p">)</span>
<span class="n">_TEXTURE_FLAGS</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">TF_UBorder</span> <span class="o">|</span> <span class="n">hg</span><span class="o">.</span><span class="n">TF_VBorder</span> <span class="o">|</span> <span class="n">hg</span><span class="o">.</span><span class="n">TF_SamplerMinPoint</span> <span class="o">|</span> <span class="n">hg</span><span class="o">.</span><span class="n">TF_SamplerMagPoint</span>

<span class="c1">#==============================================================================</span>

<div class="viewcode-block" id="CreateSphereModel">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.CreateSphereModel">[docs]</a>
<span class="k">def</span> <span class="nf">CreateSphereModel</span><span class="p">(</span><span class="n">decl</span> <span class="p">:</span> <span class="n">hg</span><span class="o">.</span><span class="n">VertexLayout</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">radius</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subdiv_x</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span> <span class="n">subdiv_y</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span> <span class="n">flip_normals</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Create a Sphere Model.</span>
<span class="sd">    </span>
<span class="sd">    Args: </span>
<span class="sd">        :decl:</span>
<span class="sd">            | VertexLayout declaration</span>
<span class="sd">            | If None: the following is created: PosFloatNormalFloatTexCoord0Float </span>
<span class="sd">            |       (if using texture images: this is the one that is required)</span>
<span class="sd">        :radius:</span>
<span class="sd">            | 1, optional</span>
<span class="sd">            | Radius of sphere</span>
<span class="sd">        :subdiv_x:</span>
<span class="sd">            | 256, optional</span>
<span class="sd">            | Number of subdivisions along sphere axis </span>
<span class="sd">        :subdiv_y:</span>
<span class="sd">            | 256, optional</span>
<span class="sd">            | Number of subdivision along sphere circumference.</span>
<span class="sd">        :flip_normals:</span>
<span class="sd">            | False, optional</span>
<span class="sd">            | If True: flip the direction of the normals of the vertices.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        :Model:</span>
<span class="sd">            | Harfang Sphere Model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">decl</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">VertexLayout</span><span class="p">()</span>
        <span class="n">decl</span><span class="o">.</span><span class="n">Begin</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">A_Position</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">AT_Float</span><span class="p">)</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">A_Normal</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">AT_Float</span><span class="p">)</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">A_TexCoord0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">AT_Float</span><span class="p">)</span><span class="o">.</span><span class="n">End</span><span class="p">()</span>


    <span class="n">builder</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ModelBuilder</span><span class="p">()</span> 
    
    <span class="n">fn</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">flip_normals</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="n">fn3</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span> <span class="c1"># shorthand for later</span>
    <span class="n">TwoPi</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>
    
    <span class="n">i_top</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">AddVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">MakeVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">radius</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
    <span class="n">i_bottom</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">AddVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">MakeVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">fn</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">subdiv_y</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
    <span class="n">old_ref</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">subdiv_x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span> <span class="c1"># -2 because already have top and bottom</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">subdiv_x</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">pi</span>
        
        <span class="n">section_y</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span>
        <span class="n">section_radius</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span> 
        
        <span class="n">v</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">section_radius</span><span class="p">,</span> <span class="n">section_y</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">=</span>  <span class="n">builder</span><span class="o">.</span><span class="n">AddVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">MakeVertex</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fn3</span><span class="o">*</span><span class="n">hg</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="p">)))</span>
     
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">subdiv_y</span> <span class="o">+</span> <span class="n">n</span><span class="p">)):</span>
            <span class="n">c_a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="n">TwoPi</span> <span class="o">/</span> <span class="n">subdiv_y</span>
            
            <span class="n">v</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">c_a</span><span class="p">)</span> <span class="o">*</span> <span class="n">section_radius</span><span class="p">,</span> <span class="n">section_y</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">c_a</span><span class="p">)</span> <span class="o">*</span> <span class="n">section_radius</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">AddVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">MakeVertex</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fn3</span><span class="o">*</span><span class="n">hg</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec2</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">subdiv_y</span> <span class="o">+</span> <span class="n">n</span><span class="p">),</span><span class="n">t</span><span class="p">)))</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="c1"># top section</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">AddTriangle</span><span class="p">(</span><span class="n">i_top</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span> <span class="c1"># middle section </span>
                <span class="n">array32</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_uint32</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">old_ref</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">old_ref</span><span class="p">[</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">AddPolygon</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">uint32_tList</span><span class="p">(</span><span class="n">array32</span><span class="p">))</span>
                
            <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="n">subdiv_x</span><span class="p">):</span> <span class="c1"># bottom section </span>
                <span class="n">builder</span><span class="o">.</span><span class="n">AddTriangle</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i_bottom</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                
                
            <span class="n">ref</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
            
        <span class="n">old_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
    <span class="n">builder</span><span class="o">.</span><span class="n">EndList</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">MakeModel</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span></div>


<span class="c1">#------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="CreatePlaneModel">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.CreatePlaneModel">[docs]</a>
<span class="k">def</span> <span class="nf">CreatePlaneModel</span><span class="p">(</span><span class="n">decl</span> <span class="p">:</span> <span class="n">hg</span><span class="o">.</span><span class="n">VertexLayout</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">subdiv_x</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span> <span class="n">subdiv_y</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span> <span class="n">flip_normals</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Create a Plane (Quad) Model.</span>
<span class="sd">    </span>
<span class="sd">    Args: </span>
<span class="sd">        :decl:</span>
<span class="sd">            | VertexLayout declaration</span>
<span class="sd">            | If None: the following is created: PosFloatNormalFloatTexCoord0Float </span>
<span class="sd">            |       (if using texture images: this is the one that is required)</span>
<span class="sd">        :width:</span>
<span class="sd">            | 1, optional</span>
<span class="sd">            | Width of plane</span>
<span class="sd">        :height:</span>
<span class="sd">            | 1, optional</span>
<span class="sd">            | height of plane</span>
<span class="sd">        :subdiv_x:</span>
<span class="sd">            | 256, optional</span>
<span class="sd">            | Number of subdivisions along plane height</span>
<span class="sd">        :subdiv_y:</span>
<span class="sd">            | 256, optional</span>
<span class="sd">            | Number of subdivision along plane width.</span>
<span class="sd">        :flip_normals:</span>
<span class="sd">            | False, optional</span>
<span class="sd">            | If True: flip the direction of the normals of the vertices.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        :Model:</span>
<span class="sd">            | Harfang Plane Model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">decl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">decl</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">VertexLayout</span><span class="p">()</span>
        <span class="n">decl</span><span class="o">.</span><span class="n">Begin</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">A_Position</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">AT_Float</span><span class="p">)</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">A_Normal</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">AT_Float</span><span class="p">)</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">A_TexCoord0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">AT_Float</span><span class="p">)</span><span class="o">.</span><span class="n">End</span><span class="p">()</span>

    <span class="n">builder</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ModelBuilder</span><span class="p">()</span> 
    
    <span class="n">fn</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">flip_normals</span> <span class="k">else</span> <span class="mf">1.0</span>
    <span class="n">fn3</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">fn</span><span class="p">)</span> <span class="c1"># shorthand for later</span>
      
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">subdiv_y</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
    <span class="n">old_ref</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">subdiv_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> 
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">subdiv_x</span><span class="p">)</span> 
        
        <span class="n">section_y</span> <span class="o">=</span> <span class="n">height</span><span class="o">*</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> 
        <span class="n">section_x</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">v</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">section_x</span><span class="p">,</span> <span class="n">section_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">=</span>  <span class="n">builder</span><span class="o">.</span><span class="n">AddVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">MakeVertex</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fn3</span><span class="o">*</span><span class="n">hg</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)))</span>
     
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">subdiv_y</span> <span class="o">+</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">c_a</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">subdiv_y</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">width</span>
            
            <span class="n">v</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="n">c_a</span> <span class="p">,</span> <span class="n">section_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">AddVertex</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">MakeVertex</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">fn3</span><span class="o">*</span><span class="n">hg</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec2</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">subdiv_y</span> <span class="o">+</span> <span class="n">n</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="n">t</span><span class="p">)))</span>

            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">array32</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_uint32</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">old_ref</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">old_ref</span><span class="p">[</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]]</span>
                <span class="n">builder</span><span class="o">.</span><span class="n">AddPolygon</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">uint32_tList</span><span class="p">(</span><span class="n">array32</span><span class="p">))</span>
                   
            <span class="n">ref</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
            
        <span class="n">old_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
    <span class="n">builder</span><span class="o">.</span><span class="n">EndList</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="n">MakeModel</span><span class="p">(</span><span class="n">decl</span><span class="p">)</span></div>

<span class="c1">#==============================================================================</span>

<div class="viewcode-block" id="create_material">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.create_material">[docs]</a>
<span class="k">def</span> <span class="nf">create_material</span><span class="p">(</span><span class="n">prg_ref</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">ubc</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">orm</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">slf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tex</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">blend_mode</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">BM_Opaque</span><span class="p">,</span> 
                    <span class="n">faceculling</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">FC_CounterClockwise</span>
                    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Create a Harfang material with specified color and texture properties.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :prg_ref:</span>
<span class="sd">            | shader program from assets (ref)</span>
<span class="sd">        :res:</span>
<span class="sd">            | resources</span>
<span class="sd">        :ubc:</span>
<span class="sd">            | uBaseOpacityColor</span>
<span class="sd">        :orm:</span>
<span class="sd">            | uOcclusionRoughnessMetalnessColor</span>
<span class="sd">        :slf:</span>
<span class="sd">            | uSelfColor</span>
<span class="sd">        :tex:</span>
<span class="sd">            | uSelfMap texture (if not None: any color input is ignored !)</span>
<span class="sd">        :blendmode:</span>
<span class="sd">            | hg.BM_Opaque, optional</span>
<span class="sd">            | Blend mode</span>
<span class="sd">        :faceculling:</span>
<span class="sd">            | hg.FC_CounterClockwise</span>
<span class="sd">            | Sets face culling (hg.FC_CounterClockwise, hg.FC_Clockwise, hg.FC_Disabled)</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">        :mat:</span>
<span class="sd">            | Harfang material (note that material program variant has been updated</span>
<span class="sd">            |                   accordingly; see: hg.UpdateMaterialPipelineProgramVariant)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Material</span><span class="p">()</span>
    <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialProgram</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">prg_ref</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">ubc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialValue</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="s2">&quot;uBaseOpacityColor&quot;</span><span class="p">,</span> <span class="n">ubc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">slf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialValue</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="s2">&quot;uSelfColor&quot;</span><span class="p">,</span> <span class="n">slf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialValue</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="s2">&quot;uOcclusionRoughnessMetalnessColor&quot;</span><span class="p">,</span> <span class="n">orm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">LoadTextureFromFile</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">_TEXTURE_FLAGS</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialTexture</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span><span class="s2">&quot;uSelfMap&quot;</span><span class="p">,</span> <span class="n">tex</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">hg</span><span class="o">.</span><span class="n">UpdateMaterialPipelineProgramVariant</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialBlendMode</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">blend_mode</span><span class="p">)</span>
    <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialFaceCulling</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">faceculling</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mat</span></div>


<div class="viewcode-block" id="update_material_texture">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.update_material_texture">[docs]</a>
<span class="k">def</span> <span class="nf">update_material_texture</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">tex</span><span class="p">,</span> <span class="n">mat_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;uSelfMap&quot;</span><span class="p">,</span> <span class="n">stage</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">texListPreloaded</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Update the texture of a Harfang material.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :node:</span>
<span class="sd">            | Node to which material belongs</span>
<span class="sd">        :res:</span>
<span class="sd">            | Pipeline resources</span>
<span class="sd">        :tex:</span>
<span class="sd">            | New texture</span>
<span class="sd">        :mat_idx:</span>
<span class="sd">            | 0, optional</span>
<span class="sd">            | index of material in material table of object</span>
<span class="sd">        :name:</span>
<span class="sd">            | &quot;uSelfMap&quot;, optional</span>
<span class="sd">            | name of material type (depends on shader used; the default is for the pbr shader)</span>
<span class="sd">       :stage:</span>
<span class="sd">            | 4, optional</span>
<span class="sd">            | Render stage: depends on features, shader, ... (see &quot;writing a pipeline shader&quot; in Harfang documentation)</span>
<span class="sd">       :texListPreloaded:</span>
<span class="sd">            | None, optional </span>
<span class="sd">            | List with preloaded textures (to speed up texture update as it doesn&#39;t need to be read from file anymore while looping over frames)</span>
<span class="sd">                                            </span>
<span class="sd">    Returns:</span>
<span class="sd">        :mat:</span>
<span class="sd">            | Harfang material (note that material program variant has been updated</span>
<span class="sd">            |                   accordingly; see: hg.UpdateMaterialPipelineProgramVariant)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">texListPreloaded</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">texListPreloaded</span><span class="p">,</span> <span class="nb">list</span><span class="p">))):</span>
        <span class="n">tex</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">LoadTextureFromFile</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">_TEXTURE_FLAGS</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">GetObject</span><span class="p">()</span><span class="o">.</span><span class="n">GetMaterial</span><span class="p">(</span><span class="n">mat_idx</span><span class="p">)</span>
        <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialTexture</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tex</span><span class="p">,</span> <span class="n">stage</span><span class="p">)</span>
    <span class="c1"># elif isinstance(tex, int): </span>
    <span class="c1">#     # node.GetObject().SetMaterialCount(tex) # ????????</span>
    <span class="c1">#     # mat = node.GetObject().GetMaterial(tex)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">texListPreloaded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span> 
        <span class="n">texPreloaded</span> <span class="o">=</span> <span class="n">texListPreloaded</span><span class="p">[</span><span class="n">tex</span><span class="p">]</span> <span class="c1"># indexing in List or Dict !</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">GetObject</span><span class="p">()</span><span class="o">.</span><span class="n">GetMaterial</span><span class="p">(</span><span class="n">mat_idx</span><span class="p">)</span>
        <span class="n">hg</span><span class="o">.</span><span class="n">SetMaterialTexture</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">texPreloaded</span><span class="p">,</span> <span class="n">stage</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Tex </span><span class="si">{}</span><span class="s1"> could not be updated. (texListPreloaded was </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tex</span><span class="p">,</span> <span class="n">texListPreloaded</span> <span class="p">))</span>
    <span class="n">hg</span><span class="o">.</span><span class="n">UpdateMaterialPipelineProgramVariant</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mat</span></div>


<div class="viewcode-block" id="makeColorTex">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.makeColorTex">[docs]</a>
<span class="k">def</span> <span class="nf">makeColorTex</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">texHeight</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">texWidth</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Make a full single-color texture.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :color:</span>
<span class="sd">            | uint8 RGB(A; ignored) color</span>
<span class="sd">        :texHeight,texWidth:</span>
<span class="sd">            | Height and width of texture</span>
<span class="sd">        :save:</span>
<span class="sd">            | None, optional</span>
<span class="sd">            | File path to save texture to.</span>
<span class="sd">            | If not None: save texture in supplied filepath.</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">        :text:</span>
<span class="sd">            | numpy ndarray with RGB texture.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">texWidth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">texWidth</span> <span class="o">=</span> <span class="n">texHeight</span> 
    <span class="n">tex</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">texHeight</span><span class="p">,</span><span class="n">texWidth</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">color</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="o">...</span><span class="p">][</span><span class="o">...</span><span class="p">,:</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">imsave</span><span class="p">(</span><span class="n">save</span><span class="p">,</span><span class="n">tex</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tex</span></div>

    
<div class="viewcode-block" id="split_SingleSphericalTex">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.split_SingleSphericalTex">[docs]</a>
<span class="k">def</span> <span class="nf">split_SingleSphericalTex</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">left_layout_pos</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Split Image into left eye and right eye subimages </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        :file:</span>
<span class="sd">            | Image file path</span>
<span class="sd">        :left_layout_pos:</span>
<span class="sd">            | Position of left eye sub-image in image specified in file.</span>
<span class="sd">            | options: &#39;bottom&#39;, &#39;top&#39;, &#39;left&#39;, &#39;right&#39;, None</span>
<span class="sd">            | If None: there is no left and right subimage in </span>
<span class="sd">            |          the image specified in filePath -&gt; don&#39;t split</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">        :file_L, file_R: </span>
<span class="sd">            | filepaths to left and right eye sub-images </span>
<span class="sd">            | (each indicated respectively by &#39;_L&#39;, &#39;_R&#39; appended to the filename.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;_L.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file_L</span><span class="p">,</span> <span class="n">file_R</span> <span class="o">=</span> <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:],</span> <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_R&#39;</span><span class="o">+</span><span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_L</span><span class="p">):</span> <span class="c1"># only split when _L doesn&#39;t exist yet.</span>
            <span class="n">tex</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">texHeight</span><span class="p">,</span><span class="n">texWidth</span> <span class="o">=</span> <span class="n">tex</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">left_layout_pos</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
                <span class="n">tex_L</span><span class="p">,</span> <span class="n">tex_R</span> <span class="o">=</span> <span class="n">tex</span><span class="p">[:</span><span class="n">texHeight</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">tex</span><span class="p">[(</span><span class="n">texHeight</span><span class="o">//</span><span class="mi">2</span><span class="p">):,</span><span class="o">...</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">left_layout_pos</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
                <span class="n">tex_R</span><span class="p">,</span> <span class="n">tex_L</span> <span class="o">=</span> <span class="n">tex</span><span class="p">[:</span><span class="n">texHeight</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">tex</span><span class="p">[(</span><span class="n">texHeight</span><span class="o">//</span><span class="mi">2</span><span class="p">):,</span><span class="o">...</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">left_layout_pos</span> <span class="o">==</span> <span class="s1">&#39;left&#39;</span><span class="p">:</span>
                <span class="n">tex_L</span><span class="p">,</span> <span class="n">tex_R</span> <span class="o">=</span> <span class="n">tex</span><span class="p">[:,:</span><span class="n">texWidth</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">tex</span><span class="p">[:,(</span><span class="n">texWidth</span><span class="o">//</span><span class="mi">2</span><span class="p">):,</span><span class="o">...</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">left_layout_pos</span> <span class="o">==</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span>
                <span class="n">tex_R</span><span class="p">,</span> <span class="n">tex_L</span> <span class="o">=</span> <span class="n">tex</span><span class="p">[:,:</span><span class="n">texWidth</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="o">...</span><span class="p">],</span> <span class="n">tex</span><span class="p">[:,(</span><span class="n">texWidth</span><span class="o">//</span><span class="mi">2</span><span class="p">):,</span><span class="o">...</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">left_layout_pos</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tex_L</span><span class="p">,</span> <span class="n">tex_R</span> <span class="o">=</span> <span class="n">tex</span><span class="p">,</span> <span class="n">tex</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tex_L</span><span class="p">,</span> <span class="n">tex_R</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">tex_L</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">imsave</span><span class="p">(</span><span class="n">file_L</span><span class="p">,</span><span class="n">tex_L</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tex_R</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">imsave</span><span class="p">(</span><span class="n">file_R</span><span class="p">,</span><span class="n">tex_R</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_L</span><span class="p">,</span> <span class="n">file_R</span> <span class="o">=</span> <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_L&#39;</span><span class="o">+</span><span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:],</span> <span class="n">file</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_R&#39;</span><span class="o">+</span><span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">file_L</span><span class="p">,</span> <span class="n">file_R</span><span class="p">]</span></div>



<span class="c1"># def generateCubemapFiles(file_L, file_R):</span>
<span class="c1">#     files, Ids = [file_L,file_R], [&#39;_L&#39;,&#39;_R&#39;] </span>
<span class="c1">#     generated_files = []</span>
<span class="c1">#     for file,Id in zip(files,Ids):</span>
<span class="c1">#         #if Id in file: </span>
<span class="c1">#         Id = &#39;&#39;</span>
<span class="c1">#         if not os.path.exists((file[:-4] + &#39;_posx&#39; + file[-4:])):</span>
<span class="c1">#             tmp = imread(file)</span>
<span class="c1">#             for _posx in [&#39;_posx&#39;,&#39;_negx&#39;,&#39;_posy&#39;,&#39;_negy&#39;,&#39;_posz&#39;,&#39;_negz&#39;]:</span>
<span class="c1">#                 file_posX = (file[:-4] + Id + _posx + file[-4:])</span>
<span class="c1">#                 imsave(file_posX, tmp)</span>
<span class="c1">#                 generated_files.append(file_posX)</span>
<span class="c1">#     return generated_files</span>
    
<span class="k">def</span> <span class="nf">_cleanupGeneratedFiles</span><span class="p">(</span><span class="n">generated_files</span><span class="p">,</span> <span class="n">keep_list</span> <span class="o">=</span> <span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Clean up files generated by viewer (keep_list: files to keep) &quot;&quot;&quot;</span>
    <span class="n">gf</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">generated_files</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">generated_files</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keep_list</span><span class="p">:</span> 
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">gf</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gf</span>

<span class="k">def</span> <span class="nf">_getLeftRightFileNames</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">left_is_right</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get filenames of left and right subimages&quot;&quot;&quot;</span>
    <span class="n">_left_strId</span> <span class="o">=</span> <span class="s1">&#39;_L&#39;</span>
    <span class="n">_right_strId</span> <span class="o">=</span> <span class="s1">&#39;_L&#39;</span> <span class="k">if</span> <span class="n">left_is_right</span> <span class="k">else</span> <span class="s1">&#39;_R&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;_L.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span> 
        <span class="n">file_L</span> <span class="o">=</span> <span class="n">filepath</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">_left_strId</span>  <span class="o">+</span> <span class="n">filepath</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
        <span class="n">file_R</span> <span class="o">=</span> <span class="n">filepath</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">_right_strId</span> <span class="o">+</span> <span class="n">filepath</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_L</span> <span class="o">=</span> <span class="n">filepath</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">_left_strId</span>  <span class="o">+</span> <span class="n">filepath</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
        <span class="n">file_R</span> <span class="o">=</span> <span class="n">filepath</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">_right_strId</span> <span class="o">+</span> <span class="n">filepath</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
    
<span class="c1">#     if os.path.exists(filepath) and (not os.path.exists(file_L)): # use original for both</span>
<span class="c1">#         file_L, file_R = filepath, filepath</span>
    
    <span class="k">return</span> <span class="n">file_L</span><span class="p">,</span> <span class="n">file_R</span>

<span class="k">def</span> <span class="nf">_processEquiRectImagePath</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">left_is_right</span><span class="p">,</span> <span class="n">left_layout_pos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Process the path of the rectangular image.</span>
<span class="sd">    (splits image if no left (&#39;_R&#39;) or right (&#39;_L&#39;) sub-images are found in same folder as in filePath</span>
<span class="sd">     </span>
<span class="sd">     Args:</span>
<span class="sd">         :filePath:</span>
<span class="sd">             | Image file path</span>
<span class="sd">         :left_is_right:</span>
<span class="sd">             | If True: the image for the left eye is the same as for the right eye </span>
<span class="sd">         :left_layout_pos:</span>
<span class="sd">             | Position of left eye sub-image in image specified in filePath.</span>
<span class="sd">             | options: &#39;bottom&#39;, &#39;top&#39;, &#39;left&#39;, &#39;right&#39;, None</span>
<span class="sd">             | If None: there is no left and right subimage in </span>
<span class="sd">             |          the image specified in filePath -&gt; don&#39;t split</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filePath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> 
        <span class="n">file_L</span><span class="p">,</span> <span class="n">file_R</span> <span class="o">=</span> <span class="n">_getLeftRightFileNames</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">left_is_right</span> <span class="o">=</span> <span class="n">left_is_right</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_L</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_R</span><span class="p">)):</span>
            <span class="n">file_L</span><span class="p">,</span> <span class="n">file_R</span> <span class="o">=</span> <span class="n">split_SingleSphericalTex</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">left_layout_pos</span> <span class="o">=</span> <span class="n">left_layout_pos</span><span class="p">)</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_L</span><span class="p">,</span> <span class="n">file_R</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Only None, list, tuple or string input allowed for filePath&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filePath</span>


<span class="c1">#==============================================================================</span>

<div class="viewcode-block" id="Shader">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Shader">[docs]</a>
<span class="k">class</span> <span class="nc">Shader</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">assetPath</span> <span class="o">=</span> <span class="s1">&#39;core/shader/pbr.hps&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Initialize / load a shader from assets.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :resources:</span>
<span class="sd">                | Resources; required to load shader.</span>
<span class="sd">            :assetPath:</span>
<span class="sd">                | &#39;core/shader/pbr.hps&#39;, optional</span>
<span class="sd">                | Asset path of shader.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load shader program</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assetPath</span> <span class="o">=</span> <span class="n">assetPath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prgRef</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">LoadPipelineProgramRefFromAssets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assetPath</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">GetForwardPipelineInfo</span><span class="p">())</span></div>


<div class="viewcode-block" id="Scene">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Scene">[docs]</a>
<span class="k">class</span> <span class="nc">Scene</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">canvasColorI</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="n">ambientEnvColorI</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a basic scene.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :canvasColorI:</span>
<span class="sd">                | [0,0,0,255], optional</span>
<span class="sd">                | uint8 RGBA color of canvas</span>
<span class="sd">            :ambientEnvColorI:</span>
<span class="sd">                | [0,0,0,0], optional</span>
<span class="sd">                | uint8 RGBA color of ambient environment light(ing)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvasColorI</span> <span class="o">=</span> <span class="n">canvasColorI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ambientEnvColorI</span> <span class="o">=</span> <span class="n">ambientEnvColorI</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ColorI</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">canvasColorI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">ambient</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">ColorI</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ambientEnvColorI</span><span class="p">)</span></div>


<div class="viewcode-block" id="Camera">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Camera">[docs]</a>
<span class="k">class</span> <span class="nc">Camera</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">scene</span><span class="p">,</span>
                 <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                 <span class="n">rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                 <span class="n">zNear</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
                 <span class="n">zFar</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
                 <span class="n">fov</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Define / create a camera object</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :scene:</span>
<span class="sd">                | scene object in which to create the camera.</span>
<span class="sd">            :position:</span>
<span class="sd">                | [0,0,0], optional</span>
<span class="sd">                | Position of camera </span>
<span class="sd">            :rotation:</span>
<span class="sd">                | [0,0,0], optional</span>
<span class="sd">                | Euler rotation angles (°) of camera</span>
<span class="sd">            :zNear:</span>
<span class="sd">                | 0.01, optional</span>
<span class="sd">                | Distance of near plane of frustum.</span>
<span class="sd">            :zFar:</span>
<span class="sd">                | 5000,</span>
<span class="sd">                | Distance of far plane of frustum. </span>
<span class="sd">            :fov:</span>
<span class="sd">                | 60, optional</span>
<span class="sd">                | Field-of-view of camera.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot</span> <span class="o">=</span> <span class="n">rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zNear</span> <span class="o">=</span> <span class="n">zNear</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">zFar</span> <span class="o">=</span> <span class="n">zFar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fov</span> <span class="o">=</span> <span class="n">fov</span>
        
        <span class="c1"># Set camera position and orientation + create and add to scene:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span>  <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Deg3</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">TransformationMat4</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">CreateCamera</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zNear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zFar</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fov</span><span class="p">))</span></div>

  

<div class="viewcode-block" id="Material">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Material">[docs]</a>
<span class="k">class</span> <span class="nc">Material</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_prgRef</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span>
                 <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">uSelfColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">blend_mode</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">BM_Opaque</span><span class="p">,</span> 
                 <span class="n">faceculling</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">FC_CounterClockwise</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Define a Harfang material with specified color and texture properties.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :ubc:</span>
<span class="sd">                | uBaseOpacityColor</span>
<span class="sd">            :orm:</span>
<span class="sd">                | uOcclusionRoughnessMetalnessColor</span>
<span class="sd">            :slf:</span>
<span class="sd">                | uSelfColor</span>
<span class="sd">            :prg_ref:</span>
<span class="sd">                | shader program from assets (ref)</span>
<span class="sd">            :res:</span>
<span class="sd">                | resources</span>
<span class="sd">            :tex:</span>
<span class="sd">                | uSelfMap texture (if not None: any color input is ignored !)</span>
<span class="sd">            :blendmode:</span>
<span class="sd">                | hg.BM_Opaque, optional</span>
<span class="sd">                | Blend mode</span>
<span class="sd">            :faceculling:</span>
<span class="sd">                | hg.FC_CounterClockwise</span>
<span class="sd">                | Sets face culling (hg.FC_CounterClockwise, hg.FC_Clockwise, hg.FC_Disabled)</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">shader_prgRef</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">shader_prgRef</span><span class="p">,</span> <span class="n">resources</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">uSelfMapTextureListPreloaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span> <span class="o">=</span>  <span class="n">uBaseOpacityColor</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blend_mode</span> <span class="o">=</span> <span class="n">blend_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faceculling</span> <span class="o">=</span> <span class="n">faceculling</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">create_material</span><span class="p">(</span><span class="n">shader_prgRef</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span> 
                                   <span class="n">ubc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span><span class="p">,</span> 
                                   <span class="n">slf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span><span class="p">,</span> 
                                   <span class="n">orm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">,</span> 
                                   <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTexture</span><span class="p">,</span>
                                   <span class="n">blend_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blend_mode</span><span class="p">,</span> 
                                   <span class="n">faceculling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faceculling</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">texList</span> <span class="o">=</span> <span class="kc">None</span>
        
<div class="viewcode-block" id="Material.createMaterial">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Material.createMaterial">[docs]</a>
    <span class="k">def</span> <span class="nf">createMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uSelfColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">blend_mode</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                       <span class="n">faceculling</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Create a Harfang material with specified color and texture properties.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :ubc:</span>
<span class="sd">                | uBaseOpacityColor</span>
<span class="sd">            :orm:</span>
<span class="sd">                | uOcclusionRoughnessMetalnessColor</span>
<span class="sd">            :slf:</span>
<span class="sd">                | uSelfColor</span>
<span class="sd">            :tex:</span>
<span class="sd">                | uSelfMap texture (if not None: any color input is ignored !)</span>
<span class="sd">            :blendmode:</span>
<span class="sd">                | hg.BM_Opaque, optional</span>
<span class="sd">                | Blend mode</span>
<span class="sd">            :faceculling:</span>
<span class="sd">                | hg.FC_CounterClockwise</span>
<span class="sd">                | Sets face culling (hg.FC_CounterClockwise, hg.FC_Clockwise, hg.FC_Disabled)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uSelfMapTexture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span>
        <span class="k">if</span> <span class="n">uBaseOpacityColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">uBaseOpacityColor</span> 
        <span class="k">if</span> <span class="n">uSelfColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span>
        <span class="k">if</span> <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span>
        <span class="k">if</span> <span class="n">blend_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">blend_mode</span> <span class="o">=</span> <span class="n">blend_mode</span> 
        <span class="k">if</span> <span class="n">faceculling</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">faceculling</span> <span class="o">=</span> <span class="n">faceculling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">create_material</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shader_prgRef</span><span class="p">,</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> 
                                   <span class="n">ubc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span><span class="p">,</span> 
                                   <span class="n">slf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span><span class="p">,</span> 
                                   <span class="n">orm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">,</span> 
                                   <span class="n">tex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTexture</span><span class="p">,</span>
                                   <span class="n">blend_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blend_mode</span><span class="p">,</span>
                                   <span class="n">faceculling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faceculling</span><span class="p">)</span></div>


<div class="viewcode-block" id="Material.LoadTexturesFromFiles">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Material.LoadTexturesFromFiles">[docs]</a>
    <span class="k">def</span> <span class="nf">LoadTexturesFromFiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texFileList</span><span class="p">,</span> <span class="n">return_type</span> <span class="o">=</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Load textures specified in texFileList (return_type is either a list or dict) </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">texList</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">texFile</span> <span class="ow">in</span> <span class="n">texFileList</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">return_type</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span> 
                <span class="n">texList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">LoadTextureFromFile</span><span class="p">(</span><span class="n">texFile</span><span class="p">,</span> <span class="n">_TEXTURE_FLAGS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">texList</span><span class="p">[</span><span class="n">texFile</span><span class="p">]</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">LoadTextureFromFile</span><span class="p">(</span><span class="n">texFile</span><span class="p">,</span> <span class="n">_TEXTURE_FLAGS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">texList</span> <span class="o">=</span> <span class="n">texList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">texList</span></div>
</div>



<div class="viewcode-block" id="Screen">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Screen">[docs]</a>
<span class="k">class</span> <span class="nc">Screen</span><span class="p">(</span><span class="n">Material</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">scene</span><span class="p">,</span>  <span class="n">shader_prgRef</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span>
                 <span class="n">geometry</span> <span class="o">=</span> <span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">16</span><span class="p">],</span>
                 <span class="n">radius</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
                 <span class="n">subdiv_x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">subdiv_y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">uSelfColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">blend_mode</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">BM_Opaque</span><span class="p">,</span>
                 <span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Define / create a screen to show (image/single-color) texture on.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :scene:</span>
<span class="sd">                | scene object in which to create the camera.</span>
<span class="sd">            :shader_prgRef:</span>
<span class="sd">                | shader program from assets (ref)</span>
<span class="sd">            :resources:</span>
<span class="sd">                | Pipeline resources</span>
<span class="sd">            :geometry:</span>
<span class="sd">                | &#39;sphere&#39;, optional</span>
<span class="sd">                | Geometry of the screen (&#39;sphere&#39;,&#39;quad&#39;)</span>
<span class="sd">            :aspect_ratio:</span>
<span class="sd">                | [1,1], optional</span>
<span class="sd">                | [width, height] relative dimensions of screen </span>
<span class="sd">                | For &#39;sphere&#39;: [1,1])</span>
<span class="sd">                | For &#39;quad&#39;: is used to determine width and height of quad from :radius: (=1/2*diagonal size)</span>
<span class="sd">            :radius:</span>
<span class="sd">                | 4, optional</span>
<span class="sd">                | Radius of sphere or 1/2*length of diagonal of quad. </span>
<span class="sd">            :subdiv_x:</span>
<span class="sd">                | 256, optional</span>
<span class="sd">                | Number of subdivisions along sphere axis or along quad height</span>
<span class="sd">            :subdiv_y:</span>
<span class="sd">                | 256, optional</span>
<span class="sd">                | Number of subdivision along sphere circumference or along quad width</span>
<span class="sd">            :uBaseOpacityColor:</span>
<span class="sd">                | [1.0,1.0,1.0,1.0], optional</span>
<span class="sd">                | uBaseOpacityColor</span>
<span class="sd">            :uOcclusionRoughnessMetalnessColor:</span>
<span class="sd">                | [0.0, 0.0, 0.0, 1.0], optional</span>
<span class="sd">                | uOcclusionRoughnessMetalnessColor</span>
<span class="sd">            :uSelfColor:</span>
<span class="sd">                | [1.0,1.0,1.0,1.0], optional</span>
<span class="sd">                | uSelfColor</span>
<span class="sd">            :uSelfMapTexture:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uSelfMap texture (if not None: any color input is ignored !)</span>
<span class="sd">            :uSelfMapTextureListPreloaded:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | List with preloaded textures (to speed up texture update as it doesn&#39;t need to be read from file anymore while looping over frames)</span>
<span class="sd">            :blend_mode:</span>
<span class="sd">                | hg.BM_Opaque, optional</span>
<span class="sd">                | Blend mode</span>
<span class="sd">            :position:</span>
<span class="sd">                | [0,0,0], optional</span>
<span class="sd">                | Position of screen</span>
<span class="sd">            :rotation:</span>
<span class="sd">                | [0,0,0], optional</span>
<span class="sd">                | Euler rotation angles (°) of screen                                        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">shader_prgRef</span> <span class="o">=</span> <span class="n">shader_prgRef</span><span class="p">,</span>
                         <span class="n">resources</span> <span class="o">=</span> <span class="n">resources</span><span class="p">,</span>
                         <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span><span class="p">,</span>
                         <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">uSelfMapTextureListPreloaded</span><span class="p">,</span>
                         <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">uBaseOpacityColor</span><span class="p">,</span>
                         <span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span><span class="p">,</span>
                         <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">,</span>
                         <span class="n">blend_mode</span> <span class="o">=</span> <span class="n">blend_mode</span><span class="p">,</span>
                         <span class="n">faceculling</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">FC_CounterClockwise</span>
                         <span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">scene</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">aspect_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subdiv_x</span> <span class="o">=</span> <span class="n">subdiv_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subdiv_y</span> <span class="o">=</span> <span class="n">subdiv_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec3</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">hg</span><span class="o">.</span><span class="n">Deg</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">])</span>
                
        <span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s2">&quot;sphere&quot;</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aspect_ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">mdl</span> <span class="o">=</span> <span class="n">CreateSphereModel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdiv_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdiv_y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="s1">&#39;sphere&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdl</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s2">&quot;quad&quot;</span><span class="p">:</span>
    
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="o">/</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># scale width, height with radius, but take radius as half-diagonal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect_ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">mdl</span> <span class="o">=</span> <span class="n">CreatePlaneModel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdiv_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">subdiv_y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="n">AddModel</span><span class="p">(</span><span class="s1">&#39;quad&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mdl</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">TransformationMat4</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">CreateObject</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">])</span>

<div class="viewcode-block" id="Screen.updateScreenMaterial">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Screen.updateScreenMaterial">[docs]</a>
    <span class="k">def</span> <span class="nf">updateScreenMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">uSelfColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">blend_mode</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Update Screen Material</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            </span>
<span class="sd">            :uBaseOpacityColor:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uBaseOpacityColor</span>
<span class="sd">            :uOcclusionRoughnessMetalnessColor:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uOcclusionRoughnessMetalnessColor</span>
<span class="sd">            :uSelfColor:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uSelfColor</span>
<span class="sd">            :uSelfMapTexture:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uSelfMap texture (if not None: any color input is ignored !)</span>
<span class="sd">            :blend_mode:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | Blend mode</span>
<span class="sd">                    </span>
<span class="sd">        Note:</span>
<span class="sd">            * If None: defaults set at initialization are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uSelfMapTexture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span>
        <span class="k">if</span> <span class="n">uBaseOpacityColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">uBaseOpacityColor</span> 
        <span class="k">if</span> <span class="n">uSelfColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span>
        <span class="k">if</span> <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span>
        <span class="k">if</span> <span class="n">blend_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">blend_mode</span> <span class="o">=</span> <span class="n">blend_mode</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">createMaterial</span><span class="p">(</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTexture</span><span class="p">,</span>
                            <span class="n">uSelfColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSelfColor</span><span class="p">,</span> 
                            <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uBaseOpacityColor</span><span class="p">,</span>
                            <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">,</span>
                            <span class="n">blend_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blend_mode</span><span class="p">,</span>
                            <span class="n">faceculling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faceculling</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">RemoveObject</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">CreateObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Screen.updateScreenMaterialTexture">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Screen.updateScreenMaterialTexture">[docs]</a>
    <span class="k">def</span> <span class="nf">updateScreenMaterialTexture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Update the texture of the Harfang material.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">           :uSelfMapTexture:</span>
<span class="sd">               | New texture (string with filename)</span>
<span class="sd">           :uSelfMapTextureListPreloaded:</span>
<span class="sd">                | None, optional </span>
<span class="sd">                | List with preloaded textures (to speed up texture update as it doesn&#39;t need to be read from file anymore while looping over frames)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uSelfMapTexture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">uSelfMapTextureListPreloaded</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">texList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                        <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">texList</span>
            <span class="c1"># else:</span>
            <span class="c1">#     self.texList = uSelfMapTextureListPreloaded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">update_material_texture</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> <span class="n">uSelfMapTexture</span><span class="p">,</span> <span class="n">mat_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                                               <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;uSelfMap&quot;</span><span class="p">,</span> <span class="n">stage</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">texListPreloaded</span> <span class="o">=</span> <span class="n">uSelfMapTextureListPreloaded</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span></div>
</div>

    

<div class="viewcode-block" id="Eye">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Eye">[docs]</a>
<span class="k">class</span> <span class="nc">Eye</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">eye</span><span class="p">,</span> 
                 <span class="n">vrFlag</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                 <span class="n">shader_assetPath</span> <span class="o">=</span> <span class="s1">&#39;core/shader/pbr.hps&#39;</span><span class="p">,</span>
                 <span class="n">scene_canvasColorI</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="n">scene_ambientEnvColorI</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                 <span class="n">cam_pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                 <span class="n">cam_rot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                 <span class="n">cam_zNear</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
                 <span class="n">cam_zFar</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                 <span class="n">cam_fov</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                 <span class="n">screen_geometry</span> <span class="o">=</span> <span class="s1">&#39;sphere&#39;</span><span class="p">,</span>
                 <span class="n">screen_aspectRatio</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">screen_radius</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">screen_subdiv_x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">screen_subdiv_y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">screen_uBaseOpacityColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">screen_uSelfColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">screen_uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">screen_blend_mode</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">BM_Opaque</span><span class="p">,</span>
                 <span class="n">screen_pos</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">screen_rot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                 <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize pipeline, get pipeline resources, render_data, OpenVR </span>
<span class="sd">        and create scene, shader, camera, material and screen for a specified eye.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :eye:</span>
<span class="sd">                | 0 (left) or 1 (right) indicator</span>
<span class="sd">            :vrFlag:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: use VR head-mounted-display</span>
<span class="sd">            :oher args:</span>
<span class="sd">                | See __doc__ for Scene, Shader, Camera, Material and Screen classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eye</span> <span class="o">=</span> <span class="n">eye</span> <span class="c1"># 0: left, 1: right</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">CreateForwardPipeline</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">PipelineResources</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">render_data</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">SceneForwardPipelineRenderData</span><span class="p">()</span>  <span class="c1"># this object is used by the low-level scene rendering API to share view-independent data with both eyes</span>
        
        <span class="c1"># Create OpenVrFrameBuffer:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrFlag</span> <span class="o">=</span> <span class="n">vrFlag</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrFlag</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hg</span><span class="o">.</span><span class="n">OpenVRInit</span><span class="p">():</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vr_fb</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">OpenVRCreateEyeFrameBuffer</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">OVRAA_MSAA4x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vr_fb</span> <span class="o">=</span> <span class="kc">None</span>
          
            
        <span class="bp">self</span><span class="o">.</span><span class="n">shader</span> <span class="o">=</span> <span class="n">Shader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> <span class="n">assetPath</span> <span class="o">=</span> <span class="n">shader_assetPath</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span> <span class="o">=</span> <span class="n">Scene</span><span class="p">(</span><span class="n">canvasColorI</span> <span class="o">=</span> <span class="n">scene_canvasColorI</span><span class="p">,</span> <span class="n">ambientEnvColorI</span> <span class="o">=</span> <span class="n">scene_ambientEnvColorI</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span> 
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">Camera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">cam_pos</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="n">cam_rot</span><span class="p">,</span> <span class="n">zNear</span> <span class="o">=</span> <span class="n">cam_zNear</span><span class="p">,</span> <span class="n">zFar</span> <span class="o">=</span> <span class="n">cam_zFar</span><span class="p">,</span> <span class="n">fov</span> <span class="o">=</span> <span class="n">cam_fov</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_screen</span> <span class="o">=</span> <span class="n">Screen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shader</span><span class="o">.</span><span class="n">prgRef</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> 
                             <span class="n">geometry</span> <span class="o">=</span> <span class="n">screen_geometry</span><span class="p">,</span> 
                             <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">screen_aspectRatio</span><span class="p">,</span>
                             <span class="n">radius</span> <span class="o">=</span> <span class="n">screen_radius</span><span class="p">,</span> 
                             <span class="n">subdiv_x</span> <span class="o">=</span> <span class="n">screen_subdiv_x</span><span class="p">,</span> 
                             <span class="n">subdiv_y</span> <span class="o">=</span> <span class="n">screen_subdiv_y</span><span class="p">,</span>
                             <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">screen_uSelfMapTexture</span><span class="p">,</span> 
                             <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">screen_uSelfMapTextureListPreloaded</span><span class="p">,</span>
                             <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">screen_uBaseOpacityColor</span><span class="p">,</span>
                             <span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">screen_uSelfColor</span><span class="p">,</span> 
                             <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">screen_uOcclusionRoughnessMetalnessColor</span><span class="p">,</span>
                             <span class="n">blend_mode</span> <span class="o">=</span> <span class="n">screen_blend_mode</span><span class="p">,</span>
                             <span class="n">position</span> <span class="o">=</span> <span class="n">screen_pos</span><span class="p">,</span> 
                             <span class="n">rotation</span> <span class="o">=</span> <span class="n">screen_rot</span>
                             <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_screen</span><span class="o">.</span><span class="n">screen</span>
     
<div class="viewcode-block" id="Eye.updateScreenMaterial">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Eye.updateScreenMaterial">[docs]</a>
    <span class="k">def</span> <span class="nf">updateScreenMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                       <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                       <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uSelfColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">blend_mode</span> <span class="o">=</span> <span class="kc">None</span>
                       <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Update Screen Material (see Screen.updateScreenMaterial.__doc__) &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_screen</span><span class="o">.</span><span class="n">updateScreenMaterial</span><span class="p">(</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span><span class="p">,</span>
                                    <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">uBaseOpacityColor</span><span class="p">,</span>
                                    <span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span><span class="p">,</span> 
                                    <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">,</span>
                                    <span class="n">blend_mode</span> <span class="o">=</span> <span class="n">blend_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_screen</span><span class="o">.</span><span class="n">screen</span></div>

        
<div class="viewcode-block" id="Eye.updateScreenMaterialTexture">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Eye.updateScreenMaterialTexture">[docs]</a>
    <span class="k">def</span> <span class="nf">updateScreenMaterialTexture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Update Screen MaterialTexture (see Screen.updtateScreenMaterialTexture.__doc__) &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_screen</span><span class="o">.</span><span class="n">updateScreenMaterialTexture</span><span class="p">(</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span><span class="p">,</span>
                                                 <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">uSelfMapTextureListPreloaded</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_screen</span><span class="o">.</span><span class="n">screen</span></div>

        
        

<div class="viewcode-block" id="Eye.SceneForwardPipelinePassViewId_PrepareSceneForwardPipelineCommonRenderData">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Eye.SceneForwardPipelinePassViewId_PrepareSceneForwardPipelineCommonRenderData">[docs]</a>
    <span class="k">def</span> <span class="nf">SceneForwardPipelinePassViewId_PrepareSceneForwardPipelineCommonRenderData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># vid = 0  # keep track of the next free view id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vid</span> <span class="o">=</span> <span class="n">vid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passId</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">SceneForwardPipelinePassViewId</span><span class="p">()</span>
    
        <span class="c1"># Prepare view-independent render data once</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passId</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">PrepareSceneForwardPipelineCommonRenderData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passId</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Eye.PrepareSceneForwardPipelineViewDependentRenderData_SubmitSceneToForwardPipeline">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Eye.PrepareSceneForwardPipelineViewDependentRenderData_SubmitSceneToForwardPipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">PrepareSceneForwardPipelineViewDependentRenderData_SubmitSceneToForwardPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">vr_eye_rect</span><span class="p">,</span> <span class="n">isMainScreen</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passId</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">PrepareSceneForwardPipelineViewDependentRenderData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passId</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isMainScreen</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passId</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">SubmitSceneToForwardPipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="n">vr_eye_rect</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vr_fb</span><span class="o">.</span><span class="n">GetHandle</span><span class="p">()</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">passId</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">SubmitSceneToForwardPipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">,</span> <span class="n">vr_eye_rect</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resources</span> <span class="p">)</span></div>


<div class="viewcode-block" id="Eye.DestroyForwardPipeline">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.Eye.DestroyForwardPipeline">[docs]</a>
    <span class="k">def</span> <span class="nf">DestroyForwardPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">hg</span><span class="o">.</span><span class="n">DestroyForwardPipeline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline</span><span class="p">)</span></div>
</div>

        
        
        
<span class="k">def</span> <span class="nf">_processMaterialInput</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="n">equiRectImageLeftPos</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Process material input (helper function)&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Input must be list, tuple, hg.Vec3, str, None&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span> <span class="c1"># already L, R splitted</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">):</span> <span class="c1"># single input</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># single input</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">_processEquiRectImagePath</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="n">equiRectImageLeftPos</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="c1"># multiple input?</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Color specification requires 4 numbers&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">Vec4</span><span class="p">):</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xi</span><span class="p">,</span><span class="n">xi</span><span class="p">))</span> 
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_processEquiRectImagePath</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="n">equiRectImageLeftPos</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xi</span><span class="p">,</span><span class="n">xi</span><span class="p">))</span> 
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">xi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">X</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span>
            
                
            

<div class="viewcode-block" id="HmdStereoViewer">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer">[docs]</a>
<span class="k">class</span> <span class="nc">HmdStereoViewer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vrFlag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vsync</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">multisample</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">cam_fov</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
                 <span class="n">windowWidth</span> <span class="o">=</span> <span class="n">_SCREEN_TEX_WH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">windowHeight</span> <span class="o">=</span> <span class="n">_SCREEN_TEX_WH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                 <span class="n">windowTitle</span> <span class="o">=</span> <span class="s2">&quot;Harfang3d - Stereoscopic Viewer&quot;</span><span class="p">,</span>
                 <span class="n">mainScreenIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">screen_geometry</span> <span class="o">=</span> <span class="s1">&#39;sphere&#39;</span><span class="p">,</span>
                 <span class="n">screen_aspectRatio</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">screen_radius</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                 <span class="n">screen_subdiv_x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">screen_subdiv_y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">,</span>
                 <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                 <span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
                 <span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span>
                 <span class="n">screen_uBaseOpacityColor</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]],</span>
                 <span class="n">screen_uSelfColor</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]],</span>
                 <span class="n">screen_uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]],</span>
                 <span class="n">screen_blend_mode</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">BM_Opaque</span><span class="p">,</span> 
                 <span class="n">screen_position</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">screen_rotation</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">pipeFcns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize Stereo HMD Viewer.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :vrFlag:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: use VR Head-Mounted_display</span>
<span class="sd">            :vsync:</span>
<span class="sd">                | True, optional</span>
<span class="sd">                | If True: Turn V-Sync on.</span>
<span class="sd">            :multisample:</span>
<span class="sd">                | 4, optional</span>
<span class="sd">                | Multi-sample anti-aliasing (options: None, 4, 8)</span>
<span class="sd">            :windowWidth, windowHeight:</span>
<span class="sd">                | _SCREEN_TEX_WH[0], _SCREEN_TEX_WH[1] , optional</span>
<span class="sd">                | Width and height of main screen window.</span>
<span class="sd">            :windowTitle:</span>
<span class="sd">                | &quot;Harfang3d - Stereoscopic Viewer&quot;, optional</span>
<span class="sd">                | String with title of main screen window</span>
<span class="sd">            :mainScreenIdx:</span>
<span class="sd">                | 0, optional</span>
<span class="sd">                | Index to eye (0: left, 1: right) to display on main screen window.</span>
<span class="sd">            :screen_geometry:</span>
<span class="sd">                | &#39;sphere&#39;, optional</span>
<span class="sd">                | Geometry of the screen (&#39;sphere&#39;,&#39;quad&#39;)</span>
<span class="sd">            :screen_aspectRatio:</span>
<span class="sd">                | [1,1], optional</span>
<span class="sd">                | [width, height] relative dimensions of screen </span>
<span class="sd">                | For &#39;sphere&#39;: [1,1])</span>
<span class="sd">                | For &#39;quad&#39;: is used to determine width and height of quad from :radius: (=1/2*diagonal size)</span>
<span class="sd">            :screen_radius:</span>
<span class="sd">                | 10, optional</span>
<span class="sd">                | Radius of sphere or 1/2*length of diagonal of quad. </span>
<span class="sd">            :screen_subdiv_x:</span>
<span class="sd">                | 256, optional</span>
<span class="sd">                | Number of subdivisions along sphere axis or along quad height</span>
<span class="sd">            :screen_subdiv_y:</span>
<span class="sd">                | 256, optional</span>
<span class="sd">                | Number of subdivision along sphere circumference or along quad width</span>
<span class="sd">            :equiRectImageLeftPos:</span>
<span class="sd">                | &#39;bottom&#39;, optional</span>
<span class="sd">                | Specifier for where in the texture image the left sub-image is located.</span>
<span class="sd">                | options: &#39;bottom&#39;, &#39;top&#39;, &#39;left&#39;, &#39;right&#39;, None</span>
<span class="sd">                | If None: there are no separate left/right sub-images in the texture image file.</span>
<span class="sd">            :equiRectImageLeftIsRight:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: the image for the left and right eye is the same.</span>
<span class="sd">            :screen_uBaseOpacityColor:</span>
<span class="sd">                | [1.0,1.0,1.0,1.0], optional</span>
<span class="sd">                | uBaseOpacityColor</span>
<span class="sd">            :screen_uOcclusionRoughnessMetalnessColor:</span>
<span class="sd">                | [0.0, 0.0, 0.0, 1.0], optional</span>
<span class="sd">                | uOcclusionRoughnessMetalnessColor</span>
<span class="sd">            :screen_uSelfColor:</span>
<span class="sd">                | [1.0,1.0,1.0,1.0], optional</span>
<span class="sd">                | uSelfColor</span>
<span class="sd">            :screen_uSelfMapTexture:</span>
<span class="sd">                | None or str or list, optional</span>
<span class="sd">                | If None: no texture image used -&gt; color is determine by color input arguments </span>
<span class="sd">                | If str: </span>
<span class="sd">                |     - filename of texture </span>
<span class="sd">                | If list:</span>
<span class="sd">                |     - list of filenames to image textures.</span>
<span class="sd">                |   (if not None: any color input is ignored !)</span>
<span class="sd">            :screen_uSelfMapTextureListPreloaded:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | List with preloaded textures (to speed up texture update as it doesn&#39;t need to be read from file anymore while looping over frames)</span>
<span class="sd">            :screen_blend_mode:</span>
<span class="sd">                | hg.BM_Opaque, optional</span>
<span class="sd">                | Blend mode</span>
<span class="sd">            :screen_position:</span>
<span class="sd">                | [0,0,0], optional</span>
<span class="sd">                | Position of screen</span>
<span class="sd">            :screen_rotation:</span>
<span class="sd">                | [0,0,0], optional</span>
<span class="sd">                | Euler rotation angles (°) of screen   </span>
<span class="sd">            :pipeFcns:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | A list of functions to pipe during while-loop in the .run() class method.</span>
<span class="sd">                | If None: use defaults. (These will loop through all images)</span>
<span class="sd">                | Default has 3: </span>
<span class="sd">                |   - init (initialize a state list),</span>
<span class="sd">                |   - update (update texture),</span>
<span class="sd">                |   - action (do some action, e.g. measure; default fcn causes a delay of the update to next texture)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">vrFlag</span> <span class="o">=</span> <span class="n">vrFlag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multisample</span> <span class="o">=</span> <span class="n">multisample</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">vsync</span> <span class="o">=</span> <span class="n">vsync</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam_fov</span> <span class="o">=</span> <span class="n">cam_fov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowWidth</span> <span class="o">=</span> <span class="n">windowWidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowHeight</span> <span class="o">=</span> <span class="n">windowHeight</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">windowTitle</span> <span class="o">=</span> <span class="n">windowTitle</span> <span class="o">+</span><span class="s1">&#39; - [</span><span class="si">{:s}</span><span class="s1"> eye image]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="s1">&#39;Left&#39;</span><span class="p">,</span><span class="s1">&#39;Right&#39;</span><span class="p">][</span><span class="n">mainScreenIdx</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assetsFolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_PKG_PATH</span><span class="p">,</span><span class="s2">&quot;assets_compiled&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">init_main</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_geometry</span> <span class="o">=</span> <span class="n">screen_geometry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_aspectRatio</span> <span class="o">=</span> <span class="n">screen_aspectRatio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_radius</span> <span class="o">=</span> <span class="n">screen_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_subdiv_x</span> <span class="o">=</span> <span class="n">screen_subdiv_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_subdiv_y</span> <span class="o">=</span> <span class="n">screen_subdiv_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_position</span> <span class="o">=</span> <span class="n">screen_position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_rotation</span> <span class="o">=</span> <span class="n">screen_rotation</span>
        
        <span class="c1"># set textures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prmatin</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_processMaterialInput</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="n">equiRectImageLeftPos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="n">equiRectImageLeftPos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="n">equiRectImageLeftIsRight</span>
        <span class="k">if</span> <span class="n">screen_uSelfMapTexture</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_texture</span><span class="p">(</span><span class="n">screen_uSelfMapTexture</span><span class="p">,</span>
                         <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="n">equiRectImageLeftPos</span><span class="p">,</span> 
                         <span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="n">equiRectImageLeftIsRight</span><span class="p">,</span>
                         <span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">screen_uSelfMapTextureListPreloaded</span>
                         <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screen_uBaseOpacityColor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uBaseOpacityColorList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prmatin</span><span class="p">(</span><span class="n">screen_uBaseOpacityColor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfColor</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfColorList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prmatin</span><span class="p">(</span><span class="n">screen_uSelfColor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_uOcclusionRoughnessMetalnessColor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uOcclusionRoughnessMetalnessColorList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prmatin</span><span class="p">(</span><span class="n">screen_uOcclusionRoughnessMetalnessColor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen_blend_mode</span> <span class="o">=</span> <span class="n">screen_blend_mode</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span> <span class="o">=</span> <span class="n">Eye</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vrFlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrFlag</span><span class="p">,</span> <span class="n">cam_fov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_fov</span><span class="p">,</span> 
                        <span class="n">screen_geometry</span> <span class="o">=</span> <span class="n">screen_geometry</span><span class="p">,</span>
                        <span class="n">screen_aspectRatio</span> <span class="o">=</span> <span class="n">screen_aspectRatio</span><span class="p">,</span>
                        <span class="n">screen_radius</span> <span class="o">=</span> <span class="n">screen_radius</span><span class="p">,</span>
                        <span class="n">screen_subdiv_x</span> <span class="o">=</span> <span class="n">screen_subdiv_x</span><span class="p">,</span>
                        <span class="n">screen_subdiv_y</span> <span class="o">=</span> <span class="n">screen_subdiv_y</span><span class="p">,</span>
                        <span class="n">screen_uBaseOpacityColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uBaseOpacityColor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">screen_uSelfColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfColor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">screen_uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uOcclusionRoughnessMetalnessColor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTexture</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">screen_blend_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_blend_mode</span><span class="p">,</span>
                        <span class="n">screen_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_position</span><span class="p">,</span>
                        <span class="n">screen_rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_rotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span> <span class="o">=</span> <span class="n">Eye</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">vrFlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrFlag</span><span class="p">,</span> <span class="n">cam_fov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_fov</span><span class="p">,</span> 
                         <span class="n">screen_geometry</span> <span class="o">=</span> <span class="n">screen_geometry</span><span class="p">,</span>
                         <span class="n">screen_aspectRatio</span> <span class="o">=</span> <span class="n">screen_aspectRatio</span><span class="p">,</span>
                         <span class="n">screen_radius</span> <span class="o">=</span> <span class="n">screen_radius</span><span class="p">,</span>
                         <span class="n">screen_subdiv_x</span> <span class="o">=</span> <span class="n">screen_subdiv_x</span><span class="p">,</span>
                         <span class="n">screen_subdiv_y</span> <span class="o">=</span> <span class="n">screen_subdiv_y</span><span class="p">,</span>
                         <span class="n">screen_uBaseOpacityColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uBaseOpacityColor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">screen_uSelfColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfColor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">screen_uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uOcclusionRoughnessMetalnessColor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTexture</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">screen_blend_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_blend_mode</span><span class="p">,</span>
                         <span class="n">screen_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_position</span><span class="p">,</span>
                         <span class="n">screen_rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_rotation</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreenIdx</span> <span class="o">=</span> <span class="n">mainScreenIdx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainScreenIdx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">SetCurrentCamera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">cam</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Keyboard</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">Mouse</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">frameCounter</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeFcns</span> <span class="o">=</span> <span class="n">pipeFcns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_defaultPipeFcns</span><span class="p">()</span>
        
<div class="viewcode-block" id="HmdStereoViewer.set_texture">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.set_texture">[docs]</a>
    <span class="k">def</span> <span class="nf">set_texture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">screen_uSelfMapTexture</span><span class="p">,</span>
                    <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                    <span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="p">):</span>
        
        <span class="k">if</span> <span class="n">equiRectImageLeftPos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="n">equiRectImageLeftPos</span>
        <span class="k">if</span> <span class="n">equiRectImageLeftIsRight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="n">equiRectImageLeftIsRight</span>
   
        <span class="c1">#prmatin = lambda x: _processMaterialInput(x, equiRectImageLeftIsRight, equiRectImageLeftPos)</span>
        <span class="k">if</span> <span class="n">screen_uSelfMapTexture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTexture</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prmatin</span><span class="p">(</span><span class="n">screen_uSelfMapTexture</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prmatin</span><span class="p">(</span><span class="n">screen_uSelfMapTextureListPreloaded</span><span class="p">)</span>
        
            <span class="c1"># split in left &amp; right textures</span>
            <span class="n">tmpL</span><span class="p">,</span> <span class="n">tmpR</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span><span class="p">:</span>
                <span class="n">tmpL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmap</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">tmpR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmap</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmpL</span><span class="p">,</span><span class="n">tmpR</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="HmdStereoViewer.init_main">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.init_main">[docs]</a>
    <span class="k">def</span> <span class="nf">init_main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Initialize Input and Window, add folder with compiled assets&quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_assetsFolder</span><span class="p">):</span>
            
            <span class="n">hg</span><span class="o">.</span><span class="n">InputInit</span><span class="p">()</span>
            <span class="n">hg</span><span class="o">.</span><span class="n">WindowSystemInit</span><span class="p">()</span>
            <span class="n">RF_VSync</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">RF_VSync</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vsync</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">RF_MSAA</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">RF_MSAA4X</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multisample</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">RF_MSAA8X</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multisample</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">RenderInit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowWidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowHeight</span><span class="p">,</span> <span class="n">RF_VSync</span> <span class="o">|</span> <span class="n">hg</span><span class="o">.</span><span class="n">RF_MSAA4X</span><span class="p">)</span>

            <span class="n">hg</span><span class="o">.</span><span class="n">AddAssetsFolder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_assetsFolder</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">(</span><span class="s1">&#39;Compiled assets folder &quot;</span><span class="si">{:s}</span><span class="s1">&quot; not found.</span><span class="se">\n</span><span class="s1">Check path or create it by:</span><span class="se">\n</span><span class="s1"> 1)downloading and unzipping &quot;AssetC&quot; from https://dev.harfang3d.com/releases/;</span><span class="se">\n</span><span class="s1"> 2) then dragging the &quot;assets&quot; folder in this toolbox onto the assetc.exe file in the unzipped folder&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_assetsFolder</span><span class="p">))</span></div>

        
                    
<div class="viewcode-block" id="HmdStereoViewer.shutdown">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.shutdown">[docs]</a>
    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Shutdown Pipelines for left and right eyes, Shutdown Render and destroy Window&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">DestroyForwardPipeline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">DestroyForwardPipeline</span><span class="p">()</span>
        <span class="n">hg</span><span class="o">.</span><span class="n">RenderShutdown</span><span class="p">()</span>
        <span class="n">hg</span><span class="o">.</span><span class="n">DestroyWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span></div>

       
    
        
<div class="viewcode-block" id="HmdStereoViewer.updateScreenMaterial">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.updateScreenMaterial">[docs]</a>
    <span class="k">def</span> <span class="nf">updateScreenMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                       <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                       <span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                       <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uSelfColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">blend_mode</span> <span class="o">=</span> <span class="kc">None</span>
                       <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Update Screen Material</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :uSelfMapTexture:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uSelfMap texture (if not None: any color input is ignored !)</span>
<span class="sd">            :equiRectImageLeftPos:</span>
<span class="sd">                | &#39;bottom&#39;, optional</span>
<span class="sd">                | Specifier for where in the texture image the left sub-image is located.</span>
<span class="sd">                | options: &#39;bottom&#39;, &#39;top&#39;, &#39;left&#39;, &#39;right&#39;, None</span>
<span class="sd">                | If None: there are no separate left/right sub-images in the texture image file.</span>
<span class="sd">            :equiRectImageLeftIsRight:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: the image for the left and right eye is the same.</span>
<span class="sd">            :uBaseOpacityColor:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uBaseOpacityColor</span>
<span class="sd">            :uOcclusionRoughnessMetalnessColor:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uOcclusionRoughnessMetalnessColor</span>
<span class="sd">            :uSelfColor:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | uSelfColor</span>
<span class="sd">            :blend_mode:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | Blend mode</span>
<span class="sd">                    </span>
<span class="sd">        Note:</span>
<span class="sd">            * If None: defaults set at initialization are used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">equiRectImageLeftIsRight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="n">equiRectImageLeftIsRight</span> 
        <span class="k">if</span> <span class="n">equiRectImageLeftPos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="n">equiRectImageLeftPos</span>
        <span class="n">uSelfMapTextures</span> <span class="o">=</span> <span class="n">_processEquiRectImagePath</span><span class="p">(</span><span class="n">uSelfMapTexture</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftPos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">uSelfMapTextures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_L.&#39;</span> <span class="ow">in</span> <span class="n">uSelfMapTexture</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;_R.&#39;</span> <span class="ow">in</span> <span class="n">uSelfMapTexture</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span>
        <span class="k">if</span> <span class="n">uBaseOpacityColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uBaseOpacityColor</span> <span class="o">=</span> <span class="n">uBaseOpacityColor</span>
        <span class="k">if</span> <span class="n">uSelfColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span>
        <span class="k">if</span> <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span>
        <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="p">(</span><span class="n">uBaseOpacityColor</span><span class="p">,</span> <span class="n">uBaseOpacityColor</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uBaseOpacityColor</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uBaseOpacityColor</span>
        <span class="n">uSelfColor</span> <span class="o">=</span> <span class="p">(</span><span class="n">uSelfColor</span><span class="p">,</span> <span class="n">uSelfColor</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfColor</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfColor</span>
        <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="p">(</span><span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">,</span> <span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uOcclusionRoughnessMetalnessColor</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uOcclusionRoughnessMetalnessColor</span> 
        <span class="k">if</span> <span class="n">blend_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_blend_mode</span> <span class="o">=</span> <span class="n">blend_mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterial</span><span class="p">(</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTextures</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">uBaseOpacityColor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                 <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">blend_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_blend_mode</span>
                                 <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterial</span><span class="p">(</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTextures</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                 <span class="n">uBaseOpacityColor</span> <span class="o">=</span> <span class="n">uBaseOpacityColor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                 <span class="n">uSelfColor</span> <span class="o">=</span> <span class="n">uSelfColor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                 <span class="n">uOcclusionRoughnessMetalnessColor</span> <span class="o">=</span> <span class="n">uOcclusionRoughnessMetalnessColor</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                 <span class="n">blend_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_blend_mode</span>
                                 <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainScreenIdx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span></div>

        
        
<div class="viewcode-block" id="HmdStereoViewer.updateScreenMaterialTexture">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.updateScreenMaterialTexture">[docs]</a>
    <span class="k">def</span> <span class="nf">updateScreenMaterialTexture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                    <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Update the texture of the Harfang material.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :uSelfMapTexture:</span>
<span class="sd">                | New texture (string with filename)</span>
<span class="sd">            :equiRectImageLeftPos:</span>
<span class="sd">                | &#39;bottom&#39;, optional</span>
<span class="sd">                | Specifier for where in the texture image the left sub-image is located.</span>
<span class="sd">                | options: &#39;bottom&#39;, &#39;top&#39;, &#39;left&#39;, &#39;right&#39;, None</span>
<span class="sd">                | If None: there are no separate left/right sub-images in the texture image file.</span>
<span class="sd">            :equiRectImageLeftIsRight:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: the image for the left and right eye is the same.</span>
<span class="sd">            :uSelfMapTextureListPreloaded:</span>
<span class="sd">                 | None, optional </span>
<span class="sd">                 | List with preloaded textures (to speed up texture update as it doesn&#39;t need to be read from file anymore while looping over frames)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">equiRectImageLeftIsRight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="n">equiRectImageLeftIsRight</span> 
        <span class="k">if</span> <span class="n">equiRectImageLeftPos</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="n">equiRectImageLeftPos</span>
        <span class="n">uSelfMapTextures</span> <span class="o">=</span> <span class="n">_processEquiRectImagePath</span><span class="p">(</span><span class="n">uSelfMapTexture</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equiRectImageLeftPos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">uSelfMapTextures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;_L.&#39;</span> <span class="ow">in</span> <span class="n">uSelfMapTexture</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;_R.&#39;</span> <span class="ow">in</span> <span class="n">uSelfMapTexture</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTexture</span>

        <span class="k">if</span> <span class="n">uSelfMapTextureListPreloaded</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">uSelfMapTextureListPreloaded</span> <span class="c1"># must be supplied for both left and right !!</span>
        <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="p">(</span><span class="n">uSelfMapTextureListPreloaded</span><span class="p">,</span> <span class="n">uSelfMapTextureListPreloaded</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureListPreloaded</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterialTexture</span><span class="p">(</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTextures</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">uSelfMapTextureListPreloaded</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterialTexture</span><span class="p">(</span><span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">uSelfMapTextures</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">uSelfMapTextureListPreloaded</span> <span class="o">=</span> <span class="n">uSelfMapTextureListPreloaded</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainScreenIdx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span></div>


        
<div class="viewcode-block" id="HmdStereoViewer.resetFrameNumber">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.resetFrameNumber">[docs]</a>
    <span class="k">def</span> <span class="nf">resetFrameNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Reset the frame number &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frameNumber</span> <span class="o">=</span> <span class="mi">0</span></div>

    
<div class="viewcode-block" id="HmdStereoViewer.getFrameNumber">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.getFrameNumber">[docs]</a>
    <span class="k">def</span> <span class="nf">getFrameNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Get the current frame number &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameNumber</span></div>

    
<div class="viewcode-block" id="HmdStereoViewer.display">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.display">[docs]</a>
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Display the texture (first one from list, use run() to loop through all of them) &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetFrameNumber</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">texL</span><span class="p">,</span> <span class="n">texR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># get texture fileNames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterialTexture</span><span class="p">(</span> <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">texL</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterialTexture</span><span class="p">(</span> <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">texR</span> <span class="p">)</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="n">hg</span><span class="o">.</span><span class="n">ReadKeyboard</span><span class="p">()</span><span class="o">.</span><span class="n">Key</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">K_Escape</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hg</span><span class="o">.</span><span class="n">IsWindowOpen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span></div>

        
        
<div class="viewcode-block" id="HmdStereoViewer.run">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeFcns</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pipeFcnsUpdate</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">only_once</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
            <span class="n">u_delay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">a_delay</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">autoShutdown</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run through all textures specified at initialization (and do some action) .</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :pipeFcns:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | list of piped functions, one executed after the other</span>
<span class="sd">                | If None: use the defaults. This will cause all textures </span>
<span class="sd">                |   specified at initialization to be shown one after the other, with</span>
<span class="sd">                |   delay time set by :delay:. </span>
<span class="sd">                | If not None: use this set of user-defined pipeFcns (see code for example use)</span>
<span class="sd">            :pipeFcnsUpdate:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | Use this list or dictionary to update the pipeFcns specified by :pipeFcns:</span>
<span class="sd">                | This exists to keep e.g. the defaults but only change the &#39;action&#39; part, e.g. to </span>
<span class="sd">                | do a measurement. </span>
<span class="sd">            :only_once:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: loop through the set of textures once and then stop and shutdown.</span>
<span class="sd">            :u_delay:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | Delay in seconds for the update function in the pipeFcns. </span>
<span class="sd">                | This delays the initialization of the action function after </span>
<span class="sd">                | an update of the texture (e.g. to give some time display the update on the HMD)</span>
<span class="sd">                | If None: use whatever is set in the (default) pipeFcns update function.</span>
<span class="sd">                | Else override delay if update function as such a kwarg!</span>
<span class="sd">            :a_delay:</span>
<span class="sd">                | None, optional</span>
<span class="sd">                | Delay in seconds for the action function in the pipeFcns.</span>
<span class="sd">                | This delays the update to the next texture after the action </span>
<span class="sd">                | has been started (e.g. to simulate some action duration)</span>
<span class="sd">                | If None: use whatever is set in the (default) pipeFcns action function.</span>
<span class="sd">                | Else override delay if action function as such a kwarg!</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pipeFcns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pipeFcns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeFcnsDef</span>
        <span class="k">if</span> <span class="n">pipeFcnsUpdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pipeFcnUpdate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeFcnsUpdate</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">pipeFcnUpdate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipeFcnUpdate</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">pipeFcnUpdate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                            <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">pipeFcns</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pipeFcnUpdate</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="n">pipeFcnUpdate</span> 
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipeFcnUpdate</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">pipeFcns</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pipeFcnUpdate</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pipeFcnUpdate</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">pipeFcnUpdate</span>
                    <span class="n">pipeFcns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
        
        <span class="c1"># Update delays in pipeFcns by those from kwargs:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">u_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">a_delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pipeFcn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeFcns</span><span class="p">):</span> 
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;delay&#39;</span> <span class="ow">in</span> <span class="n">pipeFcns</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;check&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">delay</span> <span class="o">=</span> <span class="n">u_delay</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">a_delay</span>
                    <span class="k">if</span> <span class="n">delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">pipeFcns</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;check&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;delay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delay</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resetFrameNumber</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_only_once</span> <span class="o">=</span> <span class="n">only_once</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">hg</span><span class="o">.</span><span class="n">ReadKeyboard</span><span class="p">()</span><span class="o">.</span><span class="n">Key</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">K_Escape</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hg</span><span class="o">.</span><span class="n">IsWindowOpen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">):</span>
            
            
            <span class="k">if</span> <span class="n">pipeFcns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># execute a pipeline of functions:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pipeFcns</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">fcnIdx</span><span class="p">,</span> <span class="p">(</span><span class="n">pipeFcn</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pipeFcns</span><span class="p">):</span> 
                        <span class="c1"># print(&#39;in : &#39;, self.frameNumber, fcnIdx, out) # code check</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">pipeFcn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                        <span class="c1"># print(&#39;out: &#39;, self.frameNumber, fcnIdx, out) # code check</span>
                    <span class="c1"># if self.frameNumber &gt;= 150: # code check</span>
                    <span class="c1">#     break                   # code check</span>
             
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;break&#39;</span><span class="p">):</span> 
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="n">autoShutdown</span><span class="p">:</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span></div>

        

<div class="viewcode-block" id="HmdStereoViewer.frame">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.frame">[docs]</a>
    <span class="k">def</span> <span class="nf">frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Run everything required to update a frame &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">TickClock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
    
        <span class="n">hg</span><span class="o">.</span><span class="n">FpsController</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rot</span><span class="p">,</span> <span class="mi">20</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyboard</span><span class="o">.</span><span class="n">Down</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">K_LShift</span><span class="p">)</span> <span class="k">else</span> <span class="mi">8</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">GetTransform</span><span class="p">()</span><span class="o">.</span><span class="n">SetPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">cam</span><span class="o">.</span><span class="n">GetTransform</span><span class="p">()</span><span class="o">.</span><span class="n">SetRot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">SceneForwardPipelinePassViewId_PrepareSceneForwardPipelineCommonRenderData</span><span class="p">(</span><span class="n">vid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">SceneForwardPipelinePassViewId_PrepareSceneForwardPipelineCommonRenderData</span><span class="p">(</span><span class="n">vid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">vr_fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">vr_fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">actor_body_mtx</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">TransformationMat4</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">rot</span><span class="p">)</span>
            <span class="n">vr_state</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">OpenVRGetState</span><span class="p">(</span><span class="n">actor_body_mtx</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">vs_left</span><span class="p">,</span> <span class="n">vs_right</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">OpenVRStateToViewState</span><span class="p">(</span><span class="n">vr_state</span><span class="p">)</span>
            
            <span class="n">vr_eye_rect</span> <span class="o">=</span> <span class="n">hg</span><span class="o">.</span><span class="n">IntRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vr_state</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">vr_state</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

            <span class="c1"># Prepare the left eye render data then draw to its framebuffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">PrepareSceneForwardPipelineViewDependentRenderData_SubmitSceneToForwardPipeline</span><span class="p">(</span><span class="n">vs_left</span><span class="p">,</span> <span class="n">vr_eye_rect</span><span class="p">)</span>
            
            <span class="c1"># Prepare the right eye render data then draw to its framebuffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">PrepareSceneForwardPipelineViewDependentRenderData_SubmitSceneToForwardPipeline</span><span class="p">(</span><span class="n">vs_right</span><span class="p">,</span> <span class="n">vr_eye_rect</span><span class="p">)</span>
            
    
        <span class="c1"># Main screen:</span>
        <span class="n">vs_main</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">ComputeCurrentCameraViewState</span><span class="p">(</span><span class="n">hg</span><span class="o">.</span><span class="n">ComputeAspectRatioX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowWidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowHeight</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainScreen</span><span class="o">.</span><span class="n">PrepareSceneForwardPipelineViewDependentRenderData_SubmitSceneToForwardPipeline</span><span class="p">(</span><span class="n">vs_main</span><span class="p">,</span> <span class="n">hg</span><span class="o">.</span><span class="n">IntRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowWidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowHeight</span><span class="p">),</span> <span class="n">isMainScreen</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        
        
        <span class="n">hg</span><span class="o">.</span><span class="n">Frame</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">vr_fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">vr_fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">hg</span><span class="o">.</span><span class="n">OpenVRSubmitFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">vr_fb</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">vr_fb</span><span class="p">)</span>
        
        <span class="n">hg</span><span class="o">.</span><span class="n">UpdateWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frameNumber</span> <span class="o">+=</span> <span class="mi">1</span></div>

            
<div class="viewcode-block" id="HmdStereoViewer.generate_defaultPipeFcns">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.HmdStereoViewer.generate_defaultPipeFcns">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_defaultPipeFcns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pipeFcnDef</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generate default pipeline functions (if pipeFcnDef not None: use these) &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pipeFcnDef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#==============================================================================</span>
            <span class="c1"># Execute some things during each frame -&gt; control flow functions</span>
    
            <span class="c1">#------------------------------------------------------------------------------</span>
            <span class="c1"># Pipe function definitions</span>
            <span class="c1">#------------------------------------------------------------------------------</span>
            <span class="c1"># Interface: </span>
            <span class="c1">#    (fcn, kwargs) </span>
            <span class="c1">#       with fcn(self, frameNumber, output_previous_pipe_fcn, pipe_fcn_kwargs)</span>
            <span class="c1">#           with everything a tuple with elements: </span>
            <span class="c1">#             - windowProps, keyboard/mouse, mainScreen, leftEyeScreen, rightEyescreen</span>
            <span class="c1">#------------------------------------------------------------------------------ </span>
    
            <span class="c1"># Define pipe_fcn 0:</span>
            <span class="k">def</span> <span class="nf">initWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Initialize the state array&quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>     
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">out</span>  
                
            <span class="c1"># Define pipe_fcn 1:   </span>
            <span class="k">def</span> <span class="nf">updateWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Wrapper function (cfr. control flow) around texture update function&quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">out</span>
                <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># if action finished set new stimulus</span>
                    <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">check</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>   
                    <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e100</span>
                <span class="k">return</span> <span class="n">out</span>
    
            <span class="c1"># Define pipe_fcn 2</span>
            <span class="k">def</span> <span class="nf">actionWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="n">check</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Wrapper function (cfr. control flow) around texture action function&quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">out</span>
                <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># -&gt; fcn1 finished</span>
                    <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># action is only about to start (so not yet finished) -&gt; don&#39;t change tex !</span>
                    <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># reset texReady flag, next tex is not ready yet as we&#39;re still doing something with the current one</span>
                    <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Normaly: this is where the start of the action (e.g. measurement) happens</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">check</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># ? action finished ?</span>
                    <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># move to next tex</span>
                        <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># reset texReady flag</span>
                        <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e100</span>
                        <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e100</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_only_once</span><span class="p">:</span> 
                            <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_stimuli</span><span class="p">:</span>
                                <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;break&#39;</span>
                 
                <span class="k">return</span> <span class="n">out</span>
    
            <span class="k">def</span> <span class="nf">i_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Action to do at init (= setting the state array)&quot;&quot;&quot;</span>
                <span class="k">return</span> <span class="p">[[</span><span class="kc">False</span><span class="p">,</span> <span class="mf">1e100</span><span class="p">],</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="mf">1e100</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># [[updateReady, UpdateOut (=tstart)], [[ActionReady, ActionOut (=tstart)]], texNumber] </span>
            
            <span class="k">def</span> <span class="nf">u_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Action to do at update (= change texture) &quot;&quot;&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_stimuli</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">texIdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_stimuli</span><span class="p">)</span> <span class="c1"># % n because only n images in example, normally: comment this line and use out[2] as the index into the texList</span>
                <span class="n">texL</span><span class="p">,</span> <span class="n">texR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">texIdx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen_uSelfMapTextureList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">texIdx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># get texture fileNames</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leftEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterialTexture</span><span class="p">(</span> <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">texL</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rightEyeScreen</span><span class="o">.</span><span class="n">updateScreenMaterialTexture</span><span class="p">(</span> <span class="n">uSelfMapTexture</span> <span class="o">=</span> <span class="n">texR</span> <span class="p">)</span>
                <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            
            <span class="k">def</span> <span class="nf">u_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Check to do at update (= check whether the delay before texture action function can be run, to make sure image has already displayed fully on HMD) &quot;&quot;&quot;</span>
                <span class="n">t_now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
                <span class="n">dt</span> <span class="o">=</span> <span class="n">t_now</span> <span class="o">-</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> 
                <span class="k">return</span> <span class="n">dt</span> <span class="o">&gt;=</span> <span class="n">delay</span>
    
            <span class="k">def</span> <span class="nf">a_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Action to do at action (= start timer to create a delay as default or e.g. start some measurement when user creates his own a_action function and updates the default pipelineFcns) &quot;&quot;&quot;</span>
                <span class="n">t_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># e.g. get time or start measurement</span>
                <span class="k">return</span> <span class="n">t_start</span> <span class="c1"># stored in out[3] so it is available for a later check</span>
    
            <span class="k">def</span> <span class="nf">a_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">2</span><span class="p">):</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot; Check to do at action (= check if time since start of timer is larger than delay to create a delay as default or e.g. check whether measurement file exists (indicating finished measurement) when user creates his own a_action function and updates the default pipelineFcns) &quot;&quot;&quot;</span>
                <span class="n">t_now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
                <span class="n">dt</span> <span class="o">=</span> <span class="n">t_now</span> <span class="o">-</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> 
                <span class="k">return</span> <span class="n">dt</span> <span class="o">&gt;=</span> <span class="n">delay</span>
    
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeFcnsDef</span> <span class="o">=</span> <span class="p">[[</span><span class="n">initWrapper</span><span class="p">,</span>   <span class="p">{</span><span class="s1">&#39;action&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">i_action</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;initial_out&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1e100</span><span class="p">]}]}],</span>
                                <span class="p">[</span><span class="n">updateWrapper</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">u_action</span><span class="p">,</span> <span class="p">{}],</span>
                                                 <span class="s1">&#39;check&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="n">u_check</span><span class="p">,</span>  <span class="p">{</span><span class="s1">&#39;delay&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">}]}],</span> <span class="c1"># wait some time so that image can be show on HMD: find by trial-and error. 1 sec should be ok though </span>
                                <span class="p">[</span><span class="n">actionWrapper</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">a_action</span><span class="p">,</span> <span class="p">{}],</span>
                                                 <span class="s1">&#39;check&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="n">a_check</span><span class="p">,</span>  <span class="p">{</span><span class="s1">&#39;delay&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">}]}]</span>
                                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeFcnsDef</span> <span class="o">=</span> <span class="n">pipeFcnDef</span> 
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipeFcnsDef</span></div>
</div>


<span class="c1">#------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">generate_color_texs</span><span class="p">(</span><span class="n">rgba_list</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Generate color textures from rgba_list &quot;&quot;&quot;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">exist_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">texFiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rgba_list</span><span class="p">):</span> 
        <span class="n">texFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">/tex_</span><span class="si">{:1.0f}</span><span class="s1">_</span><span class="si">{:1.0f}</span><span class="s1">_</span><span class="si">{:1.0f}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="o">*</span><span class="n">color</span><span class="p">[:</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">makeColorTex</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">texHeight</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">texWidth</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">save</span> <span class="o">=</span> <span class="n">texFiles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">texFiles</span> <span class="o">=</span> <span class="p">[(</span><span class="n">texFile</span><span class="p">,</span><span class="n">texFile</span><span class="p">)</span> <span class="k">for</span> <span class="n">texFile</span> <span class="ow">in</span> <span class="n">texFiles</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">texFiles</span>

<div class="viewcode-block" id="generate_stimulus_tex_list">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.generate_stimulus_tex_list">[docs]</a>
<span class="k">def</span> <span class="nf">generate_stimulus_tex_list</span><span class="p">(</span><span class="n">stimulus_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                               <span class="n">equiRectImageLeftIsRight</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                               <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> 
                               <span class="n">rgba_save_folder</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Generate a list of textures </span>
<span class="sd">    Args:</span>
<span class="sd">        </span>
<span class="sd">        :stimulus_list:</span>
<span class="sd">            | None or str or list, optional</span>
<span class="sd">            | If None: generate a preset list of rgb colors: np.array([[1,0,0,1],[0,1,0,1],[0,0,1,1],[1,1,0,1],[1,0,1,1],[0,1,1,1]])*255 </span>
<span class="sd">            | If str: </span>
<span class="sd">            |     - filename of texture </span>
<span class="sd">            |     -  or, filename of .iml file  with a list of filenames to textures</span>
<span class="sd">            |           (first line in path should be: &quot;path&quot; followed by the path to the images in the file list)</span>
<span class="sd">            | If list:</span>
<span class="sd">            |     - list of filenames to image textures.</span>
<span class="sd">            |   (if not None: any color input is ignored !)</span>
<span class="sd">            | If ndarray with rgba stimuli :</span>
<span class="sd">            |     - (equiRectImageLeftIsRight, equiRectImageLeftPos) will be updated to (True, None)</span>
<span class="sd">            |     - texture files will be generated in folder</span>
<span class="sd">        :rgba_save_folder:</span>
<span class="sd">            | Folder to save the generated full single-color textures in when stimulus_list is an ndarray or None.</span>
<span class="sd">            </span>
<span class="sd">    Returns:</span>
<span class="sd">        :stimulus_list: </span>
<span class="sd">            | list of stimuli file textures</span>
<span class="sd">        :(equiRectImageLeftIsRight, equiRectImageLeftPos):</span>
<span class="sd">            - equiRectImageLeftIsRight: bool (left image = right image)</span>
<span class="sd">            - equiRectImageLeftPos: string or None </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stimulus_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stimulus_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span><span class="o">*</span><span class="mi">255</span> 
        <span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># single colors so no diff. between left and right</span>
        <span class="n">stimulus_list</span> <span class="o">=</span> <span class="n">generate_color_texs</span><span class="p">(</span><span class="n">rgba_list</span> <span class="o">=</span> <span class="n">stimulus_list</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">rgba_save_folder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stimulus_list</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> 
        <span class="n">path_file</span> <span class="o">=</span> <span class="n">stimulus_list</span>
        <span class="n">mypath</span><span class="p">,</span> <span class="n">myfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">myfile</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.iml&#39;</span><span class="p">):</span> <span class="c1"># get list from file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">stimulus_list</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">ci_path</span> <span class="o">=</span> <span class="n">stimulus_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ci_path</span> <span class="o">=</span> <span class="n">mypath</span> <span class="o">+</span> <span class="n">ci_path</span><span class="p">[(</span><span class="n">ci_path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">):]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">stimulus_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ci_path</span><span class="p">,</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">stimulus_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;.iml&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># get list as all files in dir</span>
            <span class="n">stimulus_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">mypath</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mypath</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="p">((</span><span class="s1">&#39;_L&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;_R&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;.iml&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)))]</span>
        
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stimulus_list</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">stimulus_list</span> <span class="o">=</span> <span class="n">generate_color_texs</span><span class="p">(</span><span class="n">rgba_list</span> <span class="o">=</span> <span class="n">stimulus_list</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="n">rgba_save_folder</span><span class="p">)</span>
        <span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="n">equiRectImageLeftPos</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">None</span> <span class="c1"># single colors so no diff. between left and right</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stimulus_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1"># assume list of tex-images</span>
        
    <span class="k">return</span> <span class="n">stimulus_list</span><span class="p">,</span> <span class="p">(</span><span class="n">equiRectImageLeftIsRight</span><span class="p">,</span> <span class="n">equiRectImageLeftPos</span><span class="p">)</span></div>


<span class="c1">#------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="get_rgb_from_rgbtexpath">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.get_rgb_from_rgbtexpath">[docs]</a>
<span class="k">def</span> <span class="nf">get_rgb_from_rgbtexpath</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get rgb values from filename &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[(</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;tex_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">):]</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]),</span> <span class="n">path</span><span class="p">[(</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]),</span> <span class="n">path</span><span class="p">[(</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)])</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">rgb</span></div>


<div class="viewcode-block" id="getRectMask">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.getRectMask">[docs]</a>
<span class="k">def</span> <span class="nf">getRectMask</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="n">shape</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get a boolean rectangular mask with mask-area determined by the (row,col) coordinates of the top-left &amp; bottom-right corners of the ROI &quot;&quot;&quot;</span>
    <span class="n">rm</span><span class="p">,</span> <span class="n">rM</span> <span class="o">=</span> <span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cm</span><span class="p">,</span> <span class="n">cM</span> <span class="o">=</span> <span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> 
    <span class="n">mask</span><span class="p">[(</span><span class="n">r</span><span class="o">&gt;=</span><span class="n">rm</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span><span class="o">&lt;=</span><span class="n">rM</span><span class="p">),:]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">mask</span><span class="p">[:,(</span><span class="n">c</span><span class="o">&gt;=</span><span class="n">cm</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span><span class="o">&lt;=</span><span class="n">cM</span><span class="p">)]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span></div>


<div class="viewcode-block" id="getRoiImage">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.getRoiImage">[docs]</a>
<span class="k">def</span> <span class="nf">getRoiImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">roi</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">getRectMask</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">subimg</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">*</span><span class="p">(</span><span class="n">roi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">roi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">subimg</span></div>


<div class="viewcode-block" id="get_xyz_from_xyzmap_roi">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.get_xyz_from_xyzmap_roi">[docs]</a>
<span class="k">def</span> <span class="nf">get_xyz_from_xyzmap_roi</span><span class="p">(</span><span class="n">xyzmap</span><span class="p">,</span> <span class="n">roi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get xyz values of Region-Of-Interest in XYZ-map &quot;&quot;&quot;</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">xyzmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">M</span><span class="p">,</span><span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">roi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">10</span> <span class="c1"># 1/10 of size of each image dimension</span>
        <span class="n">roi</span> <span class="o">=</span> <span class="p">[[</span><span class="n">M</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="n">M</span><span class="o">//</span><span class="n">f</span><span class="p">,</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="n">N</span><span class="o">//</span><span class="n">f</span><span class="p">],[</span><span class="n">M</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="n">M</span><span class="o">//</span><span class="n">f</span><span class="p">,</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="n">N</span><span class="o">//</span><span class="n">f</span><span class="p">]]</span> <span class="c1"># (upper-left, lower-right) XY of rectangular Region-Of-Interest coordinates</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">getRectMask</span><span class="p">(</span><span class="n">roi</span><span class="p">,</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="n">xyzmap_</span> <span class="o">=</span> <span class="n">xyzmap</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
    <span class="n">xyzmap_</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">xyzmap_</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">],:]</span>
    <span class="k">return</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">xyzmap_</span></div>


<div class="viewcode-block" id="get_rgbFromTexPaths">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.get_rgbFromTexPaths">[docs]</a>
<span class="k">def</span> <span class="nf">get_rgbFromTexPaths</span><span class="p">(</span><span class="n">rgbatexFiles</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get rgb values read from the filenames of the tex-files &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rgbatexFiles</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">rgbatexFiles</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
            <span class="n">rgbatexFiles</span> <span class="o">=</span> <span class="n">fid</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">rgbatexFiles</span> <span class="o">=</span> <span class="n">rgbatexFiles</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># get rid of path line</span>
        <span class="n">rgbatexFiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;tex_&#39;</span><span class="p">):][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rgbatexFiles</span><span class="p">]</span>
    <span class="n">rgbs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rgbatexFile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rgbatexFiles</span><span class="p">):</span>
        <span class="n">rgbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_rgb_from_rgbtexpath</span><span class="p">(</span><span class="n">rgbatexFile</span><span class="p">))</span>  
    <span class="n">rgbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rgbs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rgbs</span>    </div>

    
<span class="k">def</span> <span class="nf">get_avgXYZFromXYZmaps</span><span class="p">(</span><span class="n">xyzmaps</span><span class="p">,</span> <span class="n">roi</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Get average xyz values of Region-Of-Interest in XYZ-maps &quot;&quot;&quot;</span>
    <span class="n">xyzs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">xyzmap</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xyzmaps</span><span class="p">):</span>
        <span class="n">xyzs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_xyz_from_xyzmap_roi</span><span class="p">(</span><span class="n">xyzmap</span><span class="p">,</span> <span class="n">roi</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyzs</span><span class="p">)</span>  
        
    
<div class="viewcode-block" id="generate_rgba_texs_iml">
<a class="viewcode-back" href="../../../../../toolboxes.html#luxpy.toolboxes.stereoscopicviewer.generate_rgba_texs_iml">[docs]</a>
<span class="k">def</span> <span class="nf">generate_rgba_texs_iml</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">rgba_save_folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Generate rgba texture images, save them in a folder and return a list of texFiles and a .iml file with the paths to the texFiles&quot;&quot;&quot;</span>
    <span class="n">rgba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rgb</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">rgb</span><span class="p">[:,:</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mi">255</span><span class="p">))</span> <span class="c1"># add alpha channel required by HMDviewer</span>
    <span class="n">texFiles</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_stimulus_tex_list</span><span class="p">(</span><span class="n">rgba</span><span class="p">,</span> <span class="n">rgba_save_folder</span> <span class="o">=</span> <span class="n">rgba_save_folder</span><span class="p">)</span>
    <span class="n">stimulus_iml</span> <span class="o">=</span> <span class="n">rgba_save_folder</span> <span class="o">+</span> <span class="s1">&#39;stimulus_list.iml&#39;</span>
    <span class="n">texFiles_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;path&#39;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">texFiles</span><span class="p">]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">stimulus_iml</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fid</span><span class="p">:</span>
        <span class="n">fid</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">texFiles_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">texFiles</span><span class="p">,</span> <span class="n">stimulus_iml</span></div>


<span class="c1">#------------------------------------------------------------------------------</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>       
    
    <span class="c1">###############################################################################</span>
    <span class="c1"># Example code on how to:</span>
    <span class="c1">#    - update the action function in the pipeFcns</span>
    <span class="c1">#    - prepare / generate stimulus textures</span>
    <span class="c1">#    - use the Viewer with(out) VR HMD</span>
    <span class="c1">###############################################################################</span>
    
    <span class="c1">#===========================================================================</span>
    <span class="c1"># Tests of different options:</span>
    <span class="c1">#===========================================================================</span>
    
    <span class="c1">#=== Action definitions ===================================================</span>
    <span class="n">use_LMK</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="k">if</span> <span class="n">use_LMK</span><span class="p">:</span>
        <span class="c1">## Setup instance of LMK for measurements:</span>
        <span class="kn">from</span> <span class="nn">luxpy.toolboxes.technoteamlmk</span> <span class="kn">import</span> <span class="n">lmkActiveX</span><span class="p">,</span> <span class="n">kill_lmk4_process</span>
        
        <span class="n">modfrequency</span> <span class="o">=</span> <span class="mi">72</span> <span class="c1"># check what freq. the headset is running on: Quest2: 72 Hz, Rift CV2: 90 Hz</span>
        <span class="n">lmkX</span> <span class="o">=</span> <span class="n">lmkActiveX</span><span class="p">(</span><span class="s1">&#39;tts20035&#39;</span><span class="p">,</span> <span class="s1">&#39;xvr&#39;</span><span class="p">,</span> <span class="n">focusfactor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">autoscan</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">autoexposure</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">modfrequency</span> <span class="o">=</span> <span class="n">modfrequency</span><span class="p">,</span> <span class="n">maxtime</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                          <span class="n">verbosity</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
                           
        <span class="k">def</span> <span class="nf">a_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> 
                     <span class="n">lmkX</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">folder_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">file_name_base</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_name</span><span class="p">):</span> 
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="n">exist_ok</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lmkX</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:1.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">texIdx</span><span class="p">))</span>
                <span class="n">lmkX</span><span class="o">.</span><span class="n">captureXYZmap</span><span class="p">(</span><span class="n">folder_name</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:s}</span><span class="s1">_</span><span class="si">{:1.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">file_name_base</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">texIdx</span><span class="p">))</span>
                
            <span class="k">return</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;.pcf&#39;</span>
    
        <span class="k">def</span> <span class="nf">a_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            
        <span class="n">script_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span> <span class="c1"># LMK save requires absolute path !!!</span>
        
        <span class="n">actionWrapperDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;action&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">a_action</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;lmkX&#39;</span><span class="p">:</span><span class="n">lmkX</span><span class="p">,</span> <span class="s1">&#39;folder_name&#39;</span> <span class="p">:</span> <span class="n">script_path</span><span class="o">+</span><span class="s1">&#39;./lmk_xyzmaps/&#39;</span><span class="p">,</span><span class="s1">&#39;file_name_base&#39;</span><span class="p">:</span><span class="s1">&#39;lmk-ciergbmap&#39;</span><span class="p">}],</span>
                             <span class="s1">&#39;check&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="n">a_check</span><span class="p">,</span>  <span class="p">{}]}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#--------------------------------------------------------------------------</span>
        <span class="k">def</span> <span class="nf">a_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Start timer &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="c1"># stored in out[1][1] so it is available for a later check</span>
    
        <span class="k">def</span> <span class="nf">a_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frameNumber</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Check if delay seconds have passed since start of timer &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">delay</span><span class="p">)</span> <span class="c1"># out[1][1] contains start time</span>
        
        <span class="n">actionWrapperDict</span> <span class="o">=</span>  <span class="p">{</span><span class="s1">&#39;action&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">a_action</span><span class="p">,</span> <span class="p">{}],</span>
                              <span class="s1">&#39;check&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="n">a_check</span><span class="p">,</span>  <span class="p">{</span><span class="s1">&#39;delay&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">}]}</span>
    
    <span class="c1">#==== Prepare stimuli =====================================================</span>
        
    <span class="n">stimulus_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span><span class="o">*</span><span class="mi">255</span>
    <span class="n">texFiles</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generate_stimulus_tex_list</span><span class="p">(</span><span class="n">stimulus_list</span><span class="p">,</span> <span class="n">rgba_save_folder</span> <span class="o">=</span> <span class="s1">&#39;rgba_texs&#39;</span><span class="p">)</span>
    
    <span class="c1"># # Generate stimulus textures:</span>
    <span class="c1"># os.makedirs(&#39;./temp_color_stimulus_folder/&#39;, exist_ok = True)</span>
    <span class="c1"># texFiles = []</span>
    <span class="c1"># for i,color in enumerate(stimulus_list): </span>
    <span class="c1">#     texFiles.append(&#39;./temp_color_stimulus_folder/tex_{:1.0f}_{:1.0f}_{:1.0f}.png&#39;.format(*color[:3]))</span>
    <span class="c1">#     makeColorTex(color, texHeight = 100, texWidth = 100, save = texFiles[-1])</span>
    <span class="c1"># texFiles = [(texFile,texFile) for texFile in texFiles]</span>
    
    <span class="c1"># or load files from folder or list.iml file:</span>
    <span class="c1"># texFiles, _ = generate_stimulus_tex_list(&#39;./spheremaps/list.iml&#39;)</span>
    
    <span class="c1">#==== Prepare hmdviewer ===================================================</span>
    
    <span class="n">hmdviewer</span> <span class="o">=</span> <span class="n">HmdStereoViewer</span><span class="p">(</span><span class="n">screen_uSelfMapTexture</span> <span class="o">=</span> <span class="n">texFiles</span><span class="p">,</span> 
                                <span class="n">screen_geometry</span> <span class="o">=</span> <span class="s1">&#39;sphere&#39;</span><span class="p">,</span><span class="n">vrFlag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># pipeFcns = copy.deepcopy(hmdviewer.pipeFcnsDef) </span>
    <span class="c1"># pipeFcns[-1] = (pipeFcns[-1][0], actionWrapperDict) # replace default action with custom action</span>
    
    <span class="c1"># === Display =============================================================</span>
    
    <span class="c1"># hmdviewer.display()</span>
    
    <span class="c1">#==== Run tests of display + action ========================================</span>
    <span class="c1"># hmdviewer.run()</span>
    <span class="c1"># hmdviewer.run(only_once = True)</span>
    <span class="n">t_begin</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    
    <span class="n">hmdviewer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pipeFcnsUpdate</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">actionWrapperDict</span><span class="p">]],</span>  <span class="n">only_once</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">u_delay</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a_delay</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
       
    <span class="n">t_end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total run time: &#39;</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">-</span> <span class="n">t_begin</span><span class="p">)</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kevin A.G. Smet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>