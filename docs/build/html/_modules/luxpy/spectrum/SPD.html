<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>luxpy.spectrum.SPD &mdash; LuxPy 1.11.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=6cf1fb80"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            LuxPy
          </a>
              <div class="version">
                1.11.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License: GPLv3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../required_packages.html">Imported (required) packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../luxpy_structure.html">Luxpy package structure</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">LuxPy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">luxpy.spectrum.SPD</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for luxpy.spectrum.SPD</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">########################################################################</span>
<span class="c1"># &lt;LUXPY: a Python package for lighting and color science.&gt;</span>
<span class="c1"># Copyright (C) &lt;2017&gt;  &lt;Kevin A.G. Smet&gt; (ksmet1977 at gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># This program is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#########################################################################</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for class functionality for spectral data: class SPD</span>
<span class="sd">===========================================================</span>

<span class="sd">SPD fields </span>
<span class="sd">----------</span>

<span class="sd"> :self.wl: wavelengths of spectral data</span>
<span class="sd">    </span>
<span class="sd"> :self.value: values of spectral data</span>
<span class="sd">    </span>
<span class="sd"> :self.dtype: spectral data type (&#39;S&#39; light source, or &#39;R&#39;, reflectance, ...),</span>
<span class="sd">              used to determine interpolation method following CIE15-2017.</span>
<span class="sd">    </span>
<span class="sd"> :self.shape: self.value.shape</span>

<span class="sd"> :self.N = self.shape[0] (number of spectra in instance)</span>
<span class="sd">    </span>

<span class="sd">SPD methods </span>
<span class="sd">-----------</span>

<span class="sd"> :self.read_csv_(): Reads spectral data from file.</span>

<span class="sd"> :self.plot(): Make a plot of the spectral data in SPD instance.</span>

<span class="sd"> :self.mean(): Take mean of all spectra in SPD instance</span>

<span class="sd"> :self.sum(): Sum all spectra in SPD instance.</span>

<span class="sd"> :self.dot(): Take dot product with instance of SPD.</span>

<span class="sd"> :self.add(): Add instance of SPD.</span>

<span class="sd"> :self.sub(): Subtract instance of SPD.</span>

<span class="sd"> :self.mul(): Multiply instance of SPD.</span>

<span class="sd"> :self.div(): Divide by instance of SPD.</span>

<span class="sd"> :self.pow(): Raise SPD instance to power n.</span>

<span class="sd"> :self.get_(): Get spd as ndarray in instance of SPD.</span>

<span class="sd"> :self.setwlv(): Store spd ndarray in fields wl and values of instance of SPD.</span>

<span class="sd"> :self.getwld_(): Get wavelength spacing of SPD instance. </span>

<span class="sd"> :self.normalize(): Normalize spectral power distributions in SPD instance.</span>

<span class="sd"> :self.cie_interp(): Interpolate / extrapolate spectral data following CIE15-2018.</span>

<span class="sd"> :self.to_xyz(): Calculates xyz tristimulus values from spectral data </span>
<span class="sd">                 and return as instance of class XYZ.</span>

<span class="sd">.. codeauthor:: Kevin A.G. Smet (ksmet1977 at gmail.com)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">luxpy</span> <span class="kn">import</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">spd_to_xyz</span><span class="p">,</span> <span class="n">cie_interp</span><span class="p">,</span> <span class="n">getwld</span><span class="p">,</span> <span class="n">spd_normalize</span><span class="p">,</span> <span class="n">plot_spectrum_colors</span>
<span class="kn">from</span> <span class="nn">luxpy.utils</span> <span class="kn">import</span> <span class="n">getdata</span>
<span class="kn">from</span> <span class="nn">luxpy.color.CDATA</span> <span class="kn">import</span> <span class="n">XYZ</span> 

<div class="viewcode-block" id="SPD">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD">[docs]</a>
<span class="k">class</span> <span class="nc">SPD</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spd</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wl</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax0iswl</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> \
                 <span class="n">wl_new</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">interp_method</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">negative_values_allowed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">extrap_values</span> <span class="o">=</span> <span class="s1">&#39;ext&#39;</span><span class="p">,</span>\
                 <span class="n">norm_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">norm_f</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>\
                 <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize instance of SPD.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :spd: </span>
<span class="sd">                | None or ndarray or str, optional</span>
<span class="sd">                | If None: self.value is initialized with zeros.</span>
<span class="sd">                | If str: spd contains filename.</span>
<span class="sd">                | If ndarray: ((wavelength, spectra)) or (spectra). </span>
<span class="sd">                |     If latter, :wl: should contain the wavelengths.</span>
<span class="sd">            :wl: </span>
<span class="sd">                | None or ndarray, optional</span>
<span class="sd">                | Wavelengths.</span>
<span class="sd">                | Either specified as a 3-vector ([start, stop, spacing]) </span>
<span class="sd">                | or as full wavelength array.</span>
<span class="sd">            :a0iswl:</span>
<span class="sd">                | True, optional</span>
<span class="sd">                | Signals that first axis of :spd: contains wavelengths.</span>
<span class="sd">            :dtype:</span>
<span class="sd">                | &#39;S&#39;, optional</span>
<span class="sd">                | Type of spectral object (e.g. &#39;S&#39; for source spectrum, &#39;R&#39; for</span>
<span class="sd">                  reflectance spectra, etc.)</span>
<span class="sd">                | See SPD._INTERP_TYPES for more options. </span>
<span class="sd">                | This is used to automatically determine the correct kind of</span>
<span class="sd">                  interpolation method according to CIE15-2018.</span>
<span class="sd">            :wl_new: </span>
<span class="sd">                | None or ndarray with wavelength range, optional</span>
<span class="sd">                | If None: don&#39;t interpolate, else perform interpolation.</span>
<span class="sd">            :interp_method:</span>
<span class="sd">                | - &#39;auto&#39;, optional</span>
<span class="sd">                | If &#39;auto&#39;: method is determined based on :dtype:</span>
<span class="sd">            :negative-values_allowed:</span>
<span class="sd">                | False, optional (for cie_interp())</span>
<span class="sd">                | Spectral data can not be negative. Values &lt; 0 are therefore </span>
<span class="sd">                  clipped when set to False.</span>
<span class="sd">            :extrap_values:</span>
<span class="sd">                | &#39;ext&#39;, optional</span>
<span class="sd">                | float or list or ndarray with values to extrapolate</span>
<span class="sd">                | If &#39;ext&#39; or &#39;cie15:2018&#39;: use CIE15:2018 recommended quadratic extrapolation.</span>
<span class="sd">                | If None or &#39;cie15:2004&#39;: use CIE15:2004 recommended &#39;closest value&#39; approach.</span>
<span class="sd">            :norm_type:</span>
<span class="sd">                | None or str, optional</span>
<span class="sd">                | - &#39;lambda&#39;: make lambda in norm_f equal to 1</span>
<span class="sd">                | - &#39;area&#39;: area-normalization times norm_f</span>
<span class="sd">                | - &#39;max&#39;: max-normalization times norm_f</span>
<span class="sd">            :norm_f:</span>
<span class="sd">                | 1, optional</span>
<span class="sd">                | Normalization factor determines size of normalization </span>
<span class="sd">                | for &#39;max&#39; and &#39;area&#39; </span>
<span class="sd">                | or which wavelength is normalized to 1 for &#39;lambda&#39; option.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">spd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spd</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">spd</span> <span class="o">=</span> <span class="n">SPD</span><span class="o">.</span><span class="n">read_csv_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span> <span class="o">=</span> <span class="n">spd</span><span class="p">,</span><span class="n">header</span> <span class="o">=</span> <span class="n">header</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ax0iswl</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">spd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">spd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">wl</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">spd</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;SPD.__init__(): Dimensions of wl and spd do not match.&#39;</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">wl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">SPD</span><span class="o">.</span><span class="n">_WL3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">wl</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        
        <span class="k">if</span> <span class="n">wl_new</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">interp_method</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
                <span class="n">interp_method</span> <span class="o">=</span> <span class="n">dtype</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cie_interp</span><span class="p">(</span><span class="n">wl_new</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">interp_method</span><span class="p">,</span> <span class="n">negative_values_allowed</span> <span class="o">=</span> <span class="n">negative_values_allowed</span><span class="p">,</span> <span class="n">extrap_values</span> <span class="o">=</span> <span class="n">extrap_values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">norm_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">norm_type</span> <span class="o">=</span> <span class="n">norm_type</span><span class="p">,</span> <span class="n">norm_f</span> <span class="o">=</span> <span class="n">norm_f</span><span class="p">)</span>
    
<div class="viewcode-block" id="SPD.read_csv_">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.read_csv_">[docs]</a>
    <span class="k">def</span> <span class="nf">read_csv_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads spectral data from file.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :file:</span>
<span class="sd">                | filename </span>
<span class="sd">            :header:</span>
<span class="sd">                | None or &#39;infer&#39;, optional</span>
<span class="sd">                | If &#39;infer&#39;: headers will be inferred from file itself.</span>
<span class="sd">                | If None: no headers are expected from file.</span>
<span class="sd">            :sep: </span>
<span class="sd">                | &#39;,&#39;, optional</span>
<span class="sd">                | Column separator.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :returns:</span>
<span class="sd">                | ndarray with spectral data (first row are wavelengths)</span>
<span class="sd">            </span>
<span class="sd">        Note:</span>
<span class="sd">            Spectral data in file should be organized in columns with the first</span>
<span class="sd">            column containing  the wavelengths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#return pd.read_csv(file, names = None, index_col = None, header = header, sep = sep).values.T</span>
        <span class="k">return</span> <span class="n">getdata</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">header</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span><span class="o">.</span><span class="n">T</span></div>


<div class="viewcode-block" id="SPD.plot">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">,</span> <span class="n">wavelength_bar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a plot of the spectral data in SPD instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :returns:</span>
<span class="sd">                | handle to current axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> <span class="c1"># lazy import</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wavelength_bar</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">Smax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">axh</span> <span class="o">=</span> <span class="n">plot_spectrum_colors</span><span class="p">(</span><span class="n">spd</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">spdmax</span><span class="o">=</span><span class="n">Smax</span><span class="p">,</span> <span class="n">axh</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span> <span class="n">wavelength_height</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength (nm)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="SPD.mean">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.mean">[docs]</a>
    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take mean of all spectra in SPD instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

        
<div class="viewcode-block" id="SPD.sum">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.sum">[docs]</a>
    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sum all spectra in SPD instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

        
<div class="viewcode-block" id="SPD.dot">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.dot">[docs]</a>
    <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take dot product with instance of SPD.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">SPD</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">S</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

            
<div class="viewcode-block" id="SPD.add">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.add">[docs]</a>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add instance of SPD.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">S</span><span class="o">.</span><span class="n">value</span> 
        <span class="k">return</span> <span class="bp">self</span></div>

    
<div class="viewcode-block" id="SPD.sub">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.sub">[docs]</a>
    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subtract instance of SPD.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">-=</span> <span class="n">S</span><span class="o">.</span><span class="n">value</span> 
        <span class="k">return</span> <span class="bp">self</span></div>

        
<div class="viewcode-block" id="SPD.mul">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.mul">[docs]</a>
    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiply by instance of SPD.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">*=</span> <span class="n">S</span><span class="o">.</span><span class="n">value</span> 
        <span class="k">return</span> <span class="bp">self</span></div>

        
<div class="viewcode-block" id="SPD.div">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.div">[docs]</a>
    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Divide by instance of SPD.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">/=</span> <span class="n">S</span><span class="o">.</span><span class="n">value</span> 
        <span class="k">return</span> <span class="bp">self</span></div>

    
<div class="viewcode-block" id="SPD.pow">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.pow">[docs]</a>
    <span class="k">def</span> <span class="nf">pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raise SPD instance to power n.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">**=</span> <span class="n">n</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    
<div class="viewcode-block" id="SPD.get_">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.get_">[docs]</a>
    <span class="k">def</span> <span class="nf">get_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get spd as ndarray in instance of SPD.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="SPD.setwlv">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.setwlv">[docs]</a>
    <span class="k">def</span> <span class="nf">setwlv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">spd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store spd ndarray in fields wl and values of instance of SPD.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">spd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">spd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span></div>

     
    <span class="c1">#--------------------------------------------------------------------------------------------------</span>
      
<div class="viewcode-block" id="SPD.getwld_">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.getwld_">[docs]</a>
    <span class="k">def</span> <span class="nf">getwld_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get wavelength spacing of SPD instance. </span>
<span class="sd">                   </span>
<span class="sd">        Returns:</span>
<span class="sd">            :returns:</span>
<span class="sd">                | float:  for equal wavelength spacings</span>
<span class="sd">                |     ndarray (.shape = (n,)): for unequal wavelength spacings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">getwld</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wl</span><span class="p">)</span></div>


        
    <span class="c1">#------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="SPD.normalize">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.normalize">[docs]</a>
    <span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">norm_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">norm_f</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize spectral power distributions in SPD instance.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :norm_type:</span>
<span class="sd">                | None, optional </span>
<span class="sd">                |   - &#39;lambda&#39;: make lambda in norm_f equal to 1</span>
<span class="sd">                |   - &#39;area&#39;: area-normalization times norm_f</span>
<span class="sd">                |   - &#39;max&#39;: max-normalization times norm_f</span>
<span class="sd">                |   - &#39;ru&#39;: to :norm_f: radiometric units </span>
<span class="sd">                |   - &#39;pu&#39;: to :norm_f: photometric units </span>
<span class="sd">                |   - &#39;pusa&#39;: to :norm_f: photometric units (with Km corrected</span>
<span class="sd">                |                         to standard air, cfr. CIE TN003-2015)</span>
<span class="sd">                |   - &#39;qu&#39;: to :norm_f: quantal energy units</span>
<span class="sd">            :norm_f: </span>
<span class="sd">                | 1, optional</span>
<span class="sd">                | Determines size of normalization for &#39;max&#39; and &#39;area&#39; </span>
<span class="sd">                  or which wavelength is normalized to 1 for &#39;lambda&#39; option.</span>
<span class="sd">            :cieobs:</span>
<span class="sd">                | _CIEOBS or str, optional</span>
<span class="sd">                | Type of cmf set to use for normalization using photometric </span>
<span class="sd">                  units (norm_type == &#39;pu&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">spd_normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_</span><span class="p">(),</span> <span class="n">norm_type</span> <span class="o">=</span> <span class="n">norm_type</span><span class="p">,</span> <span class="n">norm_f</span> <span class="o">=</span> <span class="n">norm_f</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span></div>


    <span class="c1">#--------------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="SPD.cie_interp">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.cie_interp">[docs]</a>
    <span class="k">def</span> <span class="nf">cie_interp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wl_new</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">sprague5_allowed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">negative_values_allowed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                   <span class="n">extrap_values</span> <span class="o">=</span> <span class="s1">&#39;ext&#39;</span><span class="p">,</span> <span class="n">extrap_kind</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">extrap_log</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate / extrapolate spectral data following standard CIE15-2018.</span>
<span class="sd">        </span>
<span class="sd">        | The interpolation type depends on the spectrum type defined in :kind:. </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            :wl_new: </span>
<span class="sd">                | ndarray with new wavelengths</span>
<span class="sd">            :kind:</span>
<span class="sd">                | &#39;auto&#39;, optional</span>
<span class="sd">                | If :kind: is None, return original data.</span>
<span class="sd">                | If :kind: is a spectrum type (see _INTERP_TYPES), the correct </span>
<span class="sd">                |     interpolation type if automatically chosen.</span>
<span class="sd">                |       (The use of the slow(er) &#39;sprague5&#39; can be toggled on using :sprague5_allowed:).</span>
<span class="sd">                | If kind = &#39;auto&#39;: use self.dtype</span>
<span class="sd">                | Or :kind: can be any interpolation type supported by </span>
<span class="sd">                |     luxpy.math.interp1</span>
<span class="sd">                |     or can be &#39;sprague5&#39; (uses luxpy.math.interp1_sprague5). </span>
<span class="sd">            :sprague5_allowed:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: When kind is a spectral data type from _INTERP_TYPES[&#39;cubic&#39;],</span>
<span class="sd">                |    then a cubic spline interpolation will be used in case of </span>
<span class="sd">                |    unequal wavelength spacings, otherwise a 5th order Sprague will be used.</span>
<span class="sd">                | If False: always use &#39;cubic&#39;, don&#39;t use &#39;sprague5&#39;. </span>
<span class="sd">                |           This is the default, as differences are minimal and </span>
<span class="sd">                |           use of the &#39;sprague5&#39; function is a lot slower!</span>
<span class="sd">            :negative_values_allowed:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If False: negative values are clipped to zero</span>
<span class="sd">            :extrap_values:</span>
<span class="sd">                | &#39;ext&#39;, optional</span>
<span class="sd">                | If &#39;ext&#39;: extrapolate using &#39;linear&#39; (&#39;cie167:2005&#39; r), &#39;quadratic&#39; (&#39;cie15:2018&#39;) </span>
<span class="sd">                |           &#39;nearest&#39; (&#39;cie15:2004&#39;) recommended or other (e.g. &#39;cubic&#39;) methods.</span>
<span class="sd">                | If None: use CIE15:2004 recommended &#39;nearest value&#39; approach when extrapolating.</span>
<span class="sd">                | If float or list or ndarray, use those values to fill extrapolated value(s).</span>
<span class="sd">            :extrap_kind:</span>
<span class="sd">                | &#39;linear&#39;, optional</span>
<span class="sd">                | Extrapolation method used when :extrap_values: is set to &#39;ext&#39;. </span>
<span class="sd">                | Options: &#39;linear&#39; (&#39;cie167:2005&#39;), &#39;quadratic&#39; (&#39;cie15:2018&#39;), </span>
<span class="sd">                |           &#39;nearest&#39; (&#39;cie15:2004&#39;), &#39;cubic&#39;</span>
<span class="sd">                | CIE15:2018 states that based on a 2017 paper by Wang that &#39;quadratic&#39; is &#39;better&#39;. </span>
<span class="sd">                | However, no significant difference was found between &#39;quadratic&#39; and &#39;linear&#39; methods.</span>
<span class="sd">                | Also see note 1 below, for why the CIE67:2005 recommended &#39;linear&#39; extrapolation</span>
<span class="sd">                | is set as the default.            </span>
<span class="sd">            :extrap_log:</span>
<span class="sd">                | False, optional</span>
<span class="sd">                | If True: extrap the log of the spectral values </span>
<span class="sd">                |     (not CIE recommended but in most cases seems to give a </span>
<span class="sd">                |     more realistic estimate, but can sometimes seriously fail, </span>
<span class="sd">                |     especially for the &#39;quadratic&#39; extrapolation case (see note 1)!!!)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :returns:</span>
<span class="sd">                | ndarray of interpolated spectral data.</span>
<span class="sd">                | (.shape = (number of spectra+1, number of wavelength in wl_new))</span>
<span class="sd">        Notes:</span>
<span class="sd">            | 1. Type of extrapolation: &#39;quadratic&#39; vs &#39;linear&#39;; impact of extrapolating log spectral values:</span>
<span class="sd">            |       Using a &#39;linear&#39; or &#39;quadratic&#39; extrapolation, as mentioned in </span>
<span class="sd">            |       CIE167:2005 and CIE15:2018, resp., can lead to extreme large values </span>
<span class="sd">            |       when setting :extrap_log: (not CIE recommended) to True. </span>
<span class="sd">            |       A quick test with the IES TM30 spectra (400 nm - 700 nm, 5 nm spacing) </span>
<span class="sd">            |       shows that &#39;linear&#39; is better than &#39;quadratic&#39; in terms of </span>
<span class="sd">            |       mean, median and max DEu&#39;v&#39; with the original spectra (380 nm - 780 nm, 5 nm spacing).</span>
<span class="sd">            |       This conferms the recommendation from CIE167:2005 to use &#39;linear&#39; extrapolation.</span>
<span class="sd">            |       Setting :extrap_log: to True reduces the median, but inflates the mean due to some</span>
<span class="sd">            |       extremely large DEu&#39;v&#39; values. However, the increase in mean and max DEu&#39;v&#39; is much </span>
<span class="sd">            |       larger for the &#39;quadratic&#39; case, suggesting that &#39;linear&#39; extrapolation </span>
<span class="sd">            |       is likely a more suitable recommendation. When using a 1 nm spacing</span>
<span class="sd">            |       &#39;linear&#39; is more similar to &#39;quadratic&#39; when :extrap_log: is False, otherwise &#39;linear&#39;</span>
<span class="sd">            |       remains the &#39;best&#39;. Hence the choice to use the CIE167:2005 recommended linear extrapolation as default!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">spd</span> <span class="o">=</span> <span class="n">cie_interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_</span><span class="p">(),</span> <span class="n">wl_new</span><span class="p">,</span> <span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span><span class="p">,</span> <span class="n">sprague5_allowed</span> <span class="o">=</span> <span class="n">sprague5_allowed</span><span class="p">,</span>
                         <span class="n">negative_values_allowed</span> <span class="o">=</span> <span class="n">negative_values_allowed</span><span class="p">,</span> 
                         <span class="n">extrap_values</span> <span class="o">=</span> <span class="n">extrap_values</span><span class="p">,</span>
                         <span class="n">extrap_kind</span> <span class="o">=</span> <span class="n">extrap_kind</span><span class="p">,</span>
                         <span class="n">extrap_log</span> <span class="o">=</span> <span class="n">extrap_log</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wl</span> <span class="o">=</span> <span class="n">spd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">spd</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="bp">self</span></div>

    
    <span class="c1">#--------------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SPD.to_xyz">
<a class="viewcode-back" href="../../../spectrum.html#luxpy.spectrum.SPD.SPD.to_xyz">[docs]</a>
    <span class="k">def</span> <span class="nf">to_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="n">relative</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">rfl</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">_CIEOBS</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates xyz tristimulus values from spectral data </span>
<span class="sd">        and return as instance of XYZ.</span>
<span class="sd">           </span>
<span class="sd">        Args: </span>
<span class="sd">            :relative:</span>
<span class="sd">                | True or False, optional</span>
<span class="sd">                | Calculate relative XYZ (Yw = 100) </span>
<span class="sd">                  or absolute XYZ (Y = Luminance)</span>
<span class="sd">            :rfl: </span>
<span class="sd">                | ndarray with spectral reflectance functions.</span>
<span class="sd">                | Will be interpolated if wavelengths don&#39;t match those of :data:</span>
<span class="sd">            :cieobs:</span>
<span class="sd">                | luxpy._CIEOBS, optional</span>
<span class="sd">                | Determines the color matching functions to be used in the </span>
<span class="sd">                  calculation of XYZ.</span>
<span class="sd">            :out: </span>
<span class="sd">                | None or 1 or 2, optional</span>
<span class="sd">                | Determines number and shape of output. (see :returns:)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :returns:</span>
<span class="sd">                | luxpy.XYZ instance with ndarray .value field:</span>
<span class="sd">                | If rfl is None:</span>
<span class="sd">                |     If out is None: ndarray of xyz values </span>
<span class="sd">                |                     (.shape = (data.shape[0],3))</span>
<span class="sd">                |     If out == 1: ndarray of xyz values </span>
<span class="sd">                |                     (.shape = (data.shape[0],3))</span>
<span class="sd">                |     If out == 2: (ndarray of xyz , ndarray of xyzw) values</span>
<span class="sd">                |         Note that xyz == xyzw, with (.shape=(data.shape[0],3))</span>
<span class="sd">                | If rfl is not None:</span>
<span class="sd">                |     If out is None: ndarray of xyz values </span>
<span class="sd">                |                     (.shape = (rfl.shape[0],data.shape[0],3))</span>
<span class="sd">                |     If out == 1: ndarray of xyz values </span>
<span class="sd">                |                 (.shape = (rfl.shape[0]+1,data.shape[0],3))</span>
<span class="sd">                |         The xyzw values of the light source spd are the first </span>
<span class="sd">                |         set of values of the first dimension. </span>
<span class="sd">                |         The following values along this dimension are the </span>
<span class="sd">                |         sample (rfl) xyz values.</span>
<span class="sd">                |     If out == 2: (ndarray of xyz, ndarray of xyzw) values</span>
<span class="sd">                |         with xyz.shape = (rfl.shape[0],data.shape[0],3)</span>
<span class="sd">                |         and with xyzw.shape = (data.shape[0],3)</span>
<span class="sd">                 </span>
<span class="sd">        References:</span>
<span class="sd">            1. `CIE15:2018, “Colorimetry,” CIE, Vienna, Austria, 2018. &lt;https://doi.org/10.25039/TR.015.2018&gt;`_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">xyz</span><span class="p">,</span> <span class="n">xyzw</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_</span><span class="p">(),</span>  <span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span><span class="p">,</span> <span class="n">rfl</span> <span class="o">=</span> <span class="n">rfl</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">)</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">XYZ</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)</span>
            <span class="n">xyzw</span> <span class="o">=</span> <span class="n">XYZ</span><span class="p">(</span><span class="n">xyzw</span><span class="p">,</span> <span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">xyzw</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">spd_to_xyz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_</span><span class="p">(),</span>  <span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span><span class="p">,</span> <span class="n">rfl</span> <span class="o">=</span> <span class="n">rfl</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">)</span>
            <span class="n">xyz</span> <span class="o">=</span> <span class="n">XYZ</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">relative</span> <span class="o">=</span> <span class="n">relative</span><span class="p">,</span> <span class="n">cieobs</span> <span class="o">=</span> <span class="n">cieobs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">xyz</span></div>
</div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Kevin A.G. Smet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>